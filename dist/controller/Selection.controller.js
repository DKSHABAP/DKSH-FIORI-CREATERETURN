sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","../model/formatter","sap/m/MessageToast","sap/ui/core/Fragment","sap/ui/core/format/DateFormat","sap/ui/model/Sorter"],function(e,t,r,s,o,a,i){"use strict";return e.extend("dksh.connectclient.CreateReturn.controller.Selection",{formatter:r,onInit:function(){var e=this;this.selectedRetObjects=[];this.returnItems=[];this.returnConditions=[];this.exchangeItems=[];this.exchangeConditions=[];this.selectedObjects=[];var t=[];var r=new sap.ui.model.json.JSONModel;this.getView().setModel(r,"exchangeModel");var s=new sap.ui.model.json.JSONModel;this.getView().setModel(s,"exchangePreviewModel");this.getView().byId("RotypeSegementedBtnID").setEnabled(true);var o=new sap.ui.model.json.JSONModel;this.getView().setModel(o,"returnPreviewModel");var a=new sap.ui.model.json.JSONModel;this.getView().setModel(a,"returnModel");this.getView().getModel("returnModel").setProperty("/attachmentObject",t);var i=new sap.ui.model.json.JSONModel;this.getView().setModel(i,"baseModel");var i=this.getView().getModel("baseModel");var n=new sap.ui.model.json.JSONModel;this.getView().setModel(n,"invoiceSearchModel");var l=new sap.ui.model.json.JSONModel;this.getView().setModel(l,"PersonalizationModel");i.setProperty("/step1Validation",false);i.setProperty("/step2Validation",false);i.setProperty("/enableReturnReason",true);this._wizard=this.byId("ID_WIZARD_RETURN");this._oNavContainer=this.byId("ID_RETURN_NAVCON");this._oWizardContentPage=this.byId("ID_RETURN_PAGE");i.setProperty("/cancelBtnVisiblitys",true);i.setProperty("/submitBtnVisiblitys",false);i.setProperty("/previewBtnVisiblitys",false);i.setProperty("/exchangeBtnVisiblitys",false);i.setProperty("/saveAsDraftBtnVisiblitys",false);i.setProperty("/addressVisiblity",false);i.setProperty("/salesOrgEditable",true);i.setProperty("/distChnlEditable",true);i.setProperty("/attachmentTableVisiblity",false);i.setProperty("/exchangeTabVisiblity",false);i.setProperty("/smsInputVisiblity",false);i.setProperty("/emailInputVisiblity",false);i.setProperty("/commentsLength",2);i.setProperty("/tableSelMode","MultiSelect");i.setProperty("/attachmentLength",0);i.setProperty("/visiblityROTypeSel",true);i.getProperty("/EXOneTimeCustomer","");i.setProperty("/enableAddAttachment",true);i.setProperty("/enableViewAttachment",false);i.setProperty("/attachmentVisiblity",true);i.setProperty("/retDivEditablity",true);i.setProperty("/retSalesOrgEditablity",true);i.setProperty("/retDistChnlEditablity",true);this.getView().getModel("invoiceSearchModel").setProperty("/billingCategory","C");this.getView().getModel("invoiceSearchModel").setProperty("/billingCategoryDesc","Commercial Invoice");this.getView().getModel("baseModel").setProperty("/addressFieldEnable",true);this.getView().getModel("baseModel").setProperty("/EXaddressVisiblity",false);this._getUser();this.selectedReturnItems=[];e.salesOrgDataAccess="No Access";e.SLOCDataAccess="No Access";e.distrChannelDataAccess="No Access";e.divisionDataAccess="No Access";e.materialGroupDataAccess="No Access";e.materialGroup4DataAccess="No Access";e.plantDataAccess="No Access";this.ranOnce=false;if(sap.ui.getCore().getConfiguration().getLanguage()==="en-US"){i.setProperty("/language","TH")}else{i.setProperty("/language",sap.ui.getCore().getConfiguration().getLanguage())}i.setProperty("/languageID","E");i.setProperty("/invoiceTableLength","");i.setProperty("/returnTableLength","");i.setProperty("/exchangeTableLength","");i.setProperty("/disableSoldToParty",true);this.getOwnerComponent().getService("ShellUIService").then(function(t){t.setBackNavigation(function(){e._discardChanges();e._wizard.discardProgress(e._wizard.getSteps()[0]);var t=sap.ushell.Container.getService("CrossApplicationNavigation");var r=sap.ui.core.routing.History.getInstance(),s=r.getPreviousHash(),t=sap.ushell.Container.getService("CrossApplicationNavigation");if(s!==undefined){history.go(-1)}else{t.toExternal({target:{shellHash:"#"}})}})});i.setProperty("/InvCollapseVisiblity",true);i.setProperty("/InvOpenVisiblity",false);i.setProperty("/InvSearchBar",true);i.setProperty("/ExcCollapseVisiblity",true);i.setProperty("/ExcOpenVisiblity",false);i.setProperty("/ExcSearchBar",true);i.setProperty("/PrevCollapseVisiblity",true);i.setProperty("/PrevopenVisiblity",false);i.setProperty("/PrevSearchBar",true);i.setProperty("/RetCollapseVisiblity",true);i.setProperty("/RetOpenVisiblity",false);i.setProperty("/ReturnSeacrhBar",true);i.setProperty("/EXOneTimeCustomer","");i.setProperty("/oneTimeCustomer","");var d=sap.ui.core.UIComponent.getRouterFor(this);d.attachRoutePatternMatched(this._handleRouteMatched,this)},onPressInvCollapse:function(){this.getView().getModel("baseModel").setProperty("/InvCollapseVisiblity",false);this.getView().getModel("baseModel").setProperty("/InvOpenVisiblity",true);this.getView().getModel("baseModel").setProperty("/InvSearchBar",false)},onPressInvOpen:function(){this.getView().getModel("baseModel").setProperty("/InvCollapseVisiblity",true);this.getView().getModel("baseModel").setProperty("/InvOpenVisiblity",false);this.getView().getModel("baseModel").setProperty("/InvSearchBar",true)},onPressRetCollapse:function(){this.getView().getModel("baseModel").setProperty("/RetCollapseVisiblity",false);this.getView().getModel("baseModel").setProperty("/RetOpenVisiblity",true);this.getView().getModel("baseModel").setProperty("/ReturnSeacrhBar",false)},onPressRetOpen:function(){this.getView().getModel("baseModel").setProperty("/RetCollapseVisiblity",true);this.getView().getModel("baseModel").setProperty("/RetOpenVisiblity",false);this.getView().getModel("baseModel").setProperty("/ReturnSeacrhBar",true)},onPressExCollapse:function(){this.getView().getModel("baseModel").setProperty("/ExcCollapseVisiblity",false);this.getView().getModel("baseModel").setProperty("/ExcOpenVisiblity",true);this.getView().getModel("baseModel").setProperty("/ExcSearchBar",false)},onPressExOpen:function(){this.getView().getModel("baseModel").setProperty("/ExcCollapseVisiblity",true);this.getView().getModel("baseModel").setProperty("/ExcOpenVisiblity",false);this.getView().getModel("baseModel").setProperty("/ExcSearchBar",true)},onPressPreCollapse:function(){this.getView().getModel("baseModel").setProperty("/PrevCollapseVisiblity",false);this.getView().getModel("baseModel").setProperty("/PrevopenVisiblity",true);this.getView().getModel("baseModel").setProperty("/PrevSearchBar",false)},onPressPreOpen:function(){this.getView().getModel("baseModel").setProperty("/PrevCollapseVisiblity",true);this.getView().getModel("baseModel").setProperty("/PrevopenVisiblity",false);this.getView().getModel("baseModel").setProperty("/PrevSearchBar",true)},OnPressSelectionNv:function(){var e=sap.ui.core.UIComponent.getRouterFor(this);e.navTo("DraftRecord",true)},_handleRouteMatched:function(){var e=this;var t=e.getView().getModel("baseModel");if(sap.ui.getCore().getModel("globalModel").getProperty("/phone")){t.setProperty("/phone",sap.ui.getCore().getModel("globalModel").getProperty("/phone"))}else{t.setProperty("/phone","")}if(sap.ui.getCore().getModel("draftItemModel")===undefined||sap.ui.getCore().getModel("draftItemModel").getData()===""){t.setProperty("/tableSelMode","MultiSelect");t.setProperty("/step1Validation",false);t.setProperty("/step2Validation",false);t.setProperty("/step3Validation",false);this._getUser();return}var r=new sap.m.BusyDialog;r.open();var s=sap.ui.getCore().getModel("draftItemModel").getData();var o="/DKSHJavaService/returnRequest/getByReturnReqNum/"+s.returnReqNum+"&"+sap.ui.getCore().getModel("globalModel").getProperty("/userId")+"&cc";var a=new sap.ui.model.json.JSONModel;var e=this;a.loadData(o,true,"GET",false,false);a.attachRequestCompleted(function(s){r.close();e.editDraftData=s.getSource().getData();var o=new sap.ui.model.json.JSONModel({results:e.editDraftData});e.getView().setModel(o,"editDraftModel");e._setDraftData(e.editDraftData.docVersion);t.setProperty("/step1Validation",true);t.setProperty("/step2Validation",true);t.setProperty("/step3Validation",true);t.setProperty("/step4Validation",true)});a.attachRequestFailed(function(e){sap.m.MessageToast.show("Error");r.close()})},_setDraftData:function(e){this.docVersion=e;var t=this.getView().getModel("baseModel");if(this.docVersion==="SUCCESS"){t.setProperty("/visiblityROTypeSel",false);t.setProperty("/enableAddAttachment",false);t.setProperty("/enableViewAttachment",true);this.getView().byId("RotypeSegementedBtnID").setEnabled(false);t.setProperty("/enableReturnReason",false);t.setProperty("/custSelFormEditablity",false);t.setProperty("/InvoiceNoIP",false);t.setProperty("/InvMat",false);t.setProperty("/InvBatNo",false);t.setProperty("/InvSrlIP",false);t.setProperty("/InvSrlChbx",false);t.setProperty("/InvBillCat",false);t.setProperty("/InvDateFrom",false);t.setProperty("/InvDateTo",false);t.setProperty("/datePrev",false);t.setProperty("/dateNext",false);t.setProperty("/InvSrch",false);t.setProperty("/InvReset",false);t.setProperty("/salesOrgEditable",false);t.setProperty("/distChnlEditable",false);t.setProperty("/disableSoldToParty",false);t.setProperty("/billingTypeEnable",false);t.setProperty("/InvSetting",false);t.setProperty("/InvNext",false);t.setProperty("/selRoTypeEdit",false);t.setProperty("/CopyExcbtn",false);t.setProperty("/RetUndo",false);t.setProperty("/RetDel",false);t.setProperty("/RetRemarkEnable",false);t.setProperty("/RetAddFileEnable",false);t.setProperty("/RetEmailChbxEnable",false);t.setProperty("/RetEmailIPEnable",false);t.setProperty("/RetSmsChbx",false);t.setProperty("/RetPhNoIP",false);t.setProperty("/RetReasonOwnerEnable",false);t.setProperty("/RetRefNo",false);t.setProperty("/RetRequestor",false);t.setProperty("/exShipToEnable",false);t.setProperty("/ExRemarkEnable",false);t.setProperty("/enableAddMat",false);t.setProperty("/enableExDel",false);t.setProperty("/enableExUndo",false);t.setProperty("/enableCompltDel",false);t.setProperty("/saveAsDraftBtnVisiblitys",false);t.setProperty("/previewBtnVisiblitys",false);t.setProperty("/submitBtnVisiblitys",false);t.setProperty("/attachmentDelEnable",false);t.setProperty("/tableSelMode","None");t.refresh()}else{t.setProperty("/visiblityROTypeSel",true);t.setProperty("/enableAddAttachment",true);t.setProperty("/enableViewAttachment",false);this.getView().byId("RotypeSegementedBtnID").setEnabled(true);t.setProperty("/tableSelMode","MultiSelect");t.setProperty("/enableReturnReason",true);t.setProperty("/custSelFormEditablity",true);t.setProperty("/InvoiceNoIP",true);t.setProperty("/InvMat",true);t.setProperty("/InvBatNo",true);t.setProperty("/InvSrlIP",true);t.setProperty("/InvSrlChbx",true);t.setProperty("/InvBillCat",true);t.setProperty("/InvDateFrom",true);t.setProperty("/InvDateTo",true);t.setProperty("/datePrev",true);t.setProperty("/dateNext",true);t.setProperty("/billingTypeEnable",true);t.setProperty("/InvSrch",true);t.setProperty("/InvReset",true);t.setProperty("/salesOrgEditable",true);t.setProperty("/distChnlEditable",true);t.setProperty("/disableSoldToParty",true);t.setProperty("/InvSetting",true);t.setProperty("/InvNext",true);t.setProperty("/selRoTypeEdit",true);t.setProperty("/CopyExcbtn",true);t.setProperty("/RetSetting",true);t.setProperty("/RetUndo",true);t.setProperty("/RetDel",true);t.setProperty("/RetRemarkEnable",true);t.setProperty("/RetAddFileEnable",true);t.setProperty("/RetEmailChbxEnable",true);t.setProperty("/RetEmailIPEnable",true);t.setProperty("/RetSmsChbx",true);t.setProperty("/RetPhNoIP",true);t.setProperty("/RetReasonOwnerEnable",true);t.setProperty("/RetRefNo",true);t.setProperty("/RetRequestor",true);t.setProperty("/exShipToEnable",true);t.setProperty("/ExRemarkEnable",true);t.setProperty("/enableAddMat",true);t.setProperty("/enableExDel",true);t.setProperty("/enableExUndo",true);t.setProperty("/enableExSetting",true);t.setProperty("/enableCompltDel",true);t.setProperty("/saveAsDraftBtnVisiblitys",true);t.setProperty("/previewBtnVisiblitys",true);t.setProperty("/submitBtnVisiblitys",true);t.setProperty("/attachmentDelEnable",true)}var r=this;t.setProperty("/step1Validation",true);t.setProperty("/step2Validation",true);t.setProperty("/step3Validation",true);var s=this.getView().getModel("editDraftModel");var o=this.getView().getModel("editDraftModel").getData().results.listItemDto;var a=this.getView().getModel("invoiceSearchModel");var i=this.getView().getModel("returnModel");var n=this.getView().getModel("exchangeModel");t.setProperty("/billTo",s.getData().results.billToParty);t.setProperty("/contactDivision",s.getData().results.contactDivision);t.setProperty("/contactPerson",s.getData().results.contactPerson);t.setProperty("/contactTelephone",s.getData().results.contactTelephone);t.setProperty("/DistChan",s.getData().results.distributionChannel);a.setProperty("/distChnlDesc",s.getData().results.distributionChannelDesc);t.setProperty("/selectedDivisionDesc",s.getData().results.divisionDesc);if(s.getData().results.requestorName.includes("P0000")===true){t.setProperty("/userName",s.getData().results.requestorName.split("(")[1].split(")")[0])}else{t.setProperty("/userName",s.getData().results.requestorName)}t.setProperty("/phone","");a.setProperty("/salesOrgDesc",s.getData().results.salesOrgDesc);t.setProperty("/selectedSalesOrgDesc",s.getData().results.salesOrgDesc);t.setProperty("/selectedDistChlDesc",s.getData().results.distributionChannelDesc);t.setProperty("/selectedDistChnl",s.getData().results.distributionChannel);t.setProperty("/Division",s.getData().results.division);t.setProperty("/selectedReturnReason",s.getData().results.orderReason+s.getData().results.orderReasonText);t.setProperty("/returnOrderType",s.getData().results.orderType);t.setProperty("/payer",s.getData().results.payer);t.setProperty("/reasonOwner",s.getData().results.reasonOwner+" ("+s.getData().results.reasonOwnerDesc+")");if(s.getData().results.updatedBy!==null&&s.getData().results.updatedBy!==""){t.setProperty("/requestor",s.getData().results.updatedBy)}else{t.setProperty("/requestor","")}t.setProperty("/returnRemark",s.getData().results.requestRemark);t.setProperty("/selectedROTypeCode",s.getData().results.roType);t.setProperty("/customerPONumber",s.getData().results.customerPo);if(s.getData().results.roType==="TG"||s.getData().results.roType==="TF"){t.setProperty("/visiblityROTypeSel",true);t.setProperty("/visiblityROTypeText",false)}else{t.setProperty("/visiblityROTypeSel",false);t.setProperty("/visiblityROTypeText",true)}if(s.getData().results.oneTimeCustomer===null){t.setProperty("/oneTimeCustomer","")}else{t.setProperty("/oneTimeCustomer",s.getData().results.oneTimeCustomer)}if(s.getData().results.listAddressDo&&s.getData().results.listAddressDo.length>0){t.setProperty("/partnerName",s.getData().results.listAddressDo[0].name1);t.setProperty("/partnerName4",s.getData().results.listAddressDo[0].name4);t.setProperty("/AddressStreet2",s.getData().results.listAddressDo[0].street2);t.setProperty("/AddressStreet3",s.getData().results.listAddressDo[0].street3);t.setProperty("/AddressStreet5",s.getData().results.listAddressDo[0].street5);t.setProperty("/District",s.getData().results.listAddressDo[0].district);t.setProperty("/DifferentCity",s.getData().results.listAddressDo[0].differentCity);t.setProperty("/postalCode",s.getData().results.listAddressDo[0].postalCode);t.setProperty("/refDocNum",s.getData().results.listAddressDo[0].refDocNum);t.setProperty("/city",s.getData().results.listAddressDo[0].city);t.setProperty("/telephone",s.getData().results.listAddressDo[0].telephone);t.setProperty("/mobileNumber",s.getData().results.listAddressDo[0].mobilePhone);t.setProperty("/taxId",s.getData().results.listAddressDo[0].taxId);t.setProperty("/bCode",s.getData().results.listAddressDo[0].b_Codes);t.setProperty("/bpNummr",s.getData().results.listAddressDo[0].bpNummr);t.setProperty("/invRetCountry",s.getData().results.listAddressDo[0].country);t.setProperty("/invRetRegion",s.getData().results.listAddressDo[0].region);t.setProperty("/invRetLanguage",s.getData().results.listAddressDo[0].language)}t.setProperty("/setRetAddress",s.getData().results.listAddressDo);t.setProperty("/returnSoldTo",s.getData().results.soldToParty);t.setProperty("/returnSoldToDesc",s.getData().results.soldToPartyDesc);t.setProperty("/returnShipTo",s.getData().results.shipToParty);t.setProperty("/returnShipToDesc",s.getData().results.shipToPartyDesc);t.setProperty("/returnPayer",s.getData().results.payer);t.setProperty("/returnPayerDesc",s.getData().results.payerDesc);t.setProperty("/returnBillTo",s.getData().results.billToParty);t.setProperty("/returnBillToDesc",s.getData().results.billToDesc);t.setProperty("/selectedROType",s.getData().results.roType);t.setProperty("/billToDesc",s.getData().results.billToDesc);t.setProperty("/shipToDesc",s.getData().results.shipToPartyDesc);t.setProperty("/shipTo",s.getData().results.shipToParty);t.setProperty("/payerDesc",s.getData().results.payerDesc);t.setProperty("/salesOrgForRO",s.getData().results.mappingId);if(s.getData().results.requestorEmail){t.setProperty("/userEmailId",s.getData().results.requestorEmail);t.setProperty("/emailFlag",true);t.setProperty("/emailInputVisiblity",true)}if(s.getData().results.contactTelephone){t.setProperty("/phoneNum",s.getData().results.contactTelephone);t.setProperty("/smsInputVisiblity",true);t.setProperty("/phoneNumFlag",true)}if(s.getData().results.roType==="TG"){this.getView().byId("RotypeSegementedBtnID").setSelectedKey("TG")}else if(s.getData().results.roType==="TF"){this.getView().byId("RotypeSegementedBtnID").setSelectedKey("TF")}else if(s.getData().results.roType==="TI"){this.getView().byId("RotypeSegementedBtnID").setSelectedKey("TI")}else{this.getView().byId("RotypeSegementedBtnID").setSelectedKey("TK")}t.setProperty("/selectedROType",s.getData().results.roTypeText);t.setProperty("/SalesOrg",s.getData().results.salesOrg);t.setProperty("/selectedSalesOrg",s.getData().results.salesOrg);t.setProperty("/shipToParty",s.getData().results.shipToParty);t.setProperty("/exShipTo",s.getData().results.shipToParty);t.setProperty("/exchangeOrderType",s.getData().results.exchangeOrderType);t.setProperty("/selectedSoldtoParty",s.getData().results.soldToParty);t.setProperty("/selectedSoldtoPartyDesc",s.getData().results.soldToPartyDesc);var l=s.getData().results.orderReason+" ("+s.getData().results.orderReasonText+")";t.setProperty("/selectedReturnReason",l);t.setProperty("/returnReqNum",s.getData().results.returnReqNum);t.setProperty("/referenceNo",s.getData().results.referenceNum);a.setProperty("/distChnl",s.getData().results.distributionChannel);a.setProperty("/Division",s.getData().results.division);a.setProperty("/salesOrgNo",s.getData().results.salesOrg);a.setProperty("/shipTo",s.getData().results.shipToParty);a.setProperty("/soldToParty",s.getData().results.soldToParty);a.setProperty("/soldToPartyDesc",s.getData().results.soldToPartyDesc);t.refresh(true);this.getView().getModel("invoiceSearchModel").refresh(true);if(s.getData().results.listAttachementDo!==null){var d=s.getData().results.listAttachementDo;var g=[];for(var p=0;p<d.length;p++){var c={fileName:d[p].docName,fileType:d[p].docType,fileDoc:d[p].docData,compressedFile:d[p].docData,docId:d[p].docId};g.push(c)}this.getView().getModel("returnModel").setProperty("/attachmentObject",g);t.setProperty("/enableViewAttachment",true);t.setProperty("/attachmentTableVisiblity",true)}else{t.setProperty("/enableViewAttachment",false);t.setProperty("/attachmentTableVisiblity",false)}var u=[];for(var p=0;p<o.length;p++){var h={MaterialCode:o[p].material,MaterialGroup:o[p].materialGroup,MaterialGroup4:o[p].materialGroup4,BatchNumber:o[p].batch,ExpiryDate:o[p].expiryDate,BillingQty:o[p].avlReturnQty.toString(),SalesUnit:o[p].returnUom,AvailRetQtySalesUn:o[p].avlReturnQty.toString(),actualRetQty:o[p].returnQty.toString(),UnitPrice:o[p].unitPriceCc.toString(),ListPrice:o[p].unitPriceCc.toString(),DiscountAmount:"",NetPrice:"",itemVisibility:o[p].itemVisibility.toString(),storageLocation:o[p].storageLocation,billingDateFrom:o[p].referenceInvDate,ItemUsage:"",SerialNum:"",shipToParty:s.getData().results.shipToParty,InvoiceNum:o[p].refDocNum,InvoiceLineItem:o[p].refDocItem,HigherLvlItem:o[p].higherLevel,ActiveIndicator:""};this.selectedReturnItems.push(h)}this._pricingSimulation(this.selectedReturnItems,"Returns");if(this.getView().getModel("editDraftModel").getData().results.exchangeDto!==null){var m=this.getView().getModel("editDraftModel").getData().results.exchangeDto.listExhangeItemDto;t.setProperty("/exchangeOrderType",s.getData().results.exchangeDto.orderType);t.setProperty("/exchangeReqNum",s.getData().results.exchangeDto.exchangeReqNum);t.setProperty("/exchangeRemark",s.getData().results.exchangeDto.requestRemark);t.setProperty("/customerPONumberEx",s.getData().results.exchangeDto.customerPo);t.setProperty("/setExAddress",s.getData().results.exchangeDto.listAddressDo);if(s.getData().results.exchangeDto.exoneTimeCustomer===null){t.setProperty("/EXOneTimeCustomer","")}else{t.setProperty("/EXOneTimeCustomer",s.getData().results.exchangeDto.exoneTimeCustomer)}if(s.getData().results.exchangeDto.listAddressDo&&s.getData().results.exchangeDto.listAddressDo.length>0){t.setProperty("/EXaddressVisiblity",true);t.setProperty("/partnerName",s.getData().results.exchangeDto.listAddressDo[0].name1);t.setProperty("/partnerName4",s.getData().results.exchangeDto.listAddressDo[0].name4);t.setProperty("/AddressStreet2",s.getData().results.exchangeDto.listAddressDo[0].street2);t.setProperty("/AddressStreet3",s.getData().results.exchangeDto.listAddressDo[0].street3);t.setProperty("/AddressStreet5",s.getData().results.exchangeDto.listAddressDo[0].street5);t.setProperty("/District",s.getData().results.exchangeDto.listAddressDo[0].district);t.setProperty("/DifferentCity",s.getData().results.exchangeDto.listAddressDo[0].differentCity);t.setProperty("/postalCode",s.getData().results.exchangeDto.listAddressDo[0].postalCode);t.setProperty("/city",s.getData().results.exchangeDto.listAddressDo[0].city);t.setProperty("/telephone",s.getData().results.exchangeDto.listAddressDo[0].telephone);t.setProperty("/mobileNumber",s.getData().results.exchangeDto.listAddressDo[0].mobilePhone);t.setProperty("/taxId",s.getData().results.exchangeDto.listAddressDo[0].taxId);t.setProperty("/bCode",s.getData().results.exchangeDto.listAddressDo[0].b_Codes);t.setProperty("/refDocNum",s.getData().results.exchangeDto.listAddressDo[0].refDocNum);t.setProperty("/bpNummr",s.getData().results.exchangeDto.listAddressDo[0].bpNummr);t.setProperty("/invCountry",s.getData().results.exchangeDto.listAddressDo[0].country);t.setProperty("/invRegion",s.getData().results.exchangeDto.listAddressDo[0].region);t.setProperty("/invLanguage",s.getData().results.exchangeDto.listAddressDo[0].language)}t.setProperty("/exSoldTo",s.getData().results.exchangeDto.soldToParty);t.setProperty("/exSoldToDesc",s.getData().results.exchangeDto.soldToPartyDesc);t.setProperty("/exShipTo",s.getData().results.exchangeDto.shipToParty);t.setProperty("/exShipToDesc",s.getData().results.exchangeDto.shipToPartyDesc);t.setProperty("/exPayer",s.getData().results.exchangeDto.payer);t.setProperty("/exPayerDesc",s.getData().results.exchangeDto.payerDescription);t.setProperty("/exBillTo",s.getData().results.exchangeDto.billToParty);t.setProperty("/exBillToDesc",s.getData().results.exchangeDto.billToPartyDesc);var y=[];for(var P=0;P<m.length;P++){if(s.getData().results.roType==="TI"){}if(m[P].manualFoc===null){m[P].manualFoc=""}var f={itemNumber:"",matNumber:m[P].material,itemShortText:m[P].shortText,materialGroup:m[P].materialGroup,materialGroup4:m[P].materialGroup4,quantity:m[P].returnQty.toString(),salesUnit:m[P].returnUom,unitPrice:m[P].unitPriceCc.toString(),unitPriceInv:m[P].unitPriceCc.toString(),discountAmount:"",netAmount:"",listPrice:"",storageLocation:m[P].storageLocation,higherItem:m[P].higherLevel,batchNumber:m[P].batch,expiryDate:m[P].expiryDate,billingDate:m[P].referenceInvDate,refInvoice:m[P].refDocNum,refItemNumber:m[P].refDocItem,serialNumber:m[P].serialNum,active:"",manualFoc:m[P].manualFoc,itemVisibility:m[P].itemVisibility.toString()};y.push(f)}this._pricingSimulation(y,"Exchange")}t.setProperty("/step1Validation",true);t.setProperty("/step2Validation",true);t.setProperty("/step3Validation",true);this._getUser()},onAfterRendering:function(){this.resourceBundle=this.getView().getModel("i18n").getResourceBundle();var e=this;if(e.editDraftData){var t=new sap.ui.model.json.JSONModel({results:e.editDraftData})}},_getUser:function(){var e=this;var r=new sap.ui.model.json.JSONModel;e.getView().setModel(r,"oUserDetailModel");r.loadData("/services/userapi/attributes",null,true);r.attachRequestCompleted(function(t){e.getView().getModel("baseModel").setProperty("/email",e.getView().getModel("oUserDetailModel").getData().email);var r=e.getView().getModel("oUserDetailModel").getData().name;if(r){e._getLoggedInUserDetails(r)}});r.attachRequestFailed(function(e){t.error(e.getSource().getData().message)})},_getLoggedInUserDetails:function(e){var t=this;var r=new sap.ui.model.json.JSONModel;t.getView().setModel(r,"oLoggedInUserDetailModel");r.loadData("/UserManagement/service/scim/Users/"+e,null,true);r.attachRequestCompleted(function(e){t.getView().getModel("baseModel").setProperty("/userId",e.getSource().getData().id);t.getView().getModel("baseModel").setProperty("/userName",e.getSource().getData().displayName)});r.attachRequestFailed(function(e){});var s=new sap.ui.model.json.JSONModel;t.getView().setModel(s,"oModel");var o=new sap.m.BusyDialog;o.open();s.loadData("/DKSHJavaService/userDetails/findAllRightsForUserInDomain/"+e+"&cc",null,true);s.attachRequestCompleted(function(e){o.close();if(!e.getParameters().errorobject){var r=e.getSource().getData();if(r.message)t.allAccess=false;if(r.ATR01!==null){t.salesOrgDataAccess=r.ATR01}if(r.ATR02!==null){t.distrChannelDataAccess=r.ATR02}if(r.ATR03!==null){t.divisionDataAccess=r.ATR03}if(r.ATR04!==null){t.materialGroupDataAccess=r.ATR04}if(r.ATR05!==null){t.materialGroup4DataAccess=r.ATR05}if(r.ATR06!==null){t.custCodeDataAccess=r.ATR06}if(r.ATR07!==null){t.materialDataAccess=r.ATR07}}t._getRoTypeList();t._salesOrgList();t._distChannelList()});s.attachRequestFailed(function(e){o.close();t.allAccess=false})},onCompleteStep2:function(){if(!this.invoiceDetail){this.invoiceDetail=sap.ui.xmlfragment("dksh.connectclient.CreateReturn.Fragments.InvoiceDetail",this);this.getView().addDependent(this.invoiceDetail)}var e="Web";if(sap.ui.Device.system.phone===true){e="Phone"}var t={userId:this.getView().getModel("baseModel").getProperty("/userId"),appId:"keyInvoice",runType:e};this._getPersonalizationDetails("keyInvoice","Before")},selectSerialCheckbox:function(e){var t=e.getSource().getSelected();if(t===false){this.getView().getModel("invoiceSearchModel").setProperty("/selectedSerialNum",false);this.getView().getModel("invoiceSearchModel").setProperty("/displayBySno",undefined)}else{this.getView().getModel("invoiceSearchModel").setProperty("/selectedSerialNum",true);this.getView().getModel("invoiceSearchModel").setProperty("/displayBySno","X")}this.getView().getModel("invoiceSearchModel").refresh()},onPressRemarks:function(){if(this.docVersion==="SUCCESS"){}else{var e=this;if(!e.Remark){e.Remark=sap.ui.xmlfragment("dksh.connectclient.CreateReturn.Fragments.Remark",this);e.getView().addDependent(e.Remark);e.Remark.addStyleClass("sapUiSizeCompact")}if(this.getView().byId("ID_TAB_BAR_PROV_APP").getSelectedKey()==="Exchange"&&this.ROtypeCode==="TI"){var t=this.getView().getModel("baseModel");if(t.getProperty("/comment")===""){t.setProperty("/comment","ไม่ต้องส่งของ หรือ ส่งของเพิ่มบางส่วน")}}e.Remark.open()}},onOKRemark:function(){var e=this.getView().getModel("baseModel");if((e.getProperty("/comment")===undefined||e.getProperty("/comment")==="")&&(e.getProperty("/contactTelephone")===undefined||e.getProperty("/contactTelephone")==="")&&(e.getProperty("/contactDivision")===undefined||e.getProperty("/contactDivision")==="")&&(e.getProperty("/contactPerson")===undefined||e.getProperty("/contactPerson")==="")&&(e.getProperty("/remark")===undefined||e.getProperty("/remark")==="")){t.information(this.resourceBundle.getText("Enterthemadatoryfields"))}else{var e=this.getView().getModel("baseModel");var r="";if(this.getView().byId("ID_TAB_BAR_PROV_APP").getSelectedKey()==="Return"){if(this.ROtypeCode==="TI"){var o="ไม่ต้องส่งของ เคลียร์ใบส่งของชั่วคราว"+" ";var a=this.getView().getModel("returnModel").getProperty("/results");for(var i=0;i<a.length;i++){if(i===a.length-1){if(!o.includes(a[i].refInvoice)){o=o+a[i].refInvoice+" "+"ส่งบิลที่แผนก "}else{o=o+" "+"ส่งบิลที่แผนก "}}else{if(!o.includes(a[i].refInvoice)){o=o+a[i].refInvoice+", "}}}if(e.getProperty("/contactDivision")!==undefined&&e.getProperty("/contactDivision")!==""){o=o+" "+e.getProperty("/contactDivision")+"ติดต่อ"}else{s.show(this.resourceBundle.getText("Contactdivisionmandatory"));return}if(e.getProperty("/contactPerson")!==undefined&&e.getProperty("/contactPerson")!==""){o=o+" "+e.getProperty("/contactPerson")}else{s.show(this.resourceBundle.getText("Contactpersonmandatory"));return}if(e.getProperty("/contactTelephone")!==undefined&&e.getProperty("/contactTelephone")!==""){o=o+" "+"Tel"+" "+e.getProperty("/contactTelephone")}else{s.show(this.resourceBundle.getText("ContactTelephonemandatory"));return}if(e.getProperty("/comment")!==undefined&&e.getProperty("/comment")!==""){o=o+" "+e.getProperty("/comment")}}else if(this.ROtypeCode==="TK"){var o="ใช้แทนบิล";var a=this.getView().getModel("returnModel").getProperty("/results");for(var i=0;i<a.length;i++){if(i===a.length-1){if(!o.includes(a[i].refInvoice)){o=o+a[i].refInvoice+" "+"ไม่ต้องส่งของ แก้ไขเนื่องจาก"+" "+this.getView().getModel("baseModel").getProperty("/selectedReturnReason")+"ส่งบิลที่"}else{o=o+" "+"ไม่ต้องส่งของ แก้ไขเนื่องจาก"+" "+this.getView().getModel("baseModel").getProperty("/selectedReturnReason")+"ส่งบิลที่"}}else{if(!o.includes(a[i].refInvoice)){o=o+a[i].refInvoice+", "}}}if(e.getProperty("/contactDivision")!==undefined&&e.getProperty("/contactDivision")!==""){o=o+" "+e.getProperty("/contactDivision")+"ติดต่อ"}else{s.show(this.resourceBundle.getText("Contactdivisionmandatory"));return}if(e.getProperty("/contactPerson")!==undefined&&e.getProperty("/contactPerson")!==""){o=o+" "+e.getProperty("/contactPerson")}else{s.show(this.resourceBundle.getText("Contactpersonmandatory"));return}if(e.getProperty("/contactTelephone")!==undefined&&e.getProperty("/contactTelephone")!==""){o=o+" "+"Tel"+" "+e.getProperty("/contactTelephone")}else{s.show(this.resourceBundle.getText("ContactTelephonemandatory"));return}if(e.getProperty("/comment")!==undefined&&e.getProperty("/comment")!==""){o=o+" "+e.getProperty("/comment")}}else{var o="สาเหตุการคืน."+" "+this.getView().getModel("baseModel").getProperty("/selectedReturnReason")+" "+"รับคืนสินค้าที่คุณ ";if(e.getProperty("/contactPerson")!==undefined&&e.getProperty("/contactPerson")!==""){o=o+" "+e.getProperty("/contactPerson")+"แผนก"}else{s.show(this.resourceBundle.getText("Contactpersonmandatory"));return}if(e.getProperty("/contactDivision")!==undefined&&e.getProperty("/contactDivision")!==""){o=o+" "+e.getProperty("/contactDivision")}else{s.show(this.resourceBundle.getText("Contactdivisionmandatory"));return}if(e.getProperty("/contactTelephone")!==undefined&&e.getProperty("/contactTelephone")!==""){o=o+" "+"Tel"+" "+e.getProperty("/contactTelephone")}else{s.show(this.resourceBundle.getText("ContactTelephonemandatory"));return}if(e.getProperty("/comment")!==undefined&&e.getProperty("/comment")!==""){o=o+" "+e.getProperty("/comment")}}}else{if(this.ROtypeCode==="TI"){var o="เคลียร์ใบส่งของชั่วคราว"+" ";var n=this.getView().getModel("returnModel").getProperty("/results");for(var i=0;i<n.length;i++){if(i===n.length-1){if(!o.includes(n[i].refInvoice)){o=o+n[i].refInvoice+" "+"ส่งบิลที่แผนก"}else{o=o+" "+"ส่งบิลที่แผน"}}else{if(!o.includes(n[i].refInvoice)){o=o+n[i].refInvoice+", "}}}if(e.getProperty("/contactDivision")!==undefined&&e.getProperty("/contactDivision")!==""){o=o+" "+e.getProperty("/contactDivision")+"ติดต่อ"}else{s.show(this.resourceBundle.getText("Contactdivisionmandatory"));return}if(e.getProperty("/contactPerson")!==undefined&&e.getProperty("/contactPerson")!==""){o=o+" "+e.getProperty("/contactPerson")+"แผนก"}else{s.show(this.resourceBundle.getText("Contactpersonmandatory"));return}if(e.getProperty("/contactTelephone")!==undefined&&e.getProperty("/contactTelephone")!==""){o=o+" "+"Tel"+" "+e.getProperty("/contactTelephone")}else{s.show(this.resourceBundle.getText("ContactTelephonemandatory"));return}if(e.getProperty("/comment")!==undefined&&e.getProperty("/comment")!==""){o=o+" "+e.getProperty("/comment")}}else if(this.ROtypeCode==="TK"){var o="ใช้แทนบิล"+"  ";var n=this.getView().getModel("returnModel").getProperty("/results");for(var i=0;i<n.length;i++){if(i===n.length-1){if(!o.includes(n[i].refInvoice)){o=o+n[i].refInvoice+" "+"ไม่ต้องส่งของ แก้ไขเนื่องจาก"+" "+this.getView().getModel("baseModel").getProperty("/selectedReturnReason")+" "+"ส่งบิลที่นก"}else{o=o+" "+"ไม่ต้องส่งของ แก้ไขเนื่องจาก"+" "+this.getView().getModel("baseModel").getProperty("/selectedReturnReason")+" "+"ส่งบิลที่นก"}}else{if(!o.includes(n[i].refInvoice)){o=o+n[i].refInvoice+", "}}}if(e.getProperty("/contactDivision")!==undefined&&e.getProperty("/contactDivision")!==""){o=o+" "+e.getProperty("/contactDivision")+"ติดต่อ"}else{s.show(this.resourceBundle.getText("Contactdivisionmandatory"));return}if(e.getProperty("/contactPerson")!==undefined&&e.getProperty("/contactPerson")!==""){o=o+" "+e.getProperty("/contactPerson")}else{s.show(this.resourceBundle.getText("Contactpersonmandatory"));return}if(e.getProperty("/contactTelephone")!==undefined&&e.getProperty("/contactTelephone")!==""){o=o+" "+"Tel"+" "+e.getProperty("/contactTelephone")}else{s.show(this.resourceBundle.getText("ContactTelephonemandatory"));return}if(e.getProperty("/comment")!==undefined&&e.getProperty("/comment")!==""){o=o+" "+e.getProperty("/comment")}}else{if(this.ROtypeCode==="TG"||this.ROtypeCode==="TF"){var o="มีสินค้าเปลี่ยน รับคืนสินค้าเนื่องจาก"+this.getView().getModel("baseModel").getProperty("/selectedReturnReason")+" "+"ส่งสินค้าที่คุณ"}else{var o="มีสินค้าเปลี่ยน รับคืนสินค้าเนื่องจาก"+this.getView().getModel("baseModel").getProperty("/selectedReturnReason")+" "+"รับคืนที่คุณ"}if(e.getProperty("/contactPerson")!==undefined&&e.getProperty("/contactPerson")!==""){o=o+" "+e.getProperty("/contactPerson")+"แผนก"}else{s.show(this.resourceBundle.getText("Contactpersonmandatory"));return}if(e.getProperty("/contactDivision")!==undefined&&e.getProperty("/contactDivision")!==""){o=o+" "+e.getProperty("/contactDivision")}else{s.show(this.resourceBundle.getText("Contactdivisionmandatory"));return}if(e.getProperty("/contactTelephone")!==undefined&&e.getProperty("/contactTelephone")!==""){o=o+" "+"Tel"+" "+e.getProperty("/contactTelephone")}else{s.show(this.resourceBundle.getText("ContactTelephonemandatory"));return}if(e.getProperty("/comment")!==undefined&&e.getProperty("/comment")!==""){o=o+" "+e.getProperty("/comment")}}}if(o.length>250){s.show(this.resourceBundle.getText("Remarksexceedingmaxlength"))}if(this.getView().byId("ID_TAB_BAR_PROV_APP").getSelectedKey()==="Return"){this.getView().getModel("baseModel").setProperty("/returnRemark",o);this.getView().getModel("baseModel").setProperty("/remark",o);this.getView().getModel("baseModel").refresh()}else{this.getView().getModel("baseModel").setProperty("/exchangeRemark",o);this.getView().getModel("baseModel").setProperty("/remark",o);this.getView().getModel("baseModel").refresh()}this.Remark.close()}},onSelectSms:function(e){var t=e.getSource().getSelected();if(t===false){this.getView().getModel("baseModel").setProperty("/smsInputVisiblity",false)}else{this.getView().getModel("baseModel").setProperty("/smsInputVisiblity",true)}this.getView().getModel("baseModel").refresh()},liveSearchUsers:function(e){if(e.getParameters().newValue===undefined){var t=e.getParameters().query}else{var t=e.getParameters().newValue}var r=new Array;var s=new sap.ui.model.Filter([new sap.ui.model.Filter("userId",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("email",sap.ui.model.FilterOperator.Contains,t)]);r.push(s);var o=this.getView().byId("userListTableId").getBinding("items");o.filter(r)},onSelectDelivery:function(e){var t=e.getSource().getSelected();if(t===false){this.getView().getModel("baseModel").setProperty("/completedDeliveryFLAG","")}else{this.getView().getModel("baseModel").setProperty("/completedDeliveryFLAG","X")}this.getView().getModel("baseModel").refresh()},onSelectEmail:function(e){var t=e.getSource().getSelected();if(t===false){this.getView().getModel("baseModel").setProperty("/emailInputVisiblity",false)}else{this.getView().getModel("baseModel").setProperty("/emailInputVisiblity",true)}this.getView().getModel("baseModel").refresh()},onPressViewRemark:function(){var e=this.getView().getModel("baseModel");var t="";if(this.getView().byId("ID_TAB_BAR_PROV_APP").getSelectedKey()==="Return"){if(this.ROtypeCode==="TI"){var r="ไม่ต้องส่งของ เคลียร์ใบส่งของชั่วคราว"+" ";var o=this.getView().getModel("returnModel").getProperty("/results");for(var a=0;a<o.length;a++){if(a===o.length-1){if(!r.includes(o[a].refInvoice)){r=r+o[a].refInvoice+" "+"ส่งบิลที่แผนก "}else{r=r+" "+"ส่งบิลที่แผนก "}}else{if(!r.includes(o[a].refInvoice)){r=r+o[a].refInvoice+", "}}}if(e.getProperty("/contactDivision")!==undefined&&e.getProperty("/contactDivision")!==""){r=r+" "+e.getProperty("/contactDivision")+"ติดต่อ"}else{s.show(this.resourceBundle.getText("Contactdivisionmandatory"));return}if(e.getProperty("/contactPerson")!==undefined&&e.getProperty("/contactPerson")!==""){r=r+" "+e.getProperty("/contactPerson")}else{s.show(this.resourceBundle.getText("Contactpersonmandatory"));return}if(e.getProperty("/contactTelephone")!==undefined&&e.getProperty("/contactTelephone")!==""){r=r+" "+"Tel"+" "+e.getProperty("/contactTelephone")}else{s.show(this.resourceBundle.getText("ContactTelephonemandatory"));return}if(e.getProperty("/comment")!==undefined&&e.getProperty("/comment")!==""){r=r+" "+e.getProperty("/comment")}}else if(this.ROtypeCode==="TK"){var r="ใช้แทนบิล";var o=this.getView().getModel("returnModel").getProperty("/results");for(var a=0;a<o.length;a++){if(a===o.length-1){if(!r.includes(o[a].refInvoice)){r=r+o[a].refInvoice+" "+"ไม่ต้องส่งของ แก้ไขเนื่องจาก"+" "+this.getView().getModel("baseModel").getProperty("/selectedReturnReason")+"ส่งบิลที่"}else{r=r+" "+"ไม่ต้องส่งของ แก้ไขเนื่องจาก"+" "+this.getView().getModel("baseModel").getProperty("/selectedReturnReason")+"ส่งบิลที่"}}else{if(!r.includes(o[a].refInvoice)){r=r+o[a].refInvoice+", "}}}if(e.getProperty("/contactDivision")!==undefined&&e.getProperty("/contactDivision")!==""){r=r+" "+e.getProperty("/contactDivision")+"ติดต่อ"}else{s.show(this.resourceBundle.getText("Contactdivisionmandatory"));return}if(e.getProperty("/contactPerson")!==undefined&&e.getProperty("/contactPerson")!==""){r=r+" "+e.getProperty("/contactPerson")}else{s.show(this.resourceBundle.getText("Contactpersonmandatory"));return}if(e.getProperty("/contactTelephone")!==undefined&&e.getProperty("/contactTelephone")!==""){r=r+" "+"Tel"+" "+e.getProperty("/contactTelephone")}else{s.show(this.resourceBundle.getText("ContactTelephonemandatory"));return}if(e.getProperty("/comment")!==undefined&&e.getProperty("/comment")!==""){r=r+" "+e.getProperty("/comment")}}else{var r="สาเหตุการคืน."+" "+this.getView().getModel("baseModel").getProperty("/selectedReturnReason")+" "+"รับคืนสินค้าที่คุณ ";if(e.getProperty("/contactPerson")!==undefined&&e.getProperty("/contactPerson")!==""){r=r+" "+e.getProperty("/contactPerson")+"แผนก"}else{s.show(this.resourceBundle.getText("Contactpersonmandatory"));return}if(e.getProperty("/contactDivision")!==undefined&&e.getProperty("/contactDivision")!==""){r=r+" "+e.getProperty("/contactDivision")}else{s.show(this.resourceBundle.getText("Contactdivisionmandatory"));return}if(e.getProperty("/contactTelephone")!==undefined&&e.getProperty("/contactTelephone")!==""){r=r+" "+"Tel"+" "+e.getProperty("/contactTelephone")}else{s.show(this.resourceBundle.getText("ContactTelephonemandatory"));return}if(e.getProperty("/comment")!==undefined&&e.getProperty("/comment")!==""){r=r+" "+e.getProperty("/comment")}}}else{if(this.ROtypeCode==="TI"){var r="เคลียร์ใบส่งของชั่วคราว"+" ";var i=this.getView().getModel("returnModel").getProperty("/results");for(var a=0;a<i.length;a++){if(a===i.length-1){if(!r.includes(i[a].refInvoice)){r=r+i[a].refInvoice+" "+"ส่งบิลที่แผนก"}else{r=r+" "+"ส่งบิลที่แผนก"}}else{if(!r.includes(i[a].refInvoice)){r=r+i[a].refInvoice+", "}}}if(e.getProperty("/contactDivision")!==undefined&&e.getProperty("/contactDivision")!==""){r=r+" "+e.getProperty("/contactDivision")+"ติดต่อ"}else{s.show(this.resourceBundle.getText("Contactdivisionmandatory"));return}if(e.getProperty("/contactPerson")!==undefined&&e.getProperty("/contactPerson")!==""){r=r+" "+e.getProperty("/contactPerson")+"แผนก"}else{s.show(this.resourceBundle.getText("Contactpersonmandatory"));return}if(e.getProperty("/contactTelephone")!==undefined&&e.getProperty("/contactTelephone")!==""){r=r+" "+"Tel"+" "+e.getProperty("/contactTelephone")}else{s.show(this.resourceBundle.getText("ContactTelephonemandatory"));return}if(e.getProperty("/comment")!==undefined&&e.getProperty("/comment")!==""){r=r+" "+e.getProperty("/comment")}}else if(this.ROtypeCode==="TK"){var r="ใช้แทนบิล"+"  ";var i=this.getView().getModel("returnModel").getProperty("/results");for(var a=0;a<i.length;a++){if(a===i.length-1){if(!r.includes(i[a].refInvoice)){r=r+i[a].refInvoice+" "+"ไม่ต้องส่งของ แก้ไขเนื่องจาก"+" "+this.getView().getModel("baseModel").getProperty("/selectedReturnReason")+" "+"ส่งบิลที่นก"}else{r=r+" "+"ไม่ต้องส่งของ แก้ไขเนื่องจาก"+" "+this.getView().getModel("baseModel").getProperty("/selectedReturnReason")+" "+"ส่งบิลที่นก"}}else{if(!r.includes(i[a].refInvoice)){r=r+i[a].refInvoice+", "}}}if(e.getProperty("/contactDivision")!==undefined&&e.getProperty("/contactDivision")!==""){r=r+" "+e.getProperty("/contactDivision")+"ติดต่อ"}else{s.show(this.resourceBundle.getText("Contactdivisionmandatory"));return}if(e.getProperty("/contactPerson")!==undefined&&e.getProperty("/contactPerson")!==""){r=r+" "+e.getProperty("/contactPerson")}else{s.show(this.resourceBundle.getText("Contactpersonmandatory"));return}if(e.getProperty("/contactTelephone")!==undefined&&e.getProperty("/contactTelephone")!==""){r=r+" "+"Tel"+" "+e.getProperty("/contactTelephone")}else{s.show(this.resourceBundle.getText("ContactTelephonemandatory"));return}if(e.getProperty("/comment")!==undefined&&e.getProperty("/comment")!==""){r=r+" "+e.getProperty("/comment")}}else{if(this.ROtypeCode==="TG"||this.ROtypeCode==="TF"){var r="มีสินค้าเปลี่ยน รับคืนสินค้าเนื่องจาก"+this.getView().getModel("baseModel").getProperty("/selectedReturnReason")+" "+"ส่งสินค้าที่คุณ"}else{var r="มีสินค้าเปลี่ยน รับคืนสินค้าเนื่องจาก"+this.getView().getModel("baseModel").getProperty("/selectedReturnReason")+" "+"รับคืนที่คุณ"}if(e.getProperty("/contactPerson")!==undefined&&e.getProperty("/contactPerson")!==""){r=r+" "+e.getProperty("/contactPerson")+"แผนก"}else{s.show(this.resourceBundle.getText("Contactpersonmandatory"));return}if(e.getProperty("/contactDivision")!==undefined&&e.getProperty("/contactDivision")!==""){r=r+" "+e.getProperty("/contactDivision")}else{s.show(this.resourceBundle.getText("Contactdivisionmandatory"));return}if(e.getProperty("/contactTelephone")!==undefined&&e.getProperty("/contactTelephone")!==""){r=r+" "+"Tel"+" "+e.getProperty("/contactTelephone")}else{s.show(this.resourceBundle.getText("ContactTelephonemandatory"));return}if(e.getProperty("/comment")!==undefined&&e.getProperty("/comment")!==""){r=r+" "+e.getProperty("/comment")}}}if(r.length>250){s.show(this.resourceBundle.getText("Remarksexceedingmaxlength"))}this.getView().getModel("baseModel").setProperty("/remark",r);this.getView().getModel("baseModel").refresh()},onPressResetRemark:function(){var e=this.getView().getModel("baseModel");if(this.getView().byId("ID_TAB_BAR_PROV_APP").getSelectedKey()==="Exchange"&&this.ROtypeCode==="TI"){e.setProperty("/comment","ไม่ต้องส่งของ หรือ ส่งของเพิ่มบางส")}else{e.setProperty("/comment","")}e.setProperty("/contactTelephone","");e.setProperty("/contactDivision","");e.setProperty("/contactPerson","");e.setProperty("/remark","");e.refresh()},onCancelRemark:function(){var e=this.getView().getModel("baseModel");if(this.getView().byId("ID_TAB_BAR_PROV_APP").getSelectedKey()==="Return"){if(!e.getProperty("/returnRemark")){e.setProperty("/comment","");e.setProperty("/contactTelephone","");e.setProperty("/contactDivision","");e.setProperty("/contactPerson","");e.setProperty("/remark","");e.refresh();this.Remark.close()}else{this.Remark.close()}}else{if(!e.getProperty("/exchangeRemark")){e.setProperty("/comment","");e.setProperty("/contactTelephone","");e.setProperty("/contactDivision","");e.setProperty("/contactPerson","");e.setProperty("/remark","");e.refresh();this.Remark.close()}else{this.Remark.close()}}},personalizationInvDetails:function(e){if(!this.FilterPersonalization){this.FilterPersonalization=sap.ui.xmlfragment("dksh.connectclient.CreateReturn.Fragments.Personalization",this);this.getView().addDependent(this.FilterPersonalization)}if(e.getSource().getTooltip()===this.resourceBundle.getText("InvoicePersonalization")){this.currentStep="keyInvoice"}else if(e.getSource().getTooltip()===this.resourceBundle.getText("ReturnPersonalization")){this.currentStep="keyReturn"}else if(e.getSource().getTooltip()===this.resourceBundle.getText("ExchangePersonalization")){this.currentStep="keyExchange"}this._getPersonalizationDetails(this.currentStep);this.FilterPersonalization.open()},_getPersonalizationDetails:function(e,r){var s=this;var o=s.getView().getModel("PersonalizationModel");var a=new sap.ui.model.json.JSONModel;s.getView().setModel(a,"oModel");var i="Web";var n={"Content-Type":"application/json;charset=utf-8"};var l={userId:this.getView().getModel("baseModel").getProperty("/userId"),appId:e,runType:i,emailId:this.getView().getModel("baseModel").getData().email};a.loadData("/DKSHJavaService/variant/getVariant",JSON.stringify(l),true,"POST",false,false,n);a.attachRequestCompleted(function(t){if(t.getSource().getData().userPersonaDto!==null){if(r){if(e==="keyInvoice"){s.getView().getModel("PersonalizationModel").setProperty("/personalizationInvoiceData",t.getSource().getData())}else if(e==="keyExchange"){s.getView().getModel("PersonalizationModel").setProperty("/personalizationExchangeData",t.getSource().getData())}else if(e==="keyReturn"){s.getView().getModel("PersonalizationModel").setProperty("/personalizationReturnData",t.getSource().getData())}}else{var o=new sap.ui.model.json.JSONModel({results:t.getSource().getData()});if(e==="keyInvoice"){s.getView().getModel("PersonalizationModel").setProperty("/personalizationInvoiceData",t.getSource().getData())}else if(e==="keyExchange"){s.getView().getModel("PersonalizationModel").setProperty("/personalizationExchangeData",t.getSource().getData())}else if(e==="keyReturn"){s.getView().getModel("PersonalizationModel").setProperty("/personalizationReturnData",t.getSource().getData())}s.FilterPersonalization.setModel(o,"FilterPersonalization");s.FilterPersonalization.getModel("FilterPersonalization").setProperty("/enableCheckBox",false);s.FilterPersonalization.getModel("FilterPersonalization").setProperty("/selectVarVisible",true);s.FilterPersonalization.getModel("FilterPersonalization").setProperty("/nameVarVisible",false);s.getView().getModel("PersonalizationModel").refresh();s.FilterPersonalization.getModel("FilterPersonalization").setProperty("/okPersBtnVisible",true);s.FilterPersonalization.getModel("FilterPersonalization").setProperty("/savePersBtnVisible",false);s.FilterPersonalization.getModel("FilterPersonalization").setProperty("/cancelPersBtnVisible",true);s.FilterPersonalization.getModel("FilterPersonalization").setProperty("/deletePersBtnVisible",false);s.FilterPersonalization.getModel("FilterPersonalization").setProperty("/createPersBtnVisible",true);s.FilterPersonalization.getModel("FilterPersonalization").setProperty("/editPersBtnVisible",true);s.FilterPersonalization.getModel("FilterPersonalization").setProperty("/varinatNameValueState","None");s.FilterPersonalization.getModel("FilterPersonalization").refresh();s.FilterPersonalization.getModel("FilterPersonalization").setProperty("/results/action","")}}});a.attachRequestFailed(function(e){t.error(e.getSource().getData().message)})},onChangeCheckbox:function(e){var t=this.FilterPersonalization.getModel("FilterPersonalization").getData().results.userPersonaDto;var r=parseInt(e.getSource().getBindingContext("FilterPersonalization").getPath().split("/")[3]);if(e.getSource().getSelected()===true){for(var s=0;s<t.length;s++){if(s===r){t[s].status=true}if(this.FilterPersonalization.getModel("FilterPersonalization").getProperty("/results/action")==="Create"){t[s].id=""}this.selectedObjects=t}}else{for(var o=0;o<t.length;o++){if(o===r){t[o].status=false}}this.selectedObjects=t}},onChangeRetPO:function(e){var t=e.getSource().getValue();if(t.length>35){messageToast.show(this.resourceBundle.getText("maxLengthPO"));return}},onSelectvarian:function(e){var r=this;var o=this.getView().getModel("baseModel").getData().userId;var a=new sap.ui.model.json.JSONModel;r.getView().setModel(a,"oModel");if(e){var i=e.getSource().getSelectedKey()}else{var i=this.FilterPersonalization.getModel("FilterPersonalization").getData().results.currentVariant}var n={"Content-Type":"application/json;charset=utf-8"};var l="Web";if(sap.ui.Device.system.phone===true){l="Phone"}var d=new sap.m.BusyDialog;d.open();a.loadData("/DKSHJavaService/variant/getvariantLists/"+o+"/"+this.currentStep+"/"+i+"/"+l,true,"POST",false,false,n);a.attachRequestCompleted(function(e){d.close();var e=e.getSource().getData().userPersonaDto;if(r.FilterPersonalization.getModel("FilterPersonalization").getProperty("/results/action")==="Edit"){if(r.currentStep==="keyInvoice"){r.getView().getModel("PersonalizationModel").setProperty("/personalizationInvoiceData/userPersonaDto",e)}else if(r.currentStep==="keyExchange"){r.getView().getModel("PersonalizationModel").setProperty("/personalizationExchangeData/userPersonaDto",e)}else if(r.currentStep==="keyReturn"){r.getView().getModel("PersonalizationModel").setProperty("/personalizationReturnData/userPersonaDto",e)}r.FilterPersonalization.getModel("FilterPersonalization").setProperty("/results/userPersonaDto",e);r.FilterPersonalization.getModel("FilterPersonalization").refresh();r.getView().getModel("PersonalizationModel").refresh();if(r.FilterPersonalization.getModel("FilterPersonalization").getProperty("/results/currentVariant")==="Default"){r.FilterPersonalization.getModel("FilterPersonalization").setProperty("/results/action","");r.FilterPersonalization.getModel("FilterPersonalization").setProperty("/enableCheckBox",false);r.FilterPersonalization.getModel("FilterPersonalization").setProperty("/savePersBtnVisible",false);r.FilterPersonalization.getModel("FilterPersonalization").setProperty("/okPersBtnVisible",true);r.FilterPersonalization.getModel("FilterPersonalization").setProperty("/deletePersBtnVisible",false);r.FilterPersonalization.getModel("FilterPersonalization").setProperty("/selectVarVisible",true);r.FilterPersonalization.getModel("FilterPersonalization").setProperty("/nameVarVisible",false);s.show(this.resourceBundle.getText("Cannoteditdefaultvariant"));r.FilterPersonalization.getModel("FilterPersonalization").refresh()}}else{if(r.currentStep==="keyInvoice"){r.getView().getModel("PersonalizationModel").setProperty("/personalizationInvoiceData/userPersonaDto",e)}else if(r.currentStep==="keyExchange"){r.getView().getModel("PersonalizationModel").setProperty("/personalizationExchangeData/userPersonaDto",e)}else if(r.currentStep==="keyReturn"){r.getView().getModel("PersonalizationModel").setProperty("/personalizationReturnData/userPersonaDto",e)}r.FilterPersonalization.getModel("FilterPersonalization").setProperty("/results/userPersonaDto",e);r.FilterPersonalization.getModel("FilterPersonalization").refresh();r.getView().getModel("PersonalizationModel").refresh()}});a.attachRequestFailed(function(e){t.error(e.getSource().getData().message)})},onVariantSave:function(e){if(this.selectedObjects.length===0){s.show(this.resourceBundle.getText("Saveonlyafteredit"));return}var r=this;var o=new sap.ui.model.json.JSONModel;var a=e.getSource();var i=this.FilterPersonalization.getModel("FilterPersonalization");if(i.getProperty("/results/action")==="Create"){if(i.getData().newVariantName!==undefined&&i.getData().newVariantName!==""){for(var n=0;n<i.getData().results.variantName.length;n++){if(i.getData().results.variantName[n].name===i.getData().newVariantName){this.FilterPersonalization.getModel("FilterPersonalization").setProperty("/varinatNameValueState","Error");s.show(this.resourceBundle.getText("Newvariantnamecannotbesame"));return}}this.FilterPersonalization.getModel("FilterPersonalization").setProperty("/varinatNameValueState","None");var l=i.getData().newVariantName;for(var d=0;d<this.selectedObjects.length;d++){this.selectedObjects[d].variantId=l}}else{this.FilterPersonalization.getModel("FilterPersonalization").setProperty("/varinatNameValueState","Error");sap.m.MessageBox.error(this.resourceBundle.getText("EnterVariantName"));return}}var g=this.getView().getModel("baseModel").getData().userId;var p;var c={varaiantObject:this.selectedObjects,userId:g,applicationId:this.currentStep,varaintId:this.selectedObjects[0].variantId};var u={"Content-Type":"application/json;charset=utf-8"};var h="";var m=new sap.m.BusyDialog;m.open();o.loadData("/DKSHJavaService/variant/UpdateVariant",JSON.stringify(c),true,"PUT",false,false,u);o.attachRequestCompleted(function(e){m.close();r.selectedObjects=[];r.FilterPersonalization.close();sap.m.MessageBox.success(this.resourceBundle.getText("CreatedSuccessfully"),{actions:[sap.m.MessageBox.Action.OK],onClose:function(e){if(e===t.Action.OK){r._getPersonalizationDetails(r.currentStep,"Before")}}})});o.attachRequestFailed(function(e){t.error(e.getSource().getData().message)})},onVariantDelete:function(){var e=this;var r=this.getView().getModel("baseModel").getData().userId;var s=this.FilterPersonalization.getModel("FilterPersonalization").getProperty("/results/userPersonaDto");var o;var a={varaiantObject:s,userId:r,applicationId:this.currentStep,varaintId:this.FilterPersonalization.getModel("FilterPersonalization").getProperty("/results/userPersonaDto")[0].variantId};var i={"Content-Type":"application/json;charset=utf-8"};var n=new sap.ui.model.json.JSONModel;var l=new sap.m.BusyDialog;l.open();n.loadData("/DKSHJavaService/variant/deleteVariant",JSON.stringify(a),true,"DELETE",false,false,i);n.attachRequestCompleted(function(r){l.close();e.FilterPersonalization.close();sap.m.MessageBox.success(r.getSource().getData().name,{actions:[sap.m.MessageBox.Action.OK],onClose:function(r){if(r===t.Action.OK){e._getPersonalizationDetails(e.currentStep,"Before")}}})});n.attachRequestFailed(function(e){t.error(e.getSource().getData().name)})},onVariantCreate:function(){var e=this.FilterPersonalization.getModel("FilterPersonalization");e.setProperty("/results/action","Create");e.setProperty("/selectVarVisible",false);e.setProperty("/nameVarVisible",true);e.setProperty("/enableCheckBox",true);e.setProperty("/okPersBtnVisible",false);e.setProperty("/savePersBtnVisible",true);e.setProperty("/newVariantName","");var t=e.getData().results.userPersonaDto;for(var r=0;r<t.length;r++){t[r].status=false}e.setProperty("/results/userPersonaDto",t);this.FilterPersonalization.getModel("FilterPersonalization").refresh()},onVariantEdit:function(){var e=this.FilterPersonalization.getModel("FilterPersonalization");if(e.getData().results.currentVariant==="Default"){s.show(this.resourceBundle.getText("Cannoteditdefaultvariant"));return}e.setProperty("/results/action","Edit");this.FilterPersonalization.getModel("FilterPersonalization").setProperty("/okPersBtnVisible",false);e.setProperty("/enableCheckBox",true);e.setProperty("/savePersBtnVisible",true);e.setProperty("/deletePersBtnVisible",true);e.setProperty("/selectVarVisible",true);e.setProperty("/nameVarVisible",false);e.refresh();this.onSelectvarian();s.show(this.resourceBundle.getText("Selectavarianttoedit"))},onPersonlizationClose:function(){var e=this;var t=this.getView().getModel("PersonalizationModel");this.selectedObjects=[];this.FilterPersonalization.close()},onVariantOK:function(){var e=this;var t=this.getView().getModel("PersonalizationModel");var r=new sap.ui.model.json.JSONModel({results:this.getView().getModel("PersonalizationModel").getData()});this.FilterPersonalization.setModel(r,"FilterPersonalization");this.FilterPersonalization.getModel("FilterPersonalization").setProperty("/selectVarVisible",true);this.FilterPersonalization.getModel("FilterPersonalization").setProperty("/nameVarVisible",false);this.FilterPersonalization.getModel("FilterPersonalization").setProperty("/enableCheckBox",false);this.FilterPersonalization.getModel("FilterPersonalization").refresh();this.FilterPersonalization.getModel("FilterPersonalization").refresh();this.FilterPersonalization.getModel("FilterPersonalization").setProperty("/okPersBtnVisible",true);this.FilterPersonalization.getModel("FilterPersonalization").setProperty("/savePersBtnVisible",false);this.FilterPersonalization.getModel("FilterPersonalization").setProperty("/cancelPersBtnVisible",true);this.FilterPersonalization.getModel("FilterPersonalization").setProperty("/deletePersBtnVisible",false);this.FilterPersonalization.getModel("FilterPersonalization").setProperty("/createPersBtnVisible",true);this.FilterPersonalization.getModel("FilterPersonalization").setProperty("/editPersBtnVisible",true);this.FilterPersonalization.getModel("FilterPersonalization").setProperty("/varinatNameValueState","None");this.selectedObjects=[];this.getView().getModel("PersonalizationModel").refresh();this.FilterPersonalization.close()},onSelectItemsFromInvoice:function(e){var t=[];var r=e.getParameter("listItem").getBindingContext("invoiceSearchModel");if(e.getParameters().selected===true){if(e.getParameters().selectAll===true){t=e.getSource().getSelectedContexts()}if(e.getParameters().selectAll===false){t.push(r)}for(var o=0;o<t.length;o++){var a=0;if(this.selectedReturnItems.length===0&&parseInt(t[o].getObject().AvailRetQtySalesUn)>0&&t[o].getObject().ColorCode!=="R"){if(t[o].getObject().ActiveIndicator!=="X"){this.selectedReturnItems.push(t[o].getObject());this.selectedInvoice.push(t[o].getObject());this.getView().getModel("baseModel").setProperty("/returnShipTo",t[o].getObject().shipToAddress.partnerNum);this.getView().getModel("baseModel").setProperty("/shipToDesc",t[o].getObject().shipToAddress.partnerName);this.getView().getModel("baseModel").setProperty("/returnSoldTo",t[o].getObject().soldToAddress.partnerNum);this.getView().getModel("baseModel").setProperty("/returnSoldToDesc",t[o].getObject().soldToAddress.partnerName);this.getView().getModel("baseModel").setProperty("/returnBillTo",t[o].getObject().billToAdress.partnerNum);this.getView().getModel("baseModel").setProperty("/returnBillToDesc",t[o].getObject().billToAdress.partnerName);this.getView().getModel("baseModel").setProperty("/returnPayer",t[o].getObject().payerAddress.partnerNum);this.getView().getModel("baseModel").setProperty("/returnPayerDesc",t[o].getObject().payerAddress.partnerName)}else{++a;this.getView().byId("InvoiceTableId").getItems()[parseInt(t[o].sPath.split("/")[2])].setSelected(false);s.show(this.resourceBundle.getText("Returnnotallowed"))}}else if(this.selectedReturnItems.length>0){for(var i=0;i<this.selectedReturnItems.length;i++){if(parseInt(t[o].getObject().AvailRetQtySalesUn)>0&&this.selectedReturnItems[i].shipToParty===t[o].getObject().shipToParty&&this.selectedReturnItems[i].billToAdress.partnerNum===t[o].getObject().billToAdress.partnerNum&&this.selectedReturnItems[i].payerAddress.partnerNum===t[o].getObject().payerAddress.partnerNum&&t[o].getObject().ColorCode!=="R"){if(t[o].getObject().ActiveIndicator!=="X"){if(t[o].getObject().InvoiceLineItem===this.selectedReturnItems[i].InvoiceLineItem&&t[o].getObject().InvoiceNum===this.selectedReturnItems[i].InvoiceNum){++a;this.getView().byId("InvoiceTableId").getItems()[parseInt(t[o].sPath.split("/")[2])].setSelected(false);s.show(this.resourceBundle.getText("ItemisalreadyaddedtoReturns"))}else{}}else{s.show(this.resourceBundle.getText("Returnnotallowed"));++a;this.getView().byId("InvoiceTableId").getItems()[parseInt(t[o].sPath.split("/")[2])].setSelected(false)}}else{s.show(this.resourceBundle.getText("Itemcannotbeadded"));++a;this.getView().byId("InvoiceTableId").getItems()[parseInt(t[o].sPath.split("/")[2])].setSelected(false)}}if(a===0){this.selectedReturnItems.push(t[o].getObject());this.selectedInvoice.push(t[o].getObject())}}else{this.getView().byId("InvoiceTableId").getItems()[parseInt(t[o].sPath.split("/")[2])].setSelected(false);s.show(this.resourceBundle.getText("Itemcannotbeadded"))}}}else{if(e.getParameters().selectAll===false){if(this.getView().byId("InvoiceTableId").getSelectedItems().length===0){for(var n=this.selectedInvoice.length-1;n>=0;n--){for(var l=this.selectedReturnItems.length-1;l>=0;l--){if(this.selectedReturnItems.length>0){if(this.selectedInvoice[n].InvoiceLineItem===this.selectedReturnItems[l].InvoiceLineItem&&this.selectedInvoice[n].InvoiceNum===this.selectedReturnItems[l].InvoiceNum){this.selectedReturnItems.splice(l,1)}}else{break}}}this.selectedInvoice=[]}else{for(var l=this.selectedReturnItems.length-1;l>=0;l--){if(r.getObject().InvoiceLineItem===this.selectedReturnItems[l].InvoiceLineItem&&r.getObject().InvoiceNum===this.selectedReturnItems[l].InvoiceNum){this.selectedReturnItems.splice(l,1);this.selectedInvoice.splice(l,1)}}}}}if(this.selectedReturnItems.length>10){this.getView().getModel("baseModel").setProperty("/returnTableLength","60vh")}else{this.getView().getModel("baseModel").setProperty("/returnTableLength","")}},onPressReturn:function(){var e=this;var r=this.getView().getModel("returnModel").getProperty("/results");var o=[];var a;var i=0;if(this.getView().getModel("invoiceSearchModel").getProperty("/results")===""){t.information("Search invoice to procced")}else if(this.getView().getModel("invoiceSearchModel").getProperty("/results")!==""){if(this.selectedReturnItems.length>0){if(this.InvQtyCount>0){t.error(this.resourceBundle.getText("EnteredReturnedQtycannotbegreaterthanAvailableReturnQty"));return}e.getView().getModel("baseModel").setProperty("/disableSoldToParty",false);for(var n=0;n<this.selectedReturnItems.length;n++){i=i+parseFloat(this.selectedReturnItems[n].netAmount);a={refNum:"1234",itmNum:"001",matGrp:this.selectedReturnItems[n].MaterialGroup,matGrp4:this.selectedReturnItems[n].MaterialGroup4,itemRoType:"",roTypeDesc:"",material:this.selectedReturnItems[n].MaterialCode};o.push(a)}if(this._oPopover){this._oPopover=undefined}var l=[];var d=[];var g=0;for(var n=0;n<this.selectedInvoice.length;n++){if(this.selectedInvoice[n].HigherLvlItem!=="000000"){for(var p=0;p<this.selectedInvoice.length;p++){if(this.selectedInvoice[p].InvoiceNum===this.selectedInvoice[n].InvoiceNum&&this.selectedInvoice[p].ItemGroup===this.selectedInvoice[n].HigherLvlItem){if(this.selectedInvoice[p].HigherLvlItem==="000000"){g++}else{}}}}else{g++}}if(g===0){s.show(this.resourceBundle.getText("Selectparentitem"))}else{if(this.getView().getModel("baseModel").getProperty("/selectedROTypeCode")==="TI"||this.getView().getModel("baseModel").getProperty("/selectedROTypeCode")==="TK"){this._getSLoc()}else{this._ROType(o)}}}else{t.information(this.resourceBundle.getText("Selectatleastoneitem"))}}},_ROType:function(e){var t=this;var r={d:{refNum:"1234",roType:t.ROtypeCode,roTypeDesc:"",roTyMatchingToRoTyItem:{results:e}}};var s=this.getView().getModel("ZDKSH_CC_RETURNS_MANAGEMENT_SRV");var o="/DKSHODataService/sap/opu/odata/sap/ZDKSH_CC_RETURNS_MANAGEMENT_SRV/roTypeMatchingSet(refNum='5700000669')?$expand=roTyMatchingToRoTyItem&$format=json";var a="/DKSHODataService/sap/opu/odata/sap/ZDKSH_CC_RETURNS_MANAGEMENT_SRV/roTypeMatchingSet";var i=new sap.m.BusyDialog;i.open();var n;$.ajax({url:o,type:"GET",beforeSend:function(e){e.setRequestHeader("X-CSRF-Token","Fetch")},complete:function(e){n=e.getResponseHeader("X-CSRF-Token");$.ajax({url:a,method:"POST",async:true,data:JSON.stringify(r),beforeSend:function(e){e.setRequestHeader("X-CSRF-Token",n)},headers:{Accept:"application/json","Content-Type":"application/json"},success:function(e,r,s){i.close();if(e.d.roType==="TG"||e.d.roType==="TF"){t.ROtypeCode=e.d.roType;t.getView().getModel("baseModel").setProperty("/newSelectedROType",e.d.roTypeDesc);t.getView().getModel("baseModel").setProperty("/newSelectedROTypeCode",e.d.roType);t.getView().getModel("baseModel").refresh()}else{}t._getSLoc()},error:function(e,r,s){i.close();var o="";if(e.status===504){o=t.resourceBundle.getText("timeOut");t.errorMsg(o)}else{var a=e.responseJSON.error.innererror.errordetails;for(var n=0;n<a.length;n++){if(n<a.length-1){o=o+a[n].message}}t.errorMsg(o)}}})}})},_getOrderType:function(e,t,r){var s=this;var o=[];if(e===undefined&&t===undefined&&r===undefined){var a=this.getView().getModel("invoiceSearchModel").getProperty("/billingType");var i=this.getView().getModel("invoiceSearchModel").getProperty("/salesOrgNo").slice(0,2);var n=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("billingType",sap.ui.model.FilterOperator.EQ,a),new sap.ui.model.Filter("countryCode",sap.ui.model.FilterOperator.EQ,i),new sap.ui.model.Filter("roType",sap.ui.model.FilterOperator.EQ,this.ROtypeCode)],and:true})}else{var n=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("billingType",sap.ui.model.FilterOperator.EQ,a),new sap.ui.model.Filter("countryCode",sap.ui.model.FilterOperator.EQ,i),new sap.ui.model.Filter("roType",sap.ui.model.FilterOperator.EQ,r)],and:true})}o.push(n);var l=s.getView().getModel("ZDKSH_CC_RETURNS_MANAGEMENT_SRV");var d=new sap.m.BusyDialog;d.open();l.read("/billingTypeMappingSet",{filters:o,async:false,success:function(e,t){d.close();s.getView().getModel("baseModel").setProperty("/returnOrderType",e.results[0].returnOrderType);s.getView().getModel("baseModel").setProperty("/exchangeOrderType",e.results[0].exchangeOrderType);s._pricingSimulation(s.selectedReturnItems,"Returns")},error:function(e){d.close();var t=JSON.parse(e.responseText);t=t.error.message.value;s.errorMsg(t)}})},_pricingSimulation:function(e,s){var o=this;var a=o.getView().getModel("baseModel");var i=o.getView().getModel("returnModel");var n=o.getView().getModel("exchangeModel");var l=o.getView().getModel("invoiceSearchModel");var d="/DKSHODataService/sap/opu/odata/sap/ZDKSH_CC_RETURNS_ORDERCREATION_SRV/priceSimulationHeaderSet";var g;var p=[];if(s==="Returns"||s==="ReturnsTab"){g=this.getView().getModel("baseModel").getData().returnOrderType;var c="R"}else{g=this.getView().getModel("baseModel").getData().exchangeOrderType;var c="E"}for(var u=0;u<e.length;u++){if(s==="ReturnsTab"||s==="Exchange"||s==="ExchangeTab"||s==="ExchangeDelete"){if(e[u].avlRetQty===""){e[u].avlRetQty=e[u].quantity}if(e[u].unitPriceInv===""){e[u].unitPriceInv=e[u].unitPrice}if(e[u].listPrice!==undefined&&e[u].listPrice===""){e[u].listPrice="0.00"}if(e[u].expiryDate===null){e[u].expiryDate=""}if(e[u].storageLocation===null){e[u].storageLocation=""}if(e[u].itemVisibility===undefined||e[u].itemVisibility===null){e[u].itemVisibility="false"}if(e[u].expiryDate.includes("(")){var h=r.dateTimeFormatPS(e[u].expiryDate);var m=r.dateTimeFormatPS(e[u].billingDate)}else{var h=r.dateTimeFormat(e[u].expiryDate);var m=r.dateTimeFormat(e[u].billingDate)}if(e[u].manualFoc===null){e[u].manualFoc=""}if(e[u].expiryDate===""||e[u].billingDate===""){var y={refInvoice:e[u].refInvoice,refItemNumber:e[u].refItemNumber,matNumber:e[u].matNumber,quantity:e[u].quantity,salesUnit:e[u].salesUnit,unitPrice:e[u].unitPrice,materialGroup:e[u].materialGroup,materialGroup4:e[u].materialGroup4,avlRetQty:e[u].avlRetQty,billingQty:e[u].avlRetQty,baseUnit:e[u].salesUnit,batchNumber:e[u].batchNumber,storageLocation:e[u].storageLocation,serialNumber:e[u].serialNumber,unitPriceInv:e[u].unitPriceInv,listPrice:e[u].listPrice,active:e[u].active,manualFoc:e[u].manualFoc,itemVisibility:e[u].itemVisibility}}else{var y={refInvoice:e[u].refInvoice,refItemNumber:e[u].refItemNumber,matNumber:e[u].matNumber,quantity:e[u].quantity,salesUnit:e[u].salesUnit,unitPrice:e[u].unitPrice,materialGroup:e[u].materialGroup,materialGroup4:e[u].materialGroup4,avlRetQty:e[u].avlRetQty,billingQty:e[u].avlRetQty,baseUnit:e[u].salesUnit,batchNumber:e[u].batchNumber,expiryDate:h,storageLocation:e[u].storageLocation,serialNumber:e[u].serialNumber,billingDate:m,unitPriceInv:e[u].unitPriceInv,listPrice:e[u].listPrice,active:e[u].active,manualFoc:e[u].manualFoc,itemVisibility:e[u].itemVisibility}}}else{var P=r.dateTimeFormat(e[u].ExpiryDate);var f=r.dateTimeFormat(e[u].billingDateFrom);var y={refInvoice:e[u].InvoiceNum,refItemNumber:e[u].InvoiceLineItem,matNumber:e[u].MaterialCode,quantity:e[u].actualRetQty,salesUnit:e[u].actualRetUOM,unitPrice:e[u].UnitPrice,materialGroup:e[u].MaterialGroup,materialGroup4:e[u].MaterialGroup4,avlRetQty:e[u].AvailRetQtySalesUn,billingQty:e[u].BillingQty,baseUnit:e[u].BaseUnit,batchNumber:e[u].BatchNumber,expiryDate:P,serialNumber:e[u].SerialNum,billingDate:f,unitPriceInv:e[u].UnitPrice,listPrice:e[u].ListPrice,storageLocation:e[u].storageLocation,active:e[u].ActiveIndicator,itemVisibility:e[u].itemVisibility}}p.push(y)}if(s==="ReturnsTab"||s==="Returns"){var v={d:{orderType:g,distChannel:l.getData().distChnl,salesOrg:l.getData().salesOrgNo,division:l.getData().Division,soldToParty:a.getData().returnSoldTo,shipToParty:a.getData().returnShipTo,billToParty:a.getData().returnBillTo,payer:a.getData().returnPayer,roType:this.ROtypeCode,flag:c,navToPriceItem:{results:p},navToPriceConditions:{results:[]}}}}else{var v={d:{orderType:g,distChannel:l.getData().distChnl,salesOrg:l.getData().salesOrgNo,division:l.getData().Division,soldToParty:a.getData().exSoldTo,shipToParty:a.getData().exShipTo,billToParty:a.getData().exBillTo,payer:a.getData().exPayer,roType:this.ROtypeCode,flag:c,navToPriceItem:{results:p},navToPriceConditions:{results:[]}}}}var D=new sap.m.BusyDialog;D.open();var M="/DKSHODataService/sap/opu/odata/sap/ZDKSH_CC_RETURNS_ORDERCREATION_SRV/priceSimulationHeaderSet";var b;$.ajax({url:M,type:"GET",beforeSend:function(e){e.setRequestHeader("X-CSRF-Token","Fetch")},complete:function(e){b=e.getResponseHeader("X-CSRF-Token");$.ajax({url:d,method:"POST",async:true,data:JSON.stringify(v),beforeSend:function(e){e.setRequestHeader("X-CSRF-Token",b)},headers:{Accept:"application/json","Content-Type":"application/json"},success:function(e,l,d){D.close();if(s==="Returns"||s==="ReturnsDraft"){o._wizard.setCurrentStep(o.byId("ID_WIZARD_RTEX"));var g=a.getProperty("/selectedROTypeCode");var p=a.getProperty("/newSelectedROTypeCode");var c=a.getProperty("/newSelectedROType");if(a.getProperty("/requestor")===undefined||a.getProperty("/requestor")===""){a.setProperty("/requestor",r.concatenateStrings(a.getProperty("/userName"),a.getProperty("/phone")))}if(p){if(p==="TG"||p==="TF"){if(g!==p){a.setProperty("/selectedROTypeCode",p);a.setProperty("/selectedROType",c);o.getView().byId("RotypeSegementedBtnID").setSelectedKey(p);t.information(o.resourceBundle.getText("Specialmapping"))}}}if(o.docVersion==="SUCCESS"){a.setProperty("/previewBtnVisiblitys",true);a.setProperty("/submitBtnVisiblitys",false)}else{a.setProperty("/previewBtnVisiblitys",true);a.setProperty("/submitBtnVisiblitys",true)}var u=0;if(e.d.navToPriceConditions){for(var h=0;h<e.d.navToPriceConditions.results.length;h++){o.returnConditions.push(e.d.navToPriceConditions.results[h])}i.setProperty("/returnConditions",o.returnConditions)}for(var m=0;m<e.d.navToPriceItem.results.length;m++){if(e.d.navToPriceItem.results[m].deleted===undefined){e.d.navToPriceItem.results[m].deleted="false"}if(o.docVersion==="SUCCESS"){e.d.navToPriceItem.results[m].editQtyRet=false;e.d.navToPriceItem.results[m].editUOMRet=false;e.d.navToPriceItem.results[m].editSLocRet=false;e.d.navToPriceItem.results[m].editUPRet=false;e.d.navToPriceItem.results[m].editBatchRet=false;e.d.navToPriceItem.results[m].editSerialNoRet=false}else{if(a.getData().selectedROTypeCode==="TI"){e.d.navToPriceItem.results[m].editQtyRet=true;e.d.navToPriceItem.results[m].editUOMRet=true;e.d.navToPriceItem.results[m].editSLocRet=false;e.d.navToPriceItem.results[m].editUPRet=false;e.d.navToPriceItem.results[m].editBatchRet=false;e.d.navToPriceItem.results[m].editSerialNoRet=false}else if(a.getData().selectedROTypeCode==="TK"){e.d.navToPriceItem.results[m].editSLocRet=false;e.d.navToPriceItem.results[m].editUPRet=false;e.d.navToPriceItem.results[m].editBatchRet=false;e.d.navToPriceItem.results[m].editSerialNoRet=false;e.d.navToPriceItem.results[m].editQtyRet=false;e.d.navToPriceItem.results[m].editUOMRet=false}else{e.d.navToPriceItem.results[m].editSLocRet=true;e.d.navToPriceItem.results[m].editUPRet=true;e.d.navToPriceItem.results[m].editBatchRet=true;e.d.navToPriceItem.results[m].editSerialNoRet=true;e.d.navToPriceItem.results[m].editQtyRet=true;e.d.navToPriceItem.results[m].editUOMRet=true}}}o.returnItems=e.d.navToPriceItem.results;for(var h=o.returnItems.length-1;h>=0;h--){if(o.returnItems[h].deleted==="true"){o.returnItems.splice(h,1)}else{u=u+parseFloat(o.returnItems[h].netAmount)}}i.setProperty("/results",o.returnItems);a.setProperty("/originalReturnData",JSON.parse(JSON.stringify(o.returnItems)));i.setProperty("/returnLength","Returns ("+o.returnItems.length+")");i.setProperty("/returnAmountTotal",u.toFixed(2)+"(THB)");i.refresh();o.onResetSearchInvoice()}else if(s==="ReturnsTab"){var u=0;var y=0;var P=e.d.navToPriceItem.results;var f=i.getProperty("/results");for(var h=0;h<P.length;h++){for(var m=0;m<f.length;m++){if(P[h].refInvoice===f[m].refInvoice&&P[h].refItemNumber===f[m].refItemNumber){if(f[m].deleted==="false"){P[h].deleted="false"}else{P[h].deleted="true"}f[m]=P[h];if(a.getData().selectedROTypeCode==="TI"){f[m].editQtyRet=true;f[m].editUOMRet=true;f[m].editSLocRet=false;f[m].editUPRet=false;f[m].editBatchRet=false;f[m].editSerialNoRet=false}else if(a.getData().selectedROTypeCode==="TK"){f[m].editSLocRet=false;f[m].editUPRet=false;f[m].editBatchRet=false;f[m].editSerialNoRet=false;f[m].editQtyRet=false;f[m].editUOMRet=false}else{f[m].editSLocRet=true;f[m].editUPRet=true;f[m].editBatchRet=true;f[m].editSerialNoRet=true;f[m].editQtyRet=true;f[m].editUOMRet=true}}}}for(var m=0;m<f.length;m++){if(f[m].deleted==="false"){u=u+parseFloat(f[m].netAmount);++y}}i.setProperty("/results",f);a.setProperty("/originalReturnData",JSON.parse(JSON.stringify(f)));i.setProperty("/returnLength","Returns ("+y+")");i.setProperty("/returnAmountTotal",u.toFixed(2)+"(THB)");i.refresh();if(e.d.navToPriceConditions){for(var h=0;h<e.d.navToPriceConditions.results.length;h++){o.returnConditions.push(e.d.navToPriceConditions.results[h])}i.setProperty("/returnConditions",o.returnConditions)}}else if(s==="Exchange"){o.getView().byId("ID_TAB_BAR_PROV_APP").setSelectedKey("Exchange");a.setProperty("/exchangeTabVisiblity",true);var v=0;if(e.d.navToPriceConditions){o.exchangeConditions=e.d.navToPriceConditions.results;n.setProperty("/exchangeConditions",o.exchangeConditions)}o.exchangeItems=e.d.navToPriceItem.results;for(var m=0;m<o.exchangeItems.length;m++){v=v+parseFloat(o.exchangeItems[m].netAmount);if(o.exchangeItems[m].higherItem!=="000000"){o.exchangeItems[m].editable=false}else{o.exchangeItems[m].editable=true}o.exchangeItems[m].deleted="false";o.exchangeItems[m].FOCEnabled=false;if(o.exchangeItems[m].refInvoice===""){if(o.exchangeItems[m].higherItem!=="000000"){o.exchangeItems[m].FOCEnabled=false}else{o.exchangeItems[m].FOCEnabled=true}}else{o.exchangeItems[m].FOCEnabled=false}if(o.exchangeItems[m].manualFoc==="X"){if(o.docVersion==="SUCCESS"){o.exchangeItems[m].manualFOCCheck=true;o.exchangeItems[m].FOCEnabled=false}else{o.exchangeItems[m].manualFOCCheck=true;o.exchangeItems[m].FOCEnabled=true}}else{o.exchangeItems[m].manualFOCCheck=false}if(o.docVersion==="SUCCESS"){o.exchangeItems[m].editSLocEx=false;o.exchangeItems[m].editSerialNoEx=false;o.exchangeItems[m].editable=false;o.exchangeItems[m].editExqty=false;o.exchangeItems[m].editBatchEx=false}else{if(a.getData().selectedROTypeCode==="TI"){if(a.getProperty("/roTypeSLoc")){o.exchangeItems[m].storageLocation=a.getProperty("/roTypeSLoc")}if(o.exchangeItems[m].refInvoice!==""){o.exchangeItems[m].editSLocEx=false;o.exchangeItems[m].editSerialNoEx=true;o.exchangeItems[m].editBatchEx=true;o.exchangeItems[m].editBatchEx=true;o.exchangeItems[m].editable=false;o.exchangeItems[m].editExqty=false}else{o.exchangeItems[m].editSLocEx=true;o.exchangeItems[m].editSerialNoEx=true;o.exchangeItems[m].editBatchEx=true;o.exchangeItems[m].editable=false;o.exchangeItems[m].editExqty=false}}else if(a.getData().selectedROTypeCode==="TK"){if(a.getProperty("/roTypeSLoc")){o.exchangeItems[m].storageLocation=a.getProperty("/roTypeSLoc")}if(o.exchangeItems[m].refInvoice!==""){o.exchangeItems[m].editSLocEx=false;o.exchangeItems[m].editSerialNoEx=false;o.exchangeItems[m].editBatchEx=true}else{o.exchangeItems[m].editSLocEx=true;o.exchangeItems[m].editBatchEx=true}}else{o.exchangeItems[m].editSLocEx=true;o.exchangeItems[m].editSerialNoEx=true;o.exchangeItems[m].editBatchEx=true}}}n.setProperty("/results",o.exchangeItems);a.setProperty("/originalExchangeData",JSON.parse(JSON.stringify(o.exchangeItems)));n.setProperty("/exchangeLength","Exchange ("+o.exchangeItems.length+")");n.setProperty("/exchangeAmountTotal",v.toFixed(2)+"(THB)");n.refresh()}else if(s==="ExchangeTab"){var v=0;if(e.d.navToPriceConditions){o.exchangeConditions=e.d.navToPriceConditions.results;n.setProperty("/exchangeConditions",o.exchangeConditions)}var M=e.d.navToPriceItem.results;var b=n.getProperty("/results");for(var h=0;h<M.length;h++){v=v+parseFloat(M[h].netAmount);if(M[h].higherItem!=="000000"){M[h].editable=false}else{M[h].editable=true}if(M[h].refInvoice===""){if(M[h].higherItem!=="000000"){M[h].FOCEnabled=false}else{M[h].FOCEnabled=true}}else{M[h].FOCEnabled=false}if(M[h].manualFoc==="X"){if(o.docVersion==="SUCCESS"){M[h].manualFOCCheck=true;M[h].FOCEnabled=false}else{M[h].manualFOCCheck=true;M[h].FOCEnabled=true}}else{M[h].manualFOCCheck=false}M[h].deleted="false";if(a.getData().selectedROTypeCode==="TI"){if(M[h].refInvoice!==""){M[h].editSLocEx=false;M[h].editSerialNoEx=true;M[h].editable=false;M[h].editExqty=false}else{M[h].editSLocEx=true;M[h].editSerialNoEx=true;M[h].editable=false;M[h].editExqty=false}}else if(a.getData().selectedROTypeCode==="TK"){if(M[h].refInvoice!==""){M[h].editSLocEx=false;M[h].editSerialNoEx=false}else{M[h].editSLocEx=true;M[h].editSerialNoEx=false}}else{M[h].editSLocRet=true;M[h].editSerialNoRet=true}}n.setProperty("/results",M);a.setProperty("/originalExchangeData",JSON.parse(JSON.stringify(M)));n.setProperty("/exchangeLength","Exchange ("+M.length+")");n.setProperty("/exchangeAmountTotal",v.toFixed(2)+"(THB)");n.refresh()}else if(s==="ExchangeDelete"){var v=0;o.exchangeConditions=e.d.navToPriceConditions.results;n.setProperty("/exchangeConditions",o.exchangeConditions);var M=e.d.navToPriceItem.results;var b=n.getProperty("/results");for(var m=0;m<b.length;m++){for(var h=0;h<M.length;h++){v=v+parseFloat(M[h].netAmount);M[h].deleted="false";if(M[h].higherItem!=="000000"){M[h].editable=false}else{M[h].editable=true}if(M[h].refInvoice===b[m].refInvoice&&M[h].refItemNumber===b[m].refItemNumber){M[h].deleted="false";b[m]=M[h]}else if(M[h].refInvoice===b[m].refInvoice&&M[h].refItemNumber==="000000"){M[h].deleted="false";b[m]=M[h]}}}n.setProperty("/results",b);a.setProperty("/originalExchangeData",JSON.parse(JSON.stringify(M)));n.setProperty("/exchangeLength","Exchange ("+M.length+")");n.setProperty("/exchangeAmountTotal",v.toFixed(2)+"(THB)");n.refresh()}},error:function(e,r,s){D.close();var a="";if(e.status===504){a=o.resourceBundle.getText("timeOut");a="Request timed-out. Please try again using different search filters or add more search filters.";t.error(a)}else{var i="";var n="";var l=e.responseJSON.error.innererror.errordetails;for(var d=0;d<l.length;d++){if(l[d].severity==="warning"){i=i+" "+l[d].message}else{n=n+" "+l[d].message}}sap.m.MessageBox.error(i,{title:"Error",id:"messageBoxId2",details:n,contentWidth:"100px"})}}})}})},selectUom:function(e){var t=this;var r=[];if(this.getView().byId("ID_TAB_BAR_PROV_APP").getSelectedKey()==="Return"&&!this.UOMIndex.getObject().MaterialCode){this.getView().getModel("returnModel").getData().results[parseInt(this.UOMIndex.getPath().split("/")[2])].salesUnit=e.getParameters().selectedContexts[0].getObject().alternateUom;var s=this.UOMIndex.getObject();var o=this.getView().getModel("returnModel").getProperty("/results");for(var a=0;a<o.length;a++){if(o[a].refInvoice===s.refInvoice){r.push(o[a])}}var i=this.getView().getModel("returnModel").getProperty("/returnConditions");for(var a=i.length-1;a>=0;a--){if(i[a].refInvoice===s.refInvoice){i.splice(a,1)}}this.getView().getModel("returnModel").setProperty("/returnConditions",i);this._pricingSimulation(r,"ReturnsTab");this.getView().getModel("returnModel").refresh()}else if(this.getView().byId("ID_TAB_BAR_PROV_APP").getSelectedKey()==="Exchange"){this.getView().getModel("exchangeModel").getData().results[parseInt(this.UOMIndex.getPath().split("/")[2])].salesUnit=e.getParameters().selectedContexts[0].getObject().alternateUom;this.currentObject=this.UOMIndex.getObject();var n=parseInt(this.UOMIndex.getPath().split("/")[2]);var l=this.getView().getModel("exchangeModel").getProperty("/results");for(var a=0;a<l.length;a++){if(l[a].refInvoice===""&&l[a].higherItem!=="000000"&&l[a].manualFoc!=="X"&&l[a].higherItem!==""){}else{r.push(l[a])}}this._pricingSimulation(r,"ExchangeTab");this.getView().getModel("exchangeModel").refresh()}else{this.getView().getModel("invoiceSearchModel").getData().results[parseInt(this.UOMIndex.getPath().split("/")[2])].actualRetUOM=e.getParameters().selectedContexts[0].getObject().alternateUom;var s=this.UOMIndex.getObject();this.getView().getModel("invoiceSearchModel").refresh()}},onChangeRetQTY:function(e){this.RetQtyCount=0;var r=[];var s=this.getView().getModel("baseModel").getProperty("/originalReturnData");var o=e.getSource().getBindingContext("returnModel").getObject();var a=this.getView().getModel("returnModel").getProperty("/results");if(o.quantity===""){t.information(this.resourceBundle.getText("Quantitycannotbeempty"));return}for(var i=0;i<s.length;i++){if(s[i].refInvoice===o.refInvoice&&s[i].refItemNumber===o.refItemNumber){if(parseFloat(o.quantity)>parseFloat(s[i].avlRetQty)){++this.RetQtyCount;t.error(this.resourceBundle.getText("EnteredReturnedQtycannotbegreaterthanAvailableReturnQty"))}else{if(this.RetQtyCount>0){--this.RetQtyCount}for(var n=0;n<a.length;n++){if(a[n].refInvoice===o.refInvoice&&a[n].deleted==="false"){r.push(a[n])}}var l=this.getView().getModel("returnModel").getProperty("/returnConditions");for(var n=l.length-1;n>=0;n--){if(l[n].refInvoice===o.refInvoice){l.splice(n,1)}}this.getView().getModel("returnModel").setProperty("/returnConditions",l);this._pricingSimulation(r,"ReturnsTab")}}}},onChangeInvQty:function(e){this.InvQtyCount=0;var r=this.getView().getModel("baseModel").getProperty("/originalInvoiceData");var s=e.getSource().getBindingContext("invoiceSearchModel").getObject();for(var o=0;o<r.length;o++){if(r[o].InvoiceNum===s.InvoiceNum&&r[o].InvoiceLineItem===s.InvoiceLineItem){if(parseFloat(s.actualRetQty)>parseFloat(r[o].actualRetQty)){++this.InvQtyCount;t.error(this.resourceBundle.getText("EnteredReturnedQtycannotbegreaterthanAvailableReturnQty"))}}}},onChangeExcQty:function(e){var r=[];var s=this.getView().getModel("baseModel").getProperty("/originalExchangeData");var o=e.getSource().getBindingContext("exchangeModel").getObject();var a=this.getView().getModel("exchangeModel").getProperty("/results");if(o.quantity===""){t.information(this.resourceBundle.getText("Quantitycannotbeempty"))}else{for(var i=0;i<a.length;i++){if(a[i].deleted==="false"){if(a[i].refInvoice===""&&a[i].higherItem!=="000000"&&a[i].manualFoc!=="X"&&a[i].higherItem!==""){}else{r.push(a[i])}}}this._pricingSimulation(r,"ExchangeTab")}},onAddFOC:function(e){var r=[];var s=this.getView().getModel("baseModel").getProperty("/originalExchangeData");var o=parseInt(e.getSource().getBindingContext("exchangeModel").sPath.split("/")[2]);var a=e.getSource().getBindingContext("exchangeModel").getObject();var i=this.getView().getModel("exchangeModel").getProperty("/results");if(i.length===1){if(e.getSource().getSelected()===true){e.getSource().setSelected(false);t.information(this.resourceBundle.getText("CannotaddmanualFOC"))}}else{var n=e.getSource().getSelected();if(n===false){a.manualFoc=""}else{a.manualFoc="X"}for(var l=0;l<i.length;l++){if(i[l].deleted==="false"){if(i[l].refInvoice===""&&i[l].higherItem!=="000000"&&i[l].higherItem!==""&&i[l].manualFoc!=="X"&&o!==l){}else{r.push(i[l])}}}this._pricingSimulation(r,"ExchangeTab")}},onChangeUnitPrice:function(e){this.RetUPCount=0;var t=[];var r=this.getView().getModel("baseModel").getProperty("/originalReturnData");var o=e.getSource().getBindingContext("returnModel").getObject();var a=this.getView().getModel("returnModel").getProperty("/results");if(parseFloat(o.unitPrice)<parseFloat(o.unitPriceInv)){s.show(this.resourceBundle.getText("UnitPriceValidation"))}for(var i=0;i<a.length;i++){if(a[i].refInvoice===o.refInvoice&&a[i].deleted==="false"){t.push(a[i])}}var n=this.getView().getModel("returnModel").getProperty("/returnConditions");for(var i=n.length-1;i>=0;i--){if(n[i].refInvoice===o.refInvoice){n.splice(i,1)}}this.getView().getModel("returnModel").setProperty("/returnConditions",n);this._pricingSimulation(t,"ReturnsTab")},onChangeExcUP:function(e){this.ExcUPCount=0;var t=[];var r=this.getView().getModel("baseModel").getProperty("/originalExchangeData");var o=e.getSource().getBindingContext("exchangeModel").getObject();var a=this.getView().getModel("exchangeModel").getProperty("/results");if(parseFloat(o.unitPrice)<parseFloat(o.unitPriceInv)){s.show(this.resourceBundle.getText("UnitPriceValidation"))}for(var i=0;i<a.length;i++){if(a[i].deleted==="false"){if(a[i].refInvoice===""&&a[i].higherItem!=="000000"&&a[i].manualFoc!=="X"&&a[i].higherItem!==""){}else{t.push(a[i])}}}this._pricingSimulation(t,"ExchangeTab")},onTabSelection:function(e){if(this._oPopover){this._oPopover=undefined}var t=this.getView().getModel("baseModel");t.setProperty("/comment","");t.setProperty("/contactTelephone","");t.setProperty("/contactDivision","");t.setProperty("/contactPerson","");t.setProperty("/remark","");t.refresh()},onCopyItemsToExchange:function(){var e=this;if(this._oPopover){this._oPopover=undefined}if(this.RetQtyCount>0){t.information("Entered Qty cannot be greater than Available Return Qty In Returns");return}var r=this.getView().getModel("baseModel").getProperty("/smsInputVisiblity");var o=this.getView().getModel("baseModel").getProperty("/emailInputVisiblity");if(r===true&&(this.getView().getModel("baseModel").getProperty("/phoneNum")===""||this.getView().getModel("baseModel").getProperty("/phoneNum")===undefined)){s.show(this.resourceBundle.getText("EnterPhoneNumber"));return}if(o===true&&(this.getView().getModel("baseModel").getProperty("/userEmailId")===""||this.getView().getModel("baseModel").getProperty("/userEmailId")===undefined)){s.show(this.resourceBundle.getText("EnterEmailId"));return}if(this.getView().getModel("baseModel").getProperty("/reasonOwner")===""||this.getView().getModel("baseModel").getProperty("/reasonOwner")===undefined){s.show(this.resourceBundle.getText("ReasonOwnerisMandatory"));return}if(this.getView().getModel("baseModel").getProperty("/referenceNo")===""||this.getView().getModel("baseModel").getProperty("/referenceNo")===undefined){s.show(this.resourceBundle.getText("referenceNoisMandatory"));return}var a=[];var i=this.getView().getModel("returnModel").getData().results;var n=0;for(var l=0;l<i.length;l++){if(i[l].deleted==="false"){if(i[l].active!=="E"){n=n+parseFloat(i[l].netAmount);a.push(JSON.parse(JSON.stringify(i[l])));if(this.getView().getModel("baseModel").getData().selectedROTypeCode==="TI"||this.getView().getModel("baseModel").getData().selectedROTypeCode==="TK"){}else{}}else{s.show(this.resourceBundle.getText("exchangenotallowed"))}}}if(a.length>0){for(var l=0;l<a.length;l++){a[l].storageLocation="";a[l].batchNumber="";a[l].serialNumber="";a[l].manualFoc=""}this.selectedItemsforDelete=[];this.deletedItem=[];var d=this.getView().getModel("baseModel");d.setProperty("/comment","");d.setProperty("/contactTelephone","");d.setProperty("/contactDivision","");d.setProperty("/contactPerson","");d.setProperty("/remark","");d.setProperty("/exSoldTo",d.getProperty("/returnSoldTo"));d.setProperty("/exSoldToDesc",d.getProperty("/returnSoldToDesc"));d.setProperty("/exShipTo",d.getProperty("/returnShipTo"));d.setProperty("/exShipToDesc",d.getProperty("/shipToDesc"));d.setProperty("/exBillTo",d.getProperty("/returnBillTo"));d.setProperty("/exBillToDesc",d.getProperty("/returnBillToDesc"));d.setProperty("/exPayer",d.getProperty("/returnPayer"));d.setProperty("/exPayerDesc",d.getProperty("/returnPayerDesc"));d.refresh();this._pricingSimulation(a,"Exchange");if(this.getView().getModel("baseModel").getProperty("/exchangeTabVisiblity")===false){this._getPersonalizationDetails("keyExchange","Before");this.getView().getModel("baseModel").setProperty("/exchangeTabVisiblity",true)}this.getView().getModel("baseModel").setProperty("/exchangeTabVisiblity",true);this.getView().getModel("baseModel").refresh();if(a.length>10){this.getView().getModel("baseModel").setProperty("/exchangeTableLength","60vh")}else{this.getView().getModel("baseModel").setProperty("/exchangeTableLength","")}}else{if(this.getView().getModel("baseModel").getProperty("/exchangeTabVisiblity")===false){this._getPersonalizationDetails("keyExchange","Before")}var d=this.getView().getModel("baseModel");this.getView().getModel("baseModel").setProperty("/exchangeTabVisiblity",true);d.setProperty("/exSoldTo",d.getProperty("/returnSoldTo"));d.setProperty("/exSoldToDesc",d.getProperty("/returnSoldToDesc"));d.setProperty("/exShipTo",d.getProperty("/returnShipTo"));d.setProperty("/exShipToDesc",d.getProperty("/shipToDesc"));d.setProperty("/exBillTo",d.getProperty("/returnBillTo"));d.setProperty("/exBillToDesc",d.getProperty("/returnBillToDesc"));d.setProperty("/exPayer",d.getProperty("/returnPayer"));d.setProperty("/exPayerDesc",d.getProperty("/returnPayerDesc"));d.refresh();this.getView().byId("ID_TAB_BAR_PROV_APP").setSelectedKey("Exchange");this.getView().getModel("baseModel").refresh()}if(this._oPopover){this._oPopover=undefined}this._shipToDropdown()},valueHelpRequestShipTo:function(e){var t=this;var r=this.getView().getModel("invoiceSearchModel");var s=this.getView().getModel("baseModel");t.ShipTO=sap.ui.xmlfragment("dksh.connectclient.CreateReturn.Fragments.ShipTO",t);t.getView().addDependent(t.ShipTO);var o=this.getView().getModel("ZDKSH_CC_DAC_SOLDTOPARTY_SRV");var a=[];var i=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("CustCode",sap.ui.model.FilterOperator.EQ,s.getProperty("/exSoldTo")),new sap.ui.model.Filter("SalesOrg",sap.ui.model.FilterOperator.EQ,r.getProperty("/salesOrgNo")),new sap.ui.model.Filter("DistChnl",sap.ui.model.FilterOperator.EQ,r.getProperty("/distChnl")),new sap.ui.model.Filter("Division",sap.ui.model.FilterOperator.EQ,r.getProperty("/Division"))],and:true});a.push(i);var n=new sap.m.BusyDialog;n.open();o.read("/ShipToPartySet",{async:false,filters:a,success:function(e,r){n.close();var s=new sap.ui.model.json.JSONModel({results:e.results});t.ShipTO.setModel(s,"shipToModel");t.ShipTO.open()},error:function(e){n.close();var r="";if(e.statusCode===504){r=t.resourceBundle.getText("timeOut");t.errorMsg(r)}else{r=JSON.parse(e.responseText);r=r.error.message.value;t.errorMsg(r)}}})},valueHelpRequestBillTo:function(e){var t=this;var r=this.getView().getModel("invoiceSearchModel");var s=this.getView().getModel("baseModel");t.BillTo=sap.ui.xmlfragment("dksh.connectclient.CreateReturn.Fragments.BillTo",t);t.getView().addDependent(t.BillTo);var o=this.getView().getModel("ZDKSH_CC_DAC_SOLDTOPARTY_SRV");var a=[];var i=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("CustCode",sap.ui.model.FilterOperator.EQ,s.getProperty("/exSoldTo")),new sap.ui.model.Filter("SalesOrg",sap.ui.model.FilterOperator.EQ,r.getProperty("/salesOrgNo")),new sap.ui.model.Filter("DistChnl",sap.ui.model.FilterOperator.EQ,r.getProperty("/distChnl")),new sap.ui.model.Filter("Division",sap.ui.model.FilterOperator.EQ,r.getProperty("/Division"))],and:true});a.push(i);var n=new sap.m.BusyDialog;n.open();o.read("/BillToPartySet",{async:false,filters:a,success:function(e,r){n.close();var s=new sap.ui.model.json.JSONModel({results:e.results});t.BillTo.setModel(s,"billToModel");t.BillTo.open()},error:function(e){n.close();var r="";if(e.statusCode===504){r=t.resourceBundle.getText("timeOut");t.errorMsg(r)}else{r=JSON.parse(e.responseText);r=r.error.message.value;t.errorMsg(r)}}})},valueHelpRequestPayer:function(e){var t=this;var r=this.getView().getModel("invoiceSearchModel");var s=this.getView().getModel("baseModel");t.Payer=sap.ui.xmlfragment("dksh.connectclient.CreateReturn.Fragments.Payer",t);t.getView().addDependent(t.Payer);var o=this.getView().getModel("ZDKSH_CC_DAC_SOLDTOPARTY_SRV");var a=[];var i=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("CustCode",sap.ui.model.FilterOperator.EQ,s.getProperty("/exSoldTo")),new sap.ui.model.Filter("SalesOrg",sap.ui.model.FilterOperator.EQ,r.getProperty("/salesOrgNo")),new sap.ui.model.Filter("DistChnl",sap.ui.model.FilterOperator.EQ,r.getProperty("/distChnl")),new sap.ui.model.Filter("Division",sap.ui.model.FilterOperator.EQ,r.getProperty("/Division"))],and:true});a.push(i);var n=new sap.m.BusyDialog;n.open();o.read("/PayerSet",{async:false,filters:a,success:function(e,r){n.close();var s=new sap.ui.model.json.JSONModel({results:e.results});t.Payer.setModel(s,"payerModel");t.Payer.open()},error:function(e){n.close();var r="";if(e.statusCode===504){r=t.resourceBundle.getText("timeOut");t.errorMsg(r)}else{r=JSON.parse(e.responseText);r=r.error.message.value;t.errorMsg(r)}}})},_loadCity:function(e){var t=this;var r=this.getView().getModel("invoiceSearchModel");var s=this.getView().getModel("ZDKSH_CC_RETURNS_MANAGEMENT_SRV");var o=[];var a=this.selectedReturnItems;if(a[0].soldToAddress){var i=a[0].soldToAddress.language}else{var i=this.getView().getModel("baseModel").getProperty("/invRetLanguage")}var n="";if(i==="TH"||i==="2"){n="2"}else{n="E"}var l=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("salesOrg",sap.ui.model.FilterOperator.EQ,r.getProperty("/salesOrgNo")),new sap.ui.model.Filter("languageKey",sap.ui.model.FilterOperator.EQ,n)],and:true});o.push(l);var d=new sap.m.BusyDialog;d.open();s.read("/cityLookupSet",{async:false,filters:o,success:function(e,r){d.close();var s=new sap.ui.model.json.JSONModel({results:e.results});t.getView().setModel(s,"cityModel")},error:function(e){d.close();var r="";if(e.statusCode===504){r=t.resourceBundle.getText("timeOut");t.errorMsg(r)}else{r=JSON.parse(e.responseText);r=r.error.message.value;t.errorMsg(r)}}})},onCityChange:function(e){var t=e.getSource().getSelectedItem().getBindingContext("cityModel").getObject();this.getView().getModel("baseModel").setProperty("/invCountry",t.country);this.getView().getModel("baseModel").setProperty("/invLanguage",t.languageKey);this.getView().getModel("baseModel").setProperty("/invRegion",t.region)},_shipToDropdown:function(e){var t=this,r=this.getView().getModel("baseModel").getData(),s=[];s.push(new sap.ui.model.Filter("CustCode",sap.ui.model.FilterOperator.EQ,this.getView().getModel("invoiceSearchModel").getData().soldToParty));s.push(new sap.ui.model.Filter("Distchl",sap.ui.model.FilterOperator.EQ,t.distrChannelDataAccess));s.push(new sap.ui.model.Filter("Division",sap.ui.model.FilterOperator.EQ,t.divisionDataAccess));s.push(new sap.ui.model.Filter("SalesOrg",sap.ui.model.FilterOperator.EQ,t.salesOrgDataAccess));s.push(new sap.ui.model.Filter("languageID",sap.ui.model.FilterOperator.EQ,this.getView().getModel("baseModel").getProperty("/languageID")));var o=this.getView().getModel("ZDKSH_CC_DAC_SOLDTOPARTY_SRV");var a=new sap.m.BusyDialog;a.open();o.read("/ZSoldToPartySH",{async:false,filters:s,success:function(e,r){a.close();var s=new sap.ui.model.json.JSONModel({results:e.results});t.getView().setModel(s,"shipToListSet")},error:function(e){a.close();var r="";if(e.statusCode===504){r=t.resourceBundle.getText("timeOut");t.errorMsg(r)}else{r=JSON.parse(e.responseText);r=r.error.message.value;t.errorMsg(r)}}})},onSelectReturnReason:function(e){if(this.getView().getModel("baseModel").getProperty("/selectedROType")===undefined||this.getView().getModel("baseModel").getProperty("/selectedROType")===""){s.show(this.resourceBundle.getText("SelectROTypefirst"));this.getView().getModel("baseModel").setProperty("/selectedReturnReason","")}else{this.retReasonCode=e.getSource().getSelectedKey();this.getView().getModel("baseModel").setProperty("/step1Validation",true);this.getView().byId("RotypeSegementedBtnID").setEnabled(false);this.getView().getModel("baseModel").setProperty("/enableReturnReason",true);this._getReasonOwner();var t=this.getView().getModel("invoiceSearchModel");var r=this.getView().getModel("baseModel");t.setProperty("/salesOrgNo",r.getData().selectedSalesOrg);t.setProperty("/salesOrgDesc",r.getData().selectedSalesOrgDesc);t.setProperty("/distChnl",r.getData().selectedDistChl);t.setProperty("/distChnlDesc",r.getData().selectedDistChlDesc);t.setProperty("/soldToParty",r.getData().selectedSoldtoParty);t.setProperty("/soldToPartyDesc",r.getData().selectedSoldtoPartyDesc);this._wizard.setCurrentStep(this.byId("ID_WIZARD_SEL_CUST"))}},valueHelpRequestSalesOrg:function(){var e=this;if(e.salesOrgDataAccess==="No Access"){s.show(this.resourceBundle.getText("NoDataAccess"))}else{this.salesOrg.open()}},handleWizardCancel:function(){var e=this;sap.m.MessageBox.confirm(this.resourceBundle.getText("progress"),{onClose:function(r){if(r===t.Action.OK){e._discardChanges();e._wizard.discardProgress(e._wizard.getSteps()[0]);var s=sap.ui.core.UIComponent.getRouterFor(e);s.navTo("DraftRecord")}}})},_discardChanges:function(){var e=this;this.discard=true;this.selectedRetObjects=[];this.returnItems=[];this.returnConditions=[];this.exchangeItems=[];this.exchangeConditions=[];this.selectedObjects=[];var t=[];this.changeSoldToParty=undefined;this.getView().byId("RotypeSegementedBtnID").setEnabled(true);var r=new sap.ui.model.json.JSONModel;this.getView().setModel(r,"exchangeModel");var s=new sap.ui.model.json.JSONModel;this.getView().setModel(s,"returnModel");this.getView().getModel("returnModel").setProperty("/attachmentObject",t);var o=new sap.ui.model.json.JSONModel;this.getView().setModel(o,"baseModel");var o=this.getView().getModel("baseModel");var a=new sap.ui.model.json.JSONModel;this.getView().setModel(a,"invoiceSearchModel");var i=new sap.ui.model.json.JSONModel;this.getView().setModel(i,"PersonalizationModel");o.setProperty("/enableReturnReason",true);this.docVersion=undefined;e.docVersion=undefined;o.setProperty("/step1Validation",false);o.setProperty("/step2Validation",false);o.setProperty("/step3Validation",false);o.setProperty("/step4Validation",false);o.setProperty("/step5Validation",false);o.setProperty("/phone","");this.getView().byId("RotypeSegementedBtnID").setSelectedKey("");this.getView().byId("RotypeSegementedBtnID").setSelectedButton("None");this._wizard=this.byId("ID_WIZARD_RETURN");this._oNavContainer=this.byId("ID_RETURN_NAVCON");this._oWizardContentPage=this.byId("ID_RETURN_PAGE");o.setProperty("/cancelBtnVisiblitys",true);o.setProperty("/submitBtnVisiblitys",false);this.getView().getModel("baseModel").setProperty("/EXaddressVisiblity",false);this.getView().getModel("baseModel").setProperty("/addressFieldEnable",true);o.setProperty("/EXOneTimeCustomer","");o.setProperty("/oneTimeCustomer","");o.setProperty("/previewBtnVisiblitys",false);o.setProperty("/exchangeBtnVisiblitys",false);o.setProperty("/saveAsDraftBtnVisiblitys",true);o.setProperty("/addressVisiblity",false);o.setProperty("/billingTypeEnable",true);o.setProperty("/salesOrgEditable",true);o.setProperty("/distChnlEditable",true);o.setProperty("/exchangeTabVisiblity",false);o.setProperty("/smsInputVisiblity",false);o.setProperty("/emailInputVisiblity",false);o.setProperty("/commentsLength",2);o.setProperty("/attachmentLength",0);o.setProperty("/referenceNo","");o.setProperty("/reasonOwner","");o.setProperty("/customerPONumber","");o.setProperty("/customerPONumberEx","");o.setProperty("/selectedSalesOrg","");o.setProperty("/selectedSalesOrgDesc","");o.setProperty("/selectedDistChnl","");o.setProperty("/selectedDistChlDesc","");o.setProperty("/selectedSoldtoParty","");o.setProperty("/selectedSoldtoPartyDesc","");o.setProperty("/completedDelivery",false);o.setProperty("/selectedReturnReason","");o.setProperty("/phoneNumFlag",false);o.setProperty("/emailFlag",false);o.setProperty("/phoneNum","");o.setProperty("/userEmailId","");o.setProperty("/retDivEditablity",true);o.setProperty("/retSalesOrgEditablity",true);o.setProperty("/retDistChnlEditablity",true);o.setProperty("/saveAsDraftBtnVisiblitys",false);this.getView().getModel("invoiceSearchModel").setProperty("/billingCategory","C");this.getView().getModel("invoiceSearchModel").setProperty("/billingCategoryDesc","Commercial Invoice");this.selectedReturnItems=[];e.salesOrgDataAccess="No Access";e.SLOCDataAccess="No Access";e.distrChannelDataAccess="No Access";e.divisionDataAccess="No Access";e.materialGroupDataAccess="No Access";e.materialGroup4DataAccess="No Access";e.plantDataAccess="No Access";if(sap.ui.getCore().getConfiguration().getLanguage()==="en-US"){o.setProperty("/language","TH")}else{o.setProperty("/language",sap.ui.getCore().getConfiguration().getLanguage())}o.setProperty("/languageID","E");o.setProperty("/invoiceTableLength","");o.setProperty("/returnTableLength","");o.setProperty("/exchangeTableLength","");o.setProperty("/disableSoldToParty",true);this.onResetSoldToParty();this.onResetSearchInvoice();if(this.getView().getModel("OrderReasonSet")){this.getView().getModel("OrderReasonSet").setData("")}if(sap.ui.getCore().getModel("draftItemModel")){sap.ui.getCore().setModel("draftItemModel",undefined)}o.setProperty("/InvCollapseVisiblity",true);o.setProperty("/InvOpenVisiblity",false);o.setProperty("/InvSearchBar",true);o.setProperty("/ExcCollapseVisiblity",true);o.setProperty("/ExcOpenVisiblity",false);o.setProperty("/ExcSearchBar",true);o.setProperty("/PrevCollapseVisiblity",true);o.setProperty("/PrevopenVisiblity",false);o.setProperty("/PrevSearchBar",true);o.setProperty("/RetCollapseVisiblity",true);o.setProperty("/RetOpenVisiblity",false);o.setProperty("/ReturnSeacrhBar",true)},valueHelpRequestDistChan:function(){var e=this;if(e.distrChannelDataAccess==="No Access"){s.show(this.resourceBundle.getText("NoDataAccess"))}else{this.DistChnl.open()}},onSelectSalesOrg:function(e){var t=this.getView().getModel("baseModel");t.setProperty("/SalesOrg",e.getSource().getSelectedItem().getText().split(" ")[0]);t.setProperty("/selectedSalesOrg",e.getSource().getSelectedItem().getText().split(" ")[0]);t.setProperty("/Salesorg",e.getSource().getSelectedItem().getText().split(" ")[0]);t.setProperty("/selectedSalesOrgDesc",e.getSource().getSelectedItem().getText().split("(")[1].split(")")[0]);t.setProperty("/SalesOrgDesc",e.getSource().getSelectedItem().getText().split("(")[1].split(")")[0]);if(t.getData().selectedSoldtoParty!==undefined&&t.getData().selectedSoldtoParty!==""){t.setProperty("/step2Validation",true);this._wizard.setCurrentStep(this.byId("ID_WIZARD_INV_SRCH"))}t.refresh()},onchangeDistChnl:function(e){var t=this.getView().getModel("baseModel");t.setProperty("/selectedDistChnl",e.getSource().getSelectedItem().getText().split(" ")[0]);t.setProperty("/DistChan",e.getSource().getSelectedItem().getText().split(" ")[0]);t.setProperty("/selectedDistChlDesc",e.getSource().getSelectedItem().getText().split("(")[1].split(")")[0]);t.refresh()},onSelectReasonOwner:function(e){var t=this.getView().getModel("baseModel");t.setProperty("/reasonOwner",e.getSource().getSelectedItem().getText().split(" ")[0]+" "+e.getSource().getSelectedItem().getText().split(" ")[1]);t.refresh()},onChangeShipTo:function(e){var t=this.getView().getModel("baseModel");t.setProperty("/exShipTo",e.getSource().getSelectedItem().getText().split(" ")[0]);t.setProperty("/exShipToDesc",e.getSource().getSelectedItem().getText().split("(")[1].split(")")[0])},onLiveChangeDistChan:function(e){var t=e.getParameters().value;var r=new Array;var s=new sap.ui.model.Filter([new sap.ui.model.Filter("Name",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("DistChl",sap.ui.model.FilterOperator.Contains,t)]);r.push(s);var o=e.getSource().getBinding("items");o.filter(r)},onLiveChangeName4:function(e){var t=e.getParameters().value;this.getView().getModel("baseModel").setProperty("/maxLengthName4",40-t.length+" Char remainaing");this.getView().getModel("baseModel").refresh()},onLiveChangeStreet2:function(e){var t=e.getParameters().value;this.getView().getModel("baseModel").setProperty("/maxLengthAddressStreet2",40-t.length+" Char remainaing");this.getView().getModel("baseModel").refresh()},onLiveChangeStreet3:function(e){var t=e.getParameters().value;this.getView().getModel("baseModel").setProperty("/maxLengthAddressStreet3",40-t.length+" Char remainaing");this.getView().getModel("baseModel").refresh()},onLiveChangeStreet5:function(e){var t=e.getParameters().value;this.getView().getModel("baseModel").setProperty("/maxLengthAddressStreet5",40-t.length+" Char remainaing");this.getView().getModel("baseModel").refresh()},onLiveChangeDistrict:function(e){var t=e.getParameters().value;this.getView().getModel("baseModel").setProperty("/maxLengthDistrict",40-t.length+" Char remainaing");this.getView().getModel("baseModel").refresh()},onLiveChangeDifferentCity:function(e){var t=e.getParameters().value;this.getView().getModel("baseModel").setProperty("/maxLengthDifferentCity",40-t.length+" Char remainaing");this.getView().getModel("baseModel").refresh()},onLiveChangePostalCode:function(e){var t=e.getParameters().value;if(t.length>5){this.getView().getModel("baseModel").setProperty("/postalCode",t.substring(0,5));var r=t.substring(0,5);e.getSource().setValue("");e.getSource().setValue(r);this.getView().getModel("baseModel").refresh()}else{this.getView().getModel("baseModel").setProperty("/maxLengthPostalCode",5-t.length+" Char remainaing")}this.getView().getModel("baseModel").refresh()},onLiveChangeTelephone:function(e){var t=e.getParameters().value;this.getView().getModel("baseModel").setProperty("/maxLengthtelephone",30-t.length+" Char remainaing");this.getView().getModel("baseModel").refresh()},onLiveChangeMobilePhone:function(e){var t=e.getParameters().value;this.getView().getModel("baseModel").setProperty("/maxLengthmobileNumber",30-t.length+" Char remainaing");this.getView().getModel("baseModel").refresh()},onLiveChangeTaxID:function(e){var t=e.getParameters().value;this.getView().getModel("baseModel").setProperty("/maxLengthtaxId",13-t.length+" Char remainaing");this.getView().getModel("baseModel").refresh()},onLiveChangeBCODE:function(e){var t=e.getParameters().value;if(t.length>5){this.getView().getModel("baseModel").setProperty("/bCode",t.substring(0,5));var r=t.substring(0,5);e.getSource().setValue("");e.getSource().setValue(r);this.getView().getModel("baseModel").refresh()}else{this.getView().getModel("baseModel").setProperty("/maxLengthbCode",5-t.length+" Char remainaing")}this.getView().getModel("baseModel").refresh()},onLiveChangeBPNUMMR:function(e){var t=e.getParameters().value;this.getView().getModel("baseModel").setProperty("/maxLengthbpNummr",1-t.length+" Char remainaing");var r=this.getView().getModel("baseModel").getProperty("/bpNummr");this.getView().getModel("baseModel").refresh();if(t!==""&&t!=="N"&&t!=="H"){this.getView().getModel("baseModel").setProperty("/bpNummr","");e.getSource().setValue("");s.show("Invalid Input")}},onSearchSoldToParty:function(e){var r=this,o=this.getView().getModel("baseModel").getData(),a=[];if(r.allAccess===false){s.show(this.resourceBundle.getText("NoDataAccess"));return}if((o.SoldtoParty===""||o.SoldtoParty===undefined)&&(o.SoldTopartyName===""||o.SoldTopartyName===undefined)&&(o.Division===""||o.Division===undefined)&&(o.SalesOrg===""||o.SalesOrg===undefined)&&(o.DistChan===""||o.DistChan===undefined)){t.information(this.resourceBundle.getText("Selectatleastoneinputcriteria"));return}if(o.SoldtoParty!==""&&o.SoldtoParty!==undefined){a.push(new sap.ui.model.Filter("CustCode",sap.ui.model.FilterOperator.EQ,o.SoldtoParty))}if(r.custCodeDataAccess!=="*"&&r.custCodeDataAccess!==undefined){a.push(new sap.ui.model.Filter("custNumEx",sap.ui.model.FilterOperator.EQ,r.custCodeDataAccess))}if(o.DistChan!==""&&o.DistChan!==undefined){a.push(new sap.ui.model.Filter("Distchl",sap.ui.model.FilterOperator.EQ,o.DistChan))}else{a.push(new sap.ui.model.Filter("Distchl",sap.ui.model.FilterOperator.EQ,r.distrChannelDataAccess))}if(o.Division!==""&&o.Division!==undefined){a.push(new sap.ui.model.Filter("Division",sap.ui.model.FilterOperator.EQ,o.Division))}else{a.push(new sap.ui.model.Filter("Division",sap.ui.model.FilterOperator.EQ,r.divisionDataAccess))}if(o.SalesOrg!==""&&o.SalesOrg!==undefined){a.push(new sap.ui.model.Filter("SalesOrg",sap.ui.model.FilterOperator.EQ,o.SalesOrg))}else{a.push(new sap.ui.model.Filter("SalesOrg",sap.ui.model.FilterOperator.EQ,r.salesOrgDataAccess))}if(this.getView().getModel("baseModel").getProperty("/languageID")==="E"){if(o.SoldTopartyName!==""&&o.SoldTopartyName!==undefined){a.push(new sap.ui.model.Filter("Name1",sap.ui.model.FilterOperator.EQ,"*"+o.SoldTopartyName.toUpperCase()+"*"))}}else{if(o.SoldTopartyName!==""&&o.SoldTopartyName!==undefined){a.push(new sap.ui.model.Filter("Name2",sap.ui.model.FilterOperator.EQ,"*"+o.SoldTopartyName.toUpperCase()+"*"))}}a.push(new sap.ui.model.Filter("languageID",sap.ui.model.FilterOperator.EQ,this.getView().getModel("baseModel").getProperty("/languageID")));var i=this.getView().getModel("ZDKSH_CC_DAC_SOLDTOPARTY_SRV");var n=new sap.m.BusyDialog;n.open();if(this._wizard.getCurrentStep()==="__xmlview1--ID_WIZARD_RTEX"||this._wizard.getCurrentStep()==="__xmlview0--ID_WIZARD_RTEX"){var l="/ZSoldToPartySet"}else{var l="/ZSoldToPartySH"}i.read(l,{async:false,filters:a,success:function(e,t){n.close();var s=new sap.ui.model.json.JSONModel({results:e.results});r.SoldtoParty.setModel(s,"SoldToPartyListSet");r.SoldtoParty.getModel("SoldToPartyListSet").setProperty("/length","Sold to ("+e.results.length+")")},error:function(e){n.close();var t="";if(e.statusCode===504){t=r.resourceBundle.getText("timeOut");r.errorMsg(t)}else{t=JSON.parse(e.responseText);t=t.error.message.value;r.errorMsg(t)}}})},onSortPress:function(){if(!this.SortFrag){this.SortFrag=sap.ui.xmlfragment("dksh.connectclient.CreateReturn.Fragments.sort",this);this.getView().addDependent(this.SortFrag)}this.SortFrag.open()},handleSortDialogConfirm:function(e){var t=sap.ui.getCore().byId("idSoldtoPartyTable"),r=e.getParameters(),s=t.getBinding("items"),o,a,n=[];o=r.sortItem.getKey();a=r.sortDescending;n.push(new i(o,a));s.sort(n)},onSubmitSoldtoParty:function(e){var r=sap.ui.getCore().byId("idSoldtoPartyTable");if(r.getItems().length>0&&r.getSelectedContextPaths().length>0){var o=r.getSelectedItem().getBindingContext("SoldToPartyListSet");var a=this.getView().getModel("baseModel").getData();if(this._wizard.getCurrentStep().includes("ID_WIZARD_RTEX")===true){if(this.getView().getModel("exchangeModel")&&this.getView().getModel("exchangeModel").getProperty("/results").length>0){this.changeSoldToParty=true;a.exSoldTo=o.getProperty("CustCode");a.exSoldToDesc=o.getProperty("Name1");a.exShipTo=o.getProperty("shipToParty");a.exShipToDesc=o.getProperty("shipToPartyName");a.exPayer=o.getProperty("payer");a.exPayerDesc=o.getProperty("payerName");a.partnerName=o.getProperty("payerName");a.exBillTo=o.getProperty("billToParty");a.exBillToDesc=o.getProperty("billToPartyName");this.getView().getModel("baseModel").setProperty("/EXOneTimeCustomer",o.getProperty("oneTimeCustomer"));this.getView().getModel("baseModel").refresh();this.onResetSoldToParty();this.SoldtoParty.close();this._pricingSimulation(this.getView().getModel("exchangeModel").getProperty("/results"),"Exchange")}else{s.show("Add items for exchange")}}else{a.selectedSoldtoParty=o.getProperty("CustCode");a.selectedSoldtoPartyDesc=o.getProperty("Name1");a.selectedDistChnl=o.getProperty("Distchl");a.DistChan=o.getProperty("Distchl");a.selectedDistChan=o.getProperty("Distchl");a.SalesOrg=o.getProperty("SalesOrg");a.selectedSalesOrg=o.getProperty("SalesOrg");a.selectedDistChlDesc=o.getProperty("DCName");a.selectedSalesOrg=o.getProperty("SalesOrg");a.selectedSalesOrgDesc=o.getProperty("SOrgName");a.Division=o.getProperty("Division");a.selectedDivisionDesc=o.getProperty("DName");a.shipTo=o.getProperty("shipToParty");a.shipToDesc=o.getProperty("shipToPartyName");a.exShipTo=o.getProperty("shipToParty");a.exShipToDesc=o.getProperty("shipToPartyName");a.billTo=o.getProperty("billToParty");a.billToDesc=o.getProperty("billToPartyName");a.payer=o.getProperty("payer");a.payerDesc=o.getProperty("payerName");var i=this.getView().getModel("invoiceSearchModel");i.setProperty("/salesOrgNo",a.selectedSalesOrg);i.setProperty("/salesOrgDesc",a.selectedSalesOrgDesc);i.setProperty("/distChnl",a.DistChan);i.setProperty("/distChnlDesc",a.selectedDistChlDesc);i.setProperty("/soldToParty",a.selectedSoldtoParty);i.setProperty("/Division",a.Division);i.setProperty("/soldToPartyDesc",a.selectedSoldtoPartyDesc);i.setProperty("/shipTo",o.getProperty("shipToParty"));i.setProperty("/billTo",o.getProperty("billToParty"));i.setProperty("/payer",o.getProperty("payer"));this.getView().getModel("baseModel").setProperty("/oneTimeCustomer",o.getProperty("oneTimeCustomer"));this.getView().getModel("baseModel").refresh();this.onResetSoldToParty();this.SoldtoParty.close();this.getView().getModel("baseModel").setProperty("/salesOrgEditable",false);this.getView().getModel("baseModel").setProperty("/distChnlEditable",false);this.getView().getModel("baseModel").setProperty("/step2Validation",true);this._wizard.setCurrentStep(this.byId("ID_WIZARD_INV_SRCH"));this._getSalesOrgForOrderID()}}else{t.information(this.resourceBundle.getText("Selectatleastoneitem"))}},_getSalesOrgForOrderID:function(){var e=this;var t=this.getView().getModel("baseModel").getProperty("/selectedSalesOrg");if(this.getView().getModel("ZDKSH_CC_DAC_SOLDTOPARTY_SRV")){var r=this.getView().getModel("ZDKSH_CC_DAC_SOLDTOPARTY_SRV");var s=[];var o="";if(sap.ushell){if(sap.ui.getCore().getConfiguration().getLanguage()==="th"){o="2"}else{o="EN"}}else{o="EN"}o=o.toUpperCase();var a=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("salesOrg",sap.ui.model.FilterOperator.EQ,t)]});s.push(a);var i=new sap.m.BusyDialog;i.open();r.read("/TransactionNumSet",{filters:s,async:false,success:function(t,r){i.close();e.getView().getModel("baseModel").setProperty("/salesOrgForRO",t.results[0].mappingID)},error:function(t){i.close();var r="";if(t.statusCode===504){r=e.resourceBundle.getText("timeOut");e.errorMsg(r)}else{r=JSON.parse(t.responseText);r=r.error.message.value;e.errorMsg(r)}}})}},onResetSoldToParty:function(){var e=this.getView().getModel("baseModel");if(this._wizard.getCurrentStep()==="__xmlview1--ID_WIZARD_RTEX"||this._wizard.getCurrentStep()==="__xmlview0--ID_WIZARD_RTEX"){e.setProperty("/SoldtoParty","");e.setProperty("/SoldTopartyName","")}else{e.setProperty("/SoldtoParty","");e.setProperty("/SoldTopartyName","");e.setProperty("/Division","");e.setProperty("/DistChan","");e.setProperty("/DivisionDesc","");e.setProperty("/SalesOrgDesc","");e.setProperty("/DistChanDesc","");e.setProperty("/SalesOrg","")}if(this.SoldtoParty){if(this.SoldtoParty.getModel("SoldToPartyListSet")!==undefined){this.SoldtoParty.getModel("SoldToPartyListSet").setData("")}}e.refresh()},onCancelSoldtoParty:function(){var e=this.getView().getModel("baseModel");e.setProperty("/SoldtoParty","");e.setProperty("/SoldTopartyName","");e.setProperty("/Division","");e.setProperty("/DivisionDesc","");e.setProperty("/SalesOrgDesc","");e.setProperty("/DistChanDesc","");e.setProperty("/DistChan","");e.setProperty("/SalesOrg","");if(this.SoldtoParty.getModel("SoldToPartyListSet")!==undefined){this.SoldtoParty.getModel("SoldToPartyListSet").setData("")}e.refresh();this.SoldtoParty.close()},onLiveChangeSoldToParty:function(e){var t=e.getParameters().newValue;var r=new Array;var s=new sap.ui.model.Filter([new sap.ui.model.Filter("CustCode",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("Name1",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("Distchl",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("Division",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("SalesOrg",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("DName",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("DCName",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("SOrgName",sap.ui.model.FilterOperator.Contains,t)]);r.push(s);var o=e.getSource().getParent().getParent().getBinding("items");o.filter(r)},onBillDateSelectionFrom:function(e){var t=sap.ui.core.format.DateFormat.getDateInstance({pattern:"MM-dd-yyyy",calendarType:"Gregorian"});var s=e.getParameters().value.split("-")[0];var o=this.getOwnerComponent().getModel("device");if(!s){return}var a=e.getParameters().value.split("-")[1];var i=e.getParameters().value.split("-")[2];var n=i+"-"+a+"-"+s;if(o.getData().system.phone){this.invoiceDetail.getModel("invoiceSearchModel").setProperty("/billingDateFrom",n)}else{var l=t.format(new Date(n));var d=r.dateTimeFormat1(l);this.invoiceDetail.getModel("invoiceSearchModel").setProperty("/billingDateFrom",d)}},onBillDateSelectionTo:function(e,t){if(this.invoiceDetail){var s=this.invoiceDetail.getModel("invoiceSearchModel").getProperty("/billingDateFrom");var o=this.byId("idBillDateTo");var a=this.getOwnerComponent().getModel("device");if(!s){return}else{var i=sap.ui.core.format.DateFormat.getDateInstance({pattern:"MM-dd-yyyy",calendarType:"Gregorian"});var n=e.getParameters().value.split("-")[0];if(!n){return}var l=e.getParameters().value.split("-")[1];var d=e.getParameters().value.split("-")[2];var g=d+"-"+l+"-"+n;if(Date.parse(s)>Date.parse(g)){o.setValueState("Error");o.setValueStateText("Bill Doc Date From > Bill Doc Date To");return}else{o.setValueState("None")}if(a.getData().system.phone){this.invoiceDetail.getModel("invoiceSearchModel").setProperty("/billingDateTo",g)}else{var p=i.format(new Date(g));var c=r.dateTimeFormat1(p);this.invoiceDetail.getModel("invoiceSearchModel").setProperty("/billingDateTo",c)}}}},onConfirmChangeBillingType:function(e){var t=e.getParameters().selectedContexts[0].getObject().domvalueL;this.invoiceDetail.getModel("invoiceSearchModel").setProperty("/billingCategory",t);this.invoiceDetail.getModel("invoiceSearchModel").setProperty("/billingCategoryDesc",e.getParameters().selectedContexts[0].getObject().ddtext);this.invoiceDetail.getModel("invoiceSearchModel").refresh()},onSearchInvoice:function(){var e=this.getOwnerComponent().getModel("device");if(this.getView().getModel("returnModel").getData().results&&this.getView().getModel("returnModel").getData().results.length>0){var s=this.getView().getModel("returnModel").getData().results;for(var o=this.selectedReturnItems.length-1;o>=0;o--){var a=0;for(var i=s.length-1;i>=0;i--){if(this.selectedReturnItems[o].InvoiceNum===s[i].refInvoice&&this.selectedReturnItems[o].InvoiceLineItem===s[i].refItemNumber){a++}else{}}if(a===0){this.selectedReturnItems.splice(o,1)}}}else{this.selectedReturnItems=[]}this.selectedInvoice=[];var n=this;var l=this.invoiceDetail.getModel("invoiceSearchModel");var d="$filter=";var g=this.getView().getModel("ZDKSH_CC_RETURNS_MANAGEMENT_SRV"),p=this.invoiceDetail.getModel("invoiceSearchModel").getData(),c=[];if((p.invoiceNo===""||p.invoiceNo===undefined)&&(p.materialNo===""||p.materialNo===undefined)&&(p.batchNo===""||p.batchNo===undefined)&&(p.SerialNum===""||p.SerialNum===undefined)){t.information(this.resourceBundle.getText("Enteratleastoninputcriteria"));return}else{if(p.invoiceNo!==""&&p.invoiceNo!==undefined){if(d.length===8){d=d+"invoiceNum eq "+"'"+p.invoiceNo+"'"}else{d=d+" and "+"invoiceNum eq "+"'"+p.invoiceNo+"'"}}if(p.materialNo!==""&&p.materialNo!==undefined){if(d.length===8){d=d+"materialCode eq "+"'"+p.materialNo+"'"}else{d=d+" and "+"materialCode eq "+"'"+p.materialNo+"'"}}if(p.batchNo!==""&&p.batchNo!==undefined){if(d.length===8){d=d+"batchNumber eq "+"'"+p.batchNo+"'"}else{d=d+" and "+"batchNumber eq "+"'"+p.batchNo+"'"}}if(p.salesOrgNo!==""&&p.salesOrgNo!==undefined){if(d.length===8){d=d+"salesOrg eq "+"'"+p.salesOrgNo+"'"}else{d=d+" and "+"salesOrg eq "+"'"+p.salesOrgNo+"'"}}if(p.distChnl!==""&&p.distChnl!==undefined){if(d.length===8){d=d+"distChannel eq "+"'"+p.distChnl+"'"}else{d=d+" and "+"distChannel eq "+"'"+p.distChnl+"'"}}if(p.soldToParty!==""&&p.soldToParty!==undefined){if(d.length===8){d=d+"soldToParty eq "+"'"+p.soldToParty+"'"}else{d=d+" and "+"soldToParty eq "+"'"+p.soldToParty+"'"}}var u=this.getView().getModel("baseModel").getData();if(p.Division!==""&&p.Division!==undefined){if(d.length===8){d=d+"division eq "+"'"+p.Division+"'"}else{d=d+" and "+"division eq "+"'"+p.Division+"'"}}if(p.billingDateFrom){if(e.getData().system.phone){var h=[p.billingDateFrom.split("-")[0],p.billingDateFrom.split("-")[1],p.billingDateFrom.split("-")[2]].join("-");h=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-ddTHH:mm:ss"}).format(new Date(h))}else{h=r.dateTimeFormat(p.billingDateFrom)}if(d.length===8){d=d+"billingDateFrom eq datetime"+"'"+h+"'"}else{d=d+" and "+"billingDateFrom eq datetime"+"'"+h+"'"}}else{if(p.invoiceNo!==""&&p.invoiceNo!==undefined){var m=""}else{var y=this.formatter.manipulateDate.call(this,new Date,1825,"sub");y=new Date(y.getFullYear(),0,1);if(e.getData().system.phone){m=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-ddTHH:mm:ss"}).format(new Date(y))}else{m=r.dateTimeFormat(y)}if(d.length===8){d=d+"billingDateFrom eq datetime"+"'"+m+"'"}else{d=d+" and "+"billingDateFrom eq datetime"+"'"+m+"'"}}}if(p.billingDateTo){if(e.getData().system.phone){var P=[p.billingDateTo.split("-")[0],p.billingDateTo.split("-")[1],p.billingDateTo.split("-")[2]].join("-");P=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-ddTHH:mm:ss"}).format(new Date(P))}else{P=r.dateTimeFormat(p.billingDateTo)}if(d.length===8){d=d+"billingDateTo eq datetime"+"'"+P+"'"}else{d=d+" and "+"billingDateTo eq datetime"+"'"+P+"'"}}else{if(p.invoiceNo!==""&&p.invoiceNo!==undefined){var f=""}else{var y=this.formatter.manipulateDate.call(this,y,730,"add");if(e.getData().system.phone){f=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-ddTHH:mm:ss"}).format(new Date(y))}else{f=r.dateTimeFormat(new Date(y))}if(d.length===8){d=d+"billingDateTo eq datetime"+"'"+f+"'"}else{d=d+" and "+"billingDateTo eq datetime"+"'"+f+"'"}}}if(n.materialGroupDataAccess!=="No Access"){if(d.length===8){d=d+"materialGroup eq "+"'"+n.materialGroupDataAccess+"'"}else{d=d+" and "+"materialGroup eq "+"'"+n.materialGroupDataAccess+"'"}}if(n.materialGroup4DataAccess!==""&&n.materialGroup4DataAccess!==undefined){if(d.length===8){d=d+"materialGroup4 eq "+"'"+n.materialGroup4DataAccess+"'"}else{d=d+" and "+"materialGroup4 eq "+"'"+n.materialGroup4DataAccess+"'"}}if(p.displayBySno!==""&&p.displayBySno!==undefined){if(d.length===8){d=d+"displayBySno eq "+"'"+p.displayBySno+"'"}else{d=d+" and "+"displayBySno eq "+"'"+p.displayBySno+"'"}}if(p.SerialNum!==""&&p.SerialNum!==undefined){if(d.length===8){d=d+"serialNum eq "+"'"+p.SerialNum+"'"}else{d=d+" and "+"serialNum eq "+"'"+p.SerialNum+"'"}}if(p.billingCategory!==""&&p.billingCategory!==undefined){if(d.length===8){d=d+"invCategory eq "+"'"+p.billingCategory+"'"}else{d=d+" and "+"invCategory eq "+"'"+p.billingCategory+"'"}}if(n.materialDataAccess!=="*"&&n.materialDataAccess!==undefined){if(d.length===8){d=d+"materialCodeDac eq "+"'"+n.materialDataAccess+"'"}else{d=d+" and "+"materialCodeDac eq "+"'"+n.materialDataAccess+"'"}}if(n.custCodeDataAccess!=="*"&&n.custCodeDataAccess!==undefined){if(d.length===8){d=d+"customerCodeDac eq "+"'"+n.custCodeDataAccess+"'"}else{d=d+" and "+"customerCodeDac eq "+"'"+n.custCodeDataAccess+"'"}}d=d+" and "+"roType eq "+"'"+this.ROtypeCode+"'";var v=new sap.m.BusyDialog;v.open();g.read("/billingDocumentSet",{async:false,urlParameters:d+"&$expand=billingDocItemSerialNav,billingDocToBusiPartners&$format=json",success:function(e,t){v.close();n.getView().byId("InvoiceTableId").removeSelections();var s=this.getOwnerComponent().getModel("device");if(!p.invoiceNo&&!p.billingDateFrom){var o=this.formatter.manipulateDate.call(this,new Date,1825,"sub");o=new Date(o.getFullYear(),0,1);var a=this.formatter.manipulateDate.call(this,o,730,"add");if(s.getData().system.phone){p.billingDateFrom=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-dd"}).format(new Date(o));p.billingDateTo=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-dd"}).format(new Date(a))}else{p.billingDateFrom=r.dateTimeFormat1(o);p.billingDateTo=r.dateTimeFormat1(a)}}n.getView().getModel("baseModel").setProperty("/billingTypeEnable",false);var i=[];for(var d=0;d<e.results.length;d++){var g=e.results[d].billingDocItemSerialNav.results;for(var c=0;c<g.length;c++){var u={shipToParty:parseInt(e.results[d].billingDocToBusiPartners.results[2].partnerNum).toString(),shipToPartyDesc:n.getView().getModel("baseModel").getProperty("/shipToDesc"),billingDateFrom:e.results[d].billingDateFrom,billingDateTo:e.results[d].billingDateTo,billingType:e.results[d].billingType,shipToAddress:e.results[d].billingDocToBusiPartners.results[3],soldToAddress:e.results[d].billingDocToBusiPartners.results[0],payerAddress:e.results[d].billingDocToBusiPartners.results[2],billToAdress:e.results[d].billingDocToBusiPartners.results[1],Active:g[c].Active,AvailRetQtyBaseUn:g[c].AvailRetQtyBaseUn,AvailRetQtySalesUn:g[c].AvailRetQtySalesUn,BaseUnit:g[c].BaseUnit,BatchNumber:g[c].BatchNumber,BillingQty:g[c].BillingQty,ColorCode:g[c].ColorCode,DiscountAmount:g[c].DiscountAmount,ExpiryDate:g[c].ExpiryDate,InvoiceLineItem:g[c].InvoiceLineItem,InvoiceNum:g[c].InvoiceNum,ItemUsage:g[c].ItemUsage,MaterialCode:g[c].MaterialCode,MaterialDesc:g[c].MaterialDesc,MaterialGroup:g[c].MaterialGroup,MaterialGroup4:g[c].MaterialGroup4,NetPrice:g[c].NetPrice,SalesUnit:g[c].SalesUnit,SerialNum:g[c].SerialNum,UnitPrice:g[c].UnitPrice,deleted:"false",actualRetQty:g[c].AvailRetQtySalesUn,actualRetUOM:g[c].SalesUnit,editablity:true,ListPrice:g[c].ListPrice,HigherLvlItem:g[c].HigherLvlItem,ItemGroup:g[c].ItemGroup,docCurrency:g[c].docCurrency,ActiveIndicator:g[c].ActiveIndicator};i.push(u)}}l.setSizeLimit(i.length);l.setProperty("/billingType",e.results[0].billingType);l.setProperty("/results",i);n.getView().getModel("baseModel").setProperty("/originalInvoiceData",JSON.parse(JSON.stringify(i)));if(i.length>10){n.getView().getModel("baseModel").setProperty("/invoiceTableLength","60vh")}else{n.getView().getModel("baseModel").setProperty("/invoiceTableLength","")}l.setProperty("/invoiceItemsLength","Invoice ("+i.length+")");l.refresh();n.getView().byId("InvoiceTableId").removeSelections()}.bind(this),error:function(e){v.close();n.getView().byId("InvoiceTableId").removeSelections();var t=this.getOwnerComponent().getModel("device");if(!p.invoiceNo&&!p.billingDateFrom){var s=this.formatter.manipulateDate.call(this,new Date,1825,"sub");s=new Date(s.getFullYear(),0,1);var o=this.formatter.manipulateDate.call(this,s,730,"add");if(t.getData().system.phone){p.billingDateFrom=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-dd"}).format(new Date(s));p.billingDateTo=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-dd"}).format(new Date(o))}else{p.billingDateFrom=r.dateTimeFormat1(s);p.billingDateTo=r.dateTimeFormat1(o)}}if(l.getProperty("/results")){l.setProperty("/results","");l.setProperty("/invoiceItemsLength","")}n.getView().getModel("baseModel").setProperty("/billingTypeEnable",false);n.getView().getModel("baseModel").setProperty("/invoiceTableLength","");n.getView().getModel("baseModel").refresh();l.refresh();var a="";if(e.statusCode===504){a=n.resourceBundle.getText("timeOut");n.errorMsg(a)}else{a=JSON.parse(e.responseText);a=a.error.message.value;n.errorMsg(a)}}.bind(this)})}},onResetSearchInvoice:function(){var e=this.getView().getModel("invoiceSearchModel");e.setProperty("/results","");e.setProperty("/invoiceNo","");e.setProperty("/selectedSerialNum",false);e.setProperty("/billingDateFrom","");e.setProperty("/billingDateTo","");e.setProperty("/SerialNum","");if(this.docVersion==="SUCCESS"){this.getView().getModel("baseModel").setProperty("/billingTypeEnable",false)}else{this.getView().getModel("baseModel").setProperty("/billingTypeEnable",true)}if(this.ROtypeCode==="TI"){e.setProperty("/billingCategory","B");e.setProperty("/billingCategoryDesc","Consignment Fill Up")}else{e.setProperty("/billingCategory","C");e.setProperty("/billingCategoryDesc","Commercial Invoice")}e.setProperty("/batchNo","");e.setProperty("/materialNo","");e.setProperty("/results","");e.setProperty("/invoiceItemsLength","");e.refresh();if(this.getView().getModel("returnModel").getData().results&&this.getView().getModel("returnModel").getData().results.length>0){var t=this.getView().getModel("returnModel").getData().results;for(var r=this.selectedReturnItems.length-1;r>=0;r--){var s=0;for(var o=t.length-1;o>=0;o--){if(this.selectedReturnItems[r].InvoiceNum===t[o].refInvoice&&this.selectedReturnItems[r].InvoiceLineItem===t[o].refItemNumber){s++}else{}}if(s===0){this.selectedReturnItems.splice(r,1)}}}else{this.selectedReturnItems=[]}},onPressPreviousRange:function(){var e=this.getView().getModel("invoiceSearchModel").getData().billingDateFrom;var t=this.getView().getModel("invoiceSearchModel").getData().billingDateTo;var r=new Date;var s=new Date(e);var o=this.getOwnerComponent().getModel("device");s.setYear(s.getFullYear()-2);var a=new Date(t);a.setYear(a.getFullYear()-2);if(s.getFullYear()===a.getFullYear()){a.setYear(s.getFullYear()+2)}var i=new Date(s);var n=new Date(a);if(o.getData().system.phone){var l=new Date(i).toISOString().substr(0,10);this.getView().getModel("invoiceSearchModel").setProperty("/billingDateFrom",l);var d=new Date(n).toISOString().substr(0,10);this.getView().getModel("invoiceSearchModel").setProperty("/billingDateTo",d)}else{var g=sap.ui.core.format.DateFormat.getDateInstance({pattern:"MM-dd-yyyy",calendarType:"Gregorian"});i=g.format(i);n=g.format(n);var p=i+" - "+n;this.getView().getModel("invoiceSearchModel").setProperty("/billingDateFrom",i);this.getView().getModel("invoiceSearchModel").setProperty("/billingDateTo",n)}},onPressNextRange:function(){var e=this.getView().getModel("invoiceSearchModel").getData().billingDateFrom;var t=this.getView().getModel("invoiceSearchModel").getData().billingDateTo;var r=new Date;var s=new Date(e);var o=this.getOwnerComponent().getModel("device");s.setYear(s.getFullYear()+2);var a=new Date(t);a.setYear(a.getFullYear()+2);if(s.getFullYear()===a.getFullYear()){a.setYear(s.getFullYear()+2)}var i=new Date(s);var n=new Date(a);if(o.getData().system.phone){var l=new Date(i).toISOString().substr(0,10);this.getView().getModel("invoiceSearchModel").setProperty("/billingDateFrom",l);var d=new Date(n).toISOString().substr(0,10);this.getView().getModel("invoiceSearchModel").setProperty("/billingDateTo",d)}else{var g=sap.ui.core.format.DateFormat.getDateInstance({pattern:"MM-dd-yyyy",calendarType:"Gregorian"});i=g.format(i);n=g.format(n);var p=i+" - "+n;this.getView().getModel("invoiceSearchModel").setProperty("/billingDateFrom",i);this.getView().getModel("invoiceSearchModel").setProperty("/billingDateTo",n)}},onCompleteStep3:function(){if(this.docVersion==="SUCCESS"){this.getView().getModel("baseModel").setProperty("/saveAsDraftBtnVisiblitys",false);this.getView().getModel("baseModel").setProperty("/exchangeBtnVisiblitys",false);this.getView().getModel("baseModel").setProperty("/submitBtnVisiblitys",false)}else{this.getView().getModel("baseModel").setProperty("/saveAsDraftBtnVisiblitys",true);this.getView().getModel("baseModel").setProperty("/exchangeBtnVisiblitys",true);this.getView().getModel("baseModel").refresh();this._getPersonalizationDetails("keyReturn","Before")}},onPressAddress:function(e){var t=e.getSource().getBindingContext("invoiceSearchModel").getObject();var r=new sap.ui.model.json.JSONModel({shipToAddress:t.shipToAddress,soldToAddress:t.soldToAddress,payerAddress:t.payerAddress,billToAdress:t.billToAdress});this.getView().setModel(r,"addressModel");this.getView().getModel("baseModel").setProperty("/invoiceTableVisiblity",false);this.getView().getModel("baseModel").setProperty("/addressVisiblity",true);this.getView().getModel("baseModel").refresh()},onPressNavBackToItems:function(){this.getView().getModel("baseModel").setProperty("/invoiceTableVisiblity",true);this.getView().getModel("baseModel").setProperty("/addressVisiblity",false);this.getView().getModel("baseModel").refresh()},valueHelpRequestSoldtoParty:function(){var e=this.getView().getModel("baseModel");if(e.getProperty("/selectedSalesOrg")!==undefined){e.setProperty("/SalesOrg",e.getProperty("/selectedSalesOrg"));e.setProperty("/SalesOrgDesc",e.getProperty("/selectedSalesOrgDesc"))}if(e.getProperty("/selectedDistChnl")!==undefined){e.setProperty("/DistChan",e.getProperty("/selectedDistChnl"));e.setProperty("/DistChanDesc",e.getProperty("/selectedDistChlDesc"))}if(this._wizard.getCurrentStep().includes("ID_WIZARD_RTEX")===true){e.setProperty("/Division",this.getView().getModel("invoiceSearchModel").getProperty("/Division"));e.setProperty("/DivisionDesc",e.getProperty("/selectedDivisionDesc"));e.setProperty("/retDivEditablity",false);e.setProperty("/retSalesOrgEditablity",false);e.setProperty("/retDistChnlEditablity",false)}else{e.setProperty("/Division","");e.setProperty("/DivisionDesc","");e.setProperty("/retDivEditablity",true);e.setProperty("/retSalesOrgEditablity",true);e.setProperty("/retDistChnlEditablity",true)}var t=this;if(!t.SoldtoParty){t.SoldtoParty=sap.ui.xmlfragment("dksh.connectclient.CreateReturn.Fragments.SoldtoParty",this);t.getView().addDependent(t.SoldtoParty);t.SoldtoParty.addStyleClass("sapUiSizeCompact")}t.SoldtoParty.open()},onDownloadAttachment:function(e){var t=e.getSource().getSelectedContexts()[0].getObject();var r=this;if(this.docVersion==="SUCCESS"||this.docVersion==="DRAFT"){if(window.location.href.includes("https://flpnwc-xlgtvarz5i.dispatcher.ap1.hana.ondemand.com")){var s="https://flpnwc-xlgtvarz5i.dispatcher.ap1.hana.ondemand.com/sap/fiori/returnprocess/DKSHJavaService/Attachment/downloadFile/"+t.docId}else{var s="https://flpnwc-cdd660bcb.dispatcher.ap1.hana.ondemand.com/sap/fiori/returnprocess/DKSHJavaService/Attachment/downloadFile/"+t.docId}window.open(s,"_self")}else{}},onPressAttachment:function(e){this.attachemntMode="Add";if(e.getSource().getTooltip()==="Cannot add Files"){this.attachmentName="Preview"}else{this.attachmentName="Return"}var t=this;if(!t.attachment){t.attachment=sap.ui.xmlfragment("dksh.connectclient.CreateReturn.Fragments.attachment",this);t.getView().addDependent(t.attachment);t.attachment.addStyleClass("sapUiSizeCompact")}this.getView().getModel("baseModel").setProperty("/attachmentVisiblity",true);this.getView().getModel("baseModel").setProperty("/attachmentDelEnable",true);t.attachment.open()},onViewAttachment:function(e){this.attachemntMode="View";if(e.getSource().getTooltip()==="Cannot add Files"){this.attachmentName="Preview"}else{this.attachmentName="Return"}var t=this;if(!t.attachment){t.attachment=sap.ui.xmlfragment("dksh.connectclient.CreateReturn.Fragments.attachment",this);t.getView().addDependent(t.attachment);t.attachment.addStyleClass("sapUiSizeCompact")}this.getView().getModel("baseModel").setProperty("/attachmentVisiblity",false);this.getView().getModel("baseModel").setProperty("/attachmentDelEnable",false);t.attachment.open()},okAttachment:function(){if(this.docVersion==="SUCCESS"){this.attachment.close()}else{if(this.getView().getModel("returnModel").getData().attachmentObject===undefined||this.getView().getModel("returnModel").getData().attachmentObject.length===0){t.information(this.resourceBundle.getText("Addatleastonfile"))}else{this.getView().getModel("baseModel").setProperty("/attachmentValue","");this.attachment.close()}}},cancelAttachment:function(){if(this.docVersion==="SUCCESS"){this.attachment.close();return}else if(this.docVersion==="DRAFT"){if(this.attachemntMode==="View"){this.attachment.close()}else{if(this.getView().getModel("returnModel").getData().attachmentObject.length===0){this.getView().getModel("returnModel").setProperty("/enableViewAttachment",false)}this.attachment.close()}}else{if(this.attachemntMode="View"){this.attachment.close()}else{this.getView().getModel("returnModel").refresh(true);this.getView().getModel("baseModel").setProperty("/attachmentValue","");this.attachment.close()}}},valueHelpBillingType:function(){var e=this;if(!e.BillingType){e.BillingType=sap.ui.xmlfragment("dksh.connectclient.CreateReturn.Fragments.BillingType",e);e.getView().addDependent(e.BillingType);var t=this.getView().getModel("ZDKSH_CC_RETURNS_MANAGEMENT_SRV");var r=new sap.m.BusyDialog;r.open();t.read("/billingTypeLookUpSet",{async:false,success:function(t,s){r.close();var o=new sap.ui.model.json.JSONModel({results:t.results});if(t.results.length===1){}e.BillingType.setModel(o,"billingTypeModel");e.BillingType.open()},error:function(t){r.close();var s="";if(t.statusCode===504){s=e.resourceBundle.getText("timeOut");e.errorMsg(s)}else{s=JSON.parse(t.responseText);s=s.error.message.value;e.errorMsg(s)}}})}else{e.BillingType.open()}},valueHelpUOM:function(e){if(e.getSource().getBindingContext("exchangeModel")!==undefined){this.UOMIndex=e.getSource().getBindingContext("exchangeModel")}else if(e.getSource().getBindingContext("invoiceSearchModel")!==undefined){this.UOMIndex=e.getSource().getBindingContext("invoiceSearchModel")}else{this.UOMIndex=e.getSource().getBindingContext("returnModel")}var r=this;if(e.getSource().getBindingContext("exchangeModel")!==undefined){var s=e.getSource().getBindingContext("exchangeModel")}else if(e.getSource().getBindingContext("invoiceSearchModel")!==undefined){var s=e.getSource().getBindingContext("invoiceSearchModel")}else{var s=e.getSource().getBindingContext("returnModel")}var o=parseInt(s.getPath().split("/")[2]);this.currentRowObject=s.getObject();var a=this.getView().getModel("invoiceSearchModel");var i=[];if(e.getSource().getBindingContext("invoiceSearchModel")!==undefined){var n=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("materialNum",sap.ui.model.FilterOperator.EQ,this.currentRowObject.MaterialCode),new sap.ui.model.Filter("salesOrg",sap.ui.model.FilterOperator.EQ,a.getData().salesOrgNo),new sap.ui.model.Filter("distChannel",sap.ui.model.FilterOperator.EQ,a.getData().distChnl),new sap.ui.model.Filter("division",sap.ui.model.FilterOperator.EQ,a.getData().division),new sap.ui.model.Filter("shipToParty",sap.ui.model.FilterOperator.EQ,a.getData().shipToParty),new sap.ui.model.Filter("soldToParty",sap.ui.model.FilterOperator.EQ,a.getData().soldToParty),new sap.ui.model.Filter("orderType",sap.ui.model.FilterOperator.EQ,this.getView().getModel("baseModel").getData().exchangeOrderType),new sap.ui.model.Filter("materialGroup",sap.ui.model.FilterOperator.EQ,this.currentRowObject.MaterialGroup),new sap.ui.model.Filter("materialGroup4",sap.ui.model.FilterOperator.EQ,this.currentRowObject.MaterialGroup4),new sap.ui.model.Filter("quantity",sap.ui.model.FilterOperator.EQ,this.currentRowObject.actualRetQty)],and:true})}else{if(this.currentRowObject.matNumber===""){t.information(this.resourceBundle.getText("Materialcannotbeempty"));return}else{var n=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("materialNum",sap.ui.model.FilterOperator.EQ,this.currentRowObject.matNumber),new sap.ui.model.Filter("salesOrg",sap.ui.model.FilterOperator.EQ,a.getData().salesOrgNo),new sap.ui.model.Filter("distChannel",sap.ui.model.FilterOperator.EQ,a.getData().distChnl),new sap.ui.model.Filter("division",sap.ui.model.FilterOperator.EQ,a.getData().division),new sap.ui.model.Filter("shipToParty",sap.ui.model.FilterOperator.EQ,a.getData().shipToParty),new sap.ui.model.Filter("soldToParty",sap.ui.model.FilterOperator.EQ,a.getData().soldToParty),new sap.ui.model.Filter("orderType",sap.ui.model.FilterOperator.EQ,this.getView().getModel("baseModel").getData().exchangeOrderType),new sap.ui.model.Filter("materialGroup",sap.ui.model.FilterOperator.EQ,this.currentRowObject.materialGroup),new sap.ui.model.Filter("materialGroup4",sap.ui.model.FilterOperator.EQ,this.currentRowObject.materialGroup4),new sap.ui.model.Filter("quantity",sap.ui.model.FilterOperator.EQ,this.currentRowObject.quantity)],and:true})}}i.push(n);var l=this.getView().getModel("ZDKSH_CC_RETURNS_MANAGEMENT_SRV");r.UOM=sap.ui.xmlfragment("dksh.connectclient.CreateReturn.Fragments.UOM",r);r.getView().addDependent(r.BillingType);var l=this.getView().getModel("ZDKSH_CC_RETURNS_MANAGEMENT_SRV");var d=new sap.m.BusyDialog;d.open();l.read("/materialDataSet",{async:false,filters:i,urlParameters:"&$expand=materialDataToMaterialAltUom,materialDataToMatPricingScale,materialDataToMatBonusGoods&$format=json",success:function(e,t){d.close();var s=new sap.ui.model.json.JSONModel({results:e.results[0].materialDataToMaterialAltUom.results});r.UOM.setModel(s,"UOMModel");r.UOM.getModel("UOMModel").refresh();r.UOM.open()},error:function(e){d.close();var t="";if(e.statusCode===504){t=r.resourceBundle.getText("timeOut");t="Request timed-out. Please try again!";r.errorMsg(t)}else{t=JSON.parse(e.responseText);t=t.error.message.value;r.errorMsg(t)}}})},_salesOrgList:function(e){var t=this;if(this.getView().getModel("ZDKSH_CC_INVENTORY_HDRLOOKUP_SRV")){var r=this.getView().getModel("ZDKSH_CC_INVENTORY_HDRLOOKUP_SRV");var s=[];var o="";if(sap.ushell){if(sap.ui.getCore().getConfiguration().getLanguage()==="th"){o="2"}else{o="EN"}}else{o="EN"}o=o.toUpperCase();var a=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("Language",sap.ui.model.FilterOperator.EQ,"EN"),new sap.ui.model.Filter("Salesorg",sap.ui.model.FilterOperator.EQ,t.salesOrgDataAccess)],and:true});s.push(a);var i=new sap.m.BusyDialog;i.open();r.read("/ZSearchHelp_SalesOrgSet",{filters:s,async:false,success:function(e,r){i.close();var s=new sap.ui.model.json.JSONModel({results:e.results});s.setSizeLimit(s.getData().results.length);t.getView().setModel(s,"salesOrgModel");if(e.results.length===1){t.getView().getModel("baseModel").setProperty("/selectedSalesOrg",e.results[0].Salesorg);t.getView().getModel("baseModel").setProperty("/selectedSalesOrgDesc",e.results[0].SalesorgDesc)}if(!t.salesOrg){t.salesOrg=sap.ui.xmlfragment("dksh.connectclient.CreateReturn.Fragments.SalesOrg",t);t.getView().addDependent(t.salesOrg);var s=new sap.ui.model.json.JSONModel({results:e.results});t.salesOrg.setModel(s,"salesOrgModel")}},error:function(e){i.close();var r="";if(e.statusCode===504){r=t.resourceBundle.getText("timeOut");t.errorMsg(r)}else{r=JSON.parse(e.responseText);r=r.error.message.value;t.errorMsg(r)}}})}},errorMsg:function(e){sap.m.MessageBox.show(e,{styleClass:"sapUiSizeCompact",icon:sap.m.MessageBox.Icon.ERROR,title:"Error",actions:[sap.m.MessageBox.Action.OK],onClose:function(e){}})},_distChannelList:function(){var e=this;if(e.distrChannelDataAccess==="No Access"){s.show(this.resourceBundle.getText("NoDataAccess"))}else{if(this.getView().getModel("ZDKSH_CC_HDR_LOOKUP_SRV")){var t=this.getView().getModel("ZDKSH_CC_HDR_LOOKUP_SRV");var r=[];var o="";o=o.toUpperCase();var a=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("Language",sap.ui.model.FilterOperator.EQ,"EN"),new sap.ui.model.Filter("DistChl",sap.ui.model.FilterOperator.EQ,e.distrChannelDataAccess)],and:true});r.push(a);var i=new sap.m.BusyDialog;i.open();t.read("/ZDISTCHLLOOKUPSet",{async:false,filters:r,success:function(t,r){i.close();var s=new sap.ui.model.json.JSONModel({results:t.results});e.getView().setModel(s,"DistChanSet");if(t.results.length===1){e.getView().getModel("baseModel").setProperty("/selectedDistChnl",t.results[0].DistChl);e.getView().getModel("baseModel").setProperty("/selectedDistChlDesc",t.results[0].Name)}if(!e.DistChnl){e.DistChnl=sap.ui.xmlfragment("dksh.connectclient.CreateReturn.Fragments.DistChnl",e);e.getView().addDependent(e.DistChnl);var o=new sap.ui.model.json.JSONModel({results:t.results});e.DistChnl.setModel(o,"DistChanSet")}},error:function(t){i.close();var r="";if(t.statusCode===504){r=e.resourceBundle.getText("timeOut");e.errorMsg(r)}else{r=JSON.parse(t.responseText);r=r.error.message.value;e.errorMsg(r)}}})}}},valueHelpRequestDivision:function(){var e=this;if(e.divisionDataAccess==="No Access"){s.show(this.resourceBundle.getText("NoDataAccess"))}else{if(!e.Division){e.Division=sap.ui.xmlfragment("dksh.connectclient.CreateReturn.Fragments.Division",e);e.getView().addDependent(e.Division);var t=this.getView().getModel("ZDKSH_CC_HDR_LOOKUP_SRV");var r=[];var o=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("Language",sap.ui.model.FilterOperator.EQ,"EN"),new sap.ui.model.Filter("Division",sap.ui.model.FilterOperator.EQ,e.divisionDataAccess)],and:true});r.push(o);var a=new sap.m.BusyDialog;a.open();t.read("/ZDIVISIONLOOKUPSet",{async:false,filters:r,success:function(t,r){a.close();var s=new sap.ui.model.json.JSONModel({results:t.results});e.Division.setModel(s,"DivisionSet");e.Division.open()},error:function(t){a.close();var r="";if(t.statusCode===504){r=e.resourceBundle.getText("timeOut");e.errorMsg(r)}else{r=JSON.parse(t.responseText);r=r.error.message.value;e.errorMsg(r)}}})}else{e.Division.open()}}},onConfirmChangeSalesOrg:function(e){e.getSource().getBinding("items").filter([]);this.getView().getModel("baseModel").setProperty("/salesOrgContainer","soldToPartyFrag");this.getView().getModel("baseModel").setProperty("/SalesOrg",e.getParameters().selectedContexts[0].getObject().Salesorg);this.getView().getModel("baseModel").setProperty("/SalesOrgDesc",e.getParameters().selectedContexts[0].getObject().SalesorgDesc);this.getView().getModel("baseModel").setProperty("/selectedSalesOrg",e.getParameters().selectedContexts[0].getObject().Salesorg);this.getView().getModel("baseModel").refresh()},onLiveChangeSalesOrg:function(e){var t=e.getParameters().value;var r=new Array;var s=new sap.ui.model.Filter([new sap.ui.model.Filter("SalesorgDesc",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("Salesorg",sap.ui.model.FilterOperator.Contains,t)]);r.push(s);var o=e.getSource().getBinding("items");o.filter(r)},onLiveChangeShipTo:function(e){var t=e.getParameters().value;var r=new Array;var s=new sap.ui.model.Filter([new sap.ui.model.Filter("ShipToPartyCode",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("ShipToPartyName",sap.ui.model.FilterOperator.Contains,t)]);r.push(s);var o=e.getSource().getBinding("items");o.filter(r)},onLiveChangeBillTo:function(e){var t=e.getParameters().value;var r=new Array;var s=new sap.ui.model.Filter([new sap.ui.model.Filter("BillToPartyCode",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("BillToPartyName",sap.ui.model.FilterOperator.Contains,t)]);r.push(s);var o=e.getSource().getBinding("items");o.filter(r)},onLiveChangePayer:function(e){var t=e.getParameters().value;var r=new Array;var s=new sap.ui.model.Filter([new sap.ui.model.Filter("PayerCode",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("PayerName",sap.ui.model.FilterOperator.Contains,t)]);r.push(s);var o=e.getSource().getBinding("items");o.filter(r)},onConfirmChangePayer:function(e){e.getSource().getBinding("items").filter([]);if(this.getView().getModel("exchangeModel")&&this.getView().getModel("exchangeModel").getProperty("/results").length>0){this.getView().getModel("baseModel").setProperty("/exPayer",e.getParameters().selectedContexts[0].getObject().PayerCode);this.getView().getModel("baseModel").setProperty("/exPayerDesc",e.getParameters().selectedContexts[0].getObject().PayerName);this.getView().getModel("baseModel").refresh();this._pricingSimulation(this.getView().getModel("exchangeModel").getProperty("/results"),"Exchange")}else{s.show("Add items for exchange")}},onConfirmChangeBillTo:function(e){e.getSource().getBinding("items").filter([]);if(this.getView().getModel("exchangeModel")&&this.getView().getModel("exchangeModel").getProperty("/results").length>0){this.getView().getModel("baseModel").setProperty("/exBillTo",e.getParameters().selectedContexts[0].getObject().BillToPartyCode);this.getView().getModel("baseModel").setProperty("/exBillToDesc",e.getParameters().selectedContexts[0].getObject().BillToPartyName);this.getView().getModel("baseModel").refresh();this._pricingSimulation(this.getView().getModel("exchangeModel").getProperty("/results"),"Exchange")}else{s.show("Add items for exchange")}},onConfirmChangeShipTo:function(e){e.getSource().getBinding("items").filter([]);if(this.getView().getModel("exchangeModel")&&this.getView().getModel("exchangeModel").getProperty("/results").length>0){this.getView().getModel("baseModel").setProperty("/exShipTo",e.getParameters().selectedContexts[0].getObject().ShipToPartyCode);this.getView().getModel("baseModel").setProperty("/exShipToDesc",e.getParameters().selectedContexts[0].getObject().ShipToPartyName);this.getView().getModel("baseModel").refresh();this._pricingSimulation(this.getView().getModel("exchangeModel").getProperty("/results"),"Exchange")}else{s.show("Add items for exchange")}},handleAddDivision:function(e){e.getSource().getBinding("items").filter([]);this.getView().getModel("baseModel").setProperty("/Division",e.getParameters().selectedContexts[0].getObject().Division);this.getView().getModel("baseModel").setProperty("/DivisionDesc",e.getParameters().selectedContexts[0].getObject().Name);this.getView().getModel("baseModel").refresh()},onLiveChangeDivision:function(e){var t=e.getParameters().value;var r=new Array;var s=new sap.ui.model.Filter([new sap.ui.model.Filter("Name",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("Division",sap.ui.model.FilterOperator.Contains,t)]);r.push(s);var o=e.getSource().getBinding("items");o.filter(r)},onClickROType:function(e){var t=this;var r=this.getView().getModel("baseModel");var s=e.getSource().getBindingContext("ROTypeListModel").getObject();this.ROtypeCode=s.roType;r.setProperty("/selectedROType",s.roTypeDesc);r.setProperty("/selectedROTypeCode",this.ROtypeCode);if(this.ROtypeCode==="TI"){this.getView().getModel("invoiceSearchModel").setProperty("/billingCategory","B");this.getView().getModel("invoiceSearchModel").setProperty("/billingCategoryDesc","Consignment Fill Up");r.setProperty("/visiblityROTypeSel",false);r.setProperty("/visiblityROTypeText",true)}else{this.getView().getModel("invoiceSearchModel").setProperty("/billingCategory","C");this.getView().getModel("invoiceSearchModel").setProperty("/billingCategoryDesc","Commercial Invoice");r.setProperty("/visiblityROTypeSel",true);r.setProperty("/visiblityROTypeText",false)}r.refresh();var o=[];var a=new sap.ui.model.Filter("roType",sap.ui.model.FilterOperator.EQ,this.ROtypeCode);o.push(a);var i=t.getView().getModel("ZDKSH_CC_RETURNS_MANAGEMENT_SRV");var n=new sap.m.BusyDialog;n.open();i.read("/roTypeReturnReasonSet",{filters:o,async:false,success:function(e,r){n.close();t.reasonModel=new sap.ui.model.json.JSONModel({results:e.results});t.getView().setModel(t.reasonModel,"OrderReasonSet");t._getSLoc()},error:function(e){n.close();var r=JSON.parse(e.responseText);r=r.error.message.value;t.errorMsg(r)}})},_getSLoc:function(){var e=this;var r=[];var s=new sap.ui.model.Filter("roType",sap.ui.model.FilterOperator.EQ,this.ROtypeCode);r.push(s);var o=e.getView().getModel("ZDKSH_CC_RETURNS_MANAGEMENT_SRV");var a=new sap.m.BusyDialog;a.open();o.read("/roTypeSlocSet",{filters:r,async:false,success:function(r,s){a.close();if(r.results.length>0){if(e.selectedReturnItems){for(var o=0;o<e.selectedReturnItems.length;o++){e.selectedReturnItems[o].storageLocation=r.results[0].Sloc}}e.getView().getModel("baseModel").setProperty("/roTypeSLoc",r.results[0].Sloc)}else{t.error(e.resourceBundle.getText("NoSLocAvailablefor")+this.ROtypeCode)}e._getOrderType()},error:function(t){a.close();var r=JSON.parse(t.responseText);r=r.error.message.value;e.errorMsg(r)}})},_getRoTypeList:function(){var e=this;var t=this.getView().getModel("ZDKSH_CC_RETURNS_MANAGEMENT_SRV");var r=new sap.m.BusyDialog;r.open();t.read("/returnTypeSet",{async:true,success:function(t){r.close();var s=t.results;var o=[];for(var a=0;a<s.length;a++){if(s[a].roType==="TG"){var i={roType:s[a].roType,icon:"sap-icon://inspect"};o.splice(0,0,i)}if(s[a].roType==="TF"){var i={roType:s[a].roType,icon:"sap-icon://inspect-down"};o.splice(1,0,i)}if(s[a].roType==="TI"){var i={roType:s[a].roType,icon:"sap-icon://paid-leave"};o.splice(2,0,i)}if(s[a].roType==="TK"){var i={roType:s[a].roType,icon:"sap-icon://activity-2"};o.splice(3,0,i)}}for(var a=0;a<o.length;a++){for(var n=0;n<s.length;n++){if(s[n].roType===o[a].roType){o[a].roTypeDesc=s[n].roTypeDesc}}}var l=new sap.ui.model.json.JSONModel({results:o});e.getView().setModel(l,"ROTypeListModel")},error:function(t){r.close();var s=JSON.parse(t.responseText);s=s.error.message.value;e.errorMsg(s)}})},_getReasonOwner:function(){var e=this;var t=[];var r=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("roType",sap.ui.model.FilterOperator.EQ,this.ROtypeCode),new sap.ui.model.Filter("returnReasonCode",sap.ui.model.FilterOperator.EQ,this.retReasonCode)],and:true});t.push(r);var s=e.getView().getModel("ZDKSH_CC_RETURNS_MANAGEMENT_SRV");var o=new sap.m.BusyDialog;o.open();s.read("/reasonOwnerSet",{filters:t,async:false,success:function(t,r){o.close();var s=new sap.ui.model.json.JSONModel({results:t.results});e.getView().setModel(s,"reasonOwnerModel")},error:function(t){o.close();var r=JSON.parse(t.responseText);r=r.error.message.value;e.errorMsg(r)}})},onPressShowAddress:function(e){var t=e.getSource();if(!this._oPopover){o.load({name:"incture.com.Inventory.Fragments.popoverTable",controller:this}).then(function(e){this._oPopover=e;this.getView().addDependent(this._oPopover);this._oPopover.bindElement("");if(sap.ui.Device.system.phone===true){this._oPopover.setPlacement("Bottom");this._oPopover.openBy(t)}else{this._oPopover.openBy(t)}}.bind(this))}else{if(sap.ui.Device.system.phone===true){this._oPopover.setPlacement("Bottom");this._oPopover.openBy(t)}else{this._oPopover.openBy(t)}}},handleAddDistChan:function(e){e.getSource().getBinding("items").filter([]);this.getView().getModel("baseModel").setProperty("/DistChan",e.getParameters().selectedContexts[0].getObject().DistChl);this.getView().getModel("baseModel").setProperty("/selectedDistChnl",e.getParameters().selectedContexts[0].getObject().DistChl);this.getView().getModel("baseModel").setProperty("/DistChanDesc",e.getParameters().selectedContexts[0].getObject().Name);this.getView().getModel("baseModel").refresh()},onEditMaterial:function(e){var t=this;var r=this.getView().getModel("invoiceSearchModel");var o=this.getView().getModel("baseModel");var a=[];var i=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("materialNum",sap.ui.model.FilterOperator.EQ,t.getView().getModel("baseModel").getProperty("/newMaterial")),new sap.ui.model.Filter("salesOrg",sap.ui.model.FilterOperator.EQ,r.getData().salesOrgNo),new sap.ui.model.Filter("distChannel",sap.ui.model.FilterOperator.EQ,r.getData().distChnl),new sap.ui.model.Filter("division",sap.ui.model.FilterOperator.EQ,r.getData().Division),new sap.ui.model.Filter("shipToParty",sap.ui.model.FilterOperator.EQ,r.getData().shipTo),new sap.ui.model.Filter("soldToParty",sap.ui.model.FilterOperator.EQ,r.getData().soldToParty),new sap.ui.model.Filter("orderType",sap.ui.model.FilterOperator.EQ,this.getView().getModel("baseModel").getData().exchangeOrderType),new sap.ui.model.Filter("materialGroup",sap.ui.model.FilterOperator.EQ,t.materialGroupDataAccess),new sap.ui.model.Filter("materialGroup4",sap.ui.model.FilterOperator.EQ,t.materialGroup4DataAccess),new sap.ui.model.Filter("customerCodeDac",sap.ui.model.FilterOperator.EQ,t.custCodeDataAccess),new sap.ui.model.Filter("materialCodeDac",sap.ui.model.FilterOperator.EQ,t.materialDataAccess)],and:true});a.push(i);var n=this.getView().getModel("ZDKSH_cc_returns_management_SRV");var l=new sap.m.BusyDialog;l.open();n.read("/materialDataSet",{async:false,filters:a,urlParameters:"&$expand=materialDataToMaterialAltUom,materialDataToMatPricingScale,materialDataToMatBonusGoods&$format=json",success:function(e,r){l.close();var e=e.results[0];if(e.active==="E"){s.show(t.resourceBundle.getText("exchangenotallowed"))}else{if(t.getView().getModel("exchangeModel").getData().results){var o=t.getView().byId("ExchangeTableId").getModel("exchangeModel").getData().results}else{var a=new sap.ui.model.json.JSONModel;t.getView().setModel(a,"exchangeModel");t.getView().getModel("exchangeModel").setProperty("/results",[]);var o=t.getView().byId("ExchangeTableId").getModel("exchangeModel").getData().results}var i={Active:"",itemNumber:"",matNumber:e.materialNum,itemShortText:e.materialDesc,materialGroup:e.materialGroup,materialGroup4:e.materialGroup4,avlRetQty:"",quantity:e.quantity,salesUnit:e.uom,unitPrice:e.unitPrice,unitPriceInv:"",discountAmount:"",netAmount:"",SLoc:"",higherItem:"",batchNumber:"",expiryDate:"",refInvoice:"",refItemNumber:"",billingDate:"",serialNumber:"",listPrice:e.listPrice,deleted:"false",manualFOC:""};o.push(i);t.getView().getModel("exchangeModel").setProperty("/results",o);t.getView().getModel("exchangeModel").refresh();t.getView().getModel("baseModel").setProperty("/newMaterial","");t.getView().getModel("baseModel").refresh();t.AddMaterial.close()}},error:function(e){l.close();var r=JSON.parse(e.responseText);r=r.error.message.value;t.errorMsg(r);t.AddMaterial.close()}})},onPressInvoiceDetail:function(e){if(sap.ui.Device.system.phone===true){var t=e.getSource().getBindingContext("invoiceSearchModel").getObject();var r=e.getSource();if(!this._oPopover){o.load({name:"dksh.connectclient.CreateReturn.Fragments.InvoicePopover",controller:this}).then(function(e){this._oPopover=e;this.getView().addDependent(this._oPopover);var s=new sap.ui.model.json.JSONModel({results:t});this._oPopover.setModel(s,"invoiceSearchPopoverModel");this._oPopover.getModel("invoiceSearchPopoverModel").refresh();this._oPopover.setModel(this.getView().getModel("PersonalizationModel"),"PersonalizationModel");this._oPopover.getModel("PersonalizationModel").refresh();if(sap.ui.Device.system.phone===true){this._oPopover.setPlacement("Bottom");this._oPopover.openBy(r)}else{this._oPopover.openBy(r)}}.bind(this))}else{var s=new sap.ui.model.json.JSONModel({results:t});this._oPopover.setModel(s,"invoiceSearchPopoverModel");this._oPopover.getModel("invoiceSearchPopoverModel").refresh();this._oPopover.setModel(this.getView().getModel("PersonalizationModel"),"PersonalizationModel");this._oPopover.getModel("PersonalizationModel").refresh();if(sap.ui.Device.system.phone===true){this._oPopover.setPlacement("Bottom");this._oPopover.openBy(r)}else{this._oPopover.openBy(r)}}}},onPressReturnDetail:function(e){if(sap.ui.Device.system.phone===true){var t=e.getSource().getBindingContext("returnModel").getObject();var r=e.getSource();if(!this._oPopover){o.load({name:"dksh.connectclient.CreateReturn.Fragments.ReturnPopover",controller:this}).then(function(e){this._oPopover=e;this.getView().addDependent(this._oPopover);var s=new sap.ui.model.json.JSONModel({results:t});this._oPopover.setModel(s,"returnPopoverModel");this._oPopover.getModel("returnPopoverModel").refresh();this._oPopover.setModel(this.getView().getModel("PersonalizationModel"),"PersonalizationModel");this._oPopover.getModel("PersonalizationModel").refresh();if(sap.ui.Device.system.phone===true){this._oPopover.setPlacement("Bottom");this._oPopover.openBy(r)}else{this._oPopover.openBy(r)}}.bind(this))}else{var s=new sap.ui.model.json.JSONModel({results:t});this._oPopover.setModel(s,"returnPopoverModel");this._oPopover.getModel("returnPopoverModel").refresh();this._oPopover.setModel(this.getView().getModel("PersonalizationModel"),"PersonalizationModel");this._oPopover.getModel("PersonalizationModel").refresh();if(sap.ui.Device.system.phone===true){this._oPopover.setPlacement("Bottom");this._oPopover.openBy(r)}else{this._oPopover.openBy(r)}}}},onPressReturnDetailPopover:function(e){if(sap.ui.Device.system.phone===true){var t=e.getSource().getBindingContext("returnPreviewModel").getObject();var r=e.getSource();if(!this._oPopover){o.load({name:"dksh.connectclient.CreateReturn.Fragments.ReturnPreviewPopover",controller:this}).then(function(e){this._oPopover=e;this.getView().addDependent(this._oPopover);var s=new sap.ui.model.json.JSONModel({results:t});this._oPopover.setModel(s,"returnPreviewPopoverModel");this._oPopover.getModel("returnPreviewPopoverModel").refresh();this._oPopover.setModel(this.getView().getModel("PersonalizationModel"),"PersonalizationModel");this._oPopover.getModel("PersonalizationModel").refresh();if(sap.ui.Device.system.phone===true){this._oPopover.setPlacement("Bottom");this._oPopover.openBy(r)}else{this._oPopover.openBy(r)}}.bind(this))}else{var s=new sap.ui.model.json.JSONModel({results:t});this._oPopover.setModel(s,"returnPreviewPopoverModel");this._oPopover.getModel("returnPreviewPopoverModel").refresh();this._oPopover.setModel(this.getView().getModel("PersonalizationModel"),"PersonalizationModel");this._oPopover.getModel("PersonalizationModel").refresh();if(sap.ui.Device.system.phone===true){this._oPopover.setPlacement("Bottom");this._oPopover.openBy(r)}else{this._oPopover.openBy(r)}}}},onPressExchangeDetailPopover:function(e){if(sap.ui.Device.system.phone===true){var t=e.getSource().getBindingContext("exchangePreviewModel").getObject();var r=e.getSource();if(!this._oPopover){o.load({name:"dksh.connectclient.CreateReturn.Fragments.ExchangePreviewPopover",controller:this}).then(function(e){this._oPopover=e;this.getView().addDependent(this._oPopover);var s=new sap.ui.model.json.JSONModel({results:t});this._oPopover.setModel(s,"exchangePreviewPopoverModel");this._oPopover.getModel("exchangePreviewPopoverModel").refresh();this._oPopover.setModel(this.getView().getModel("PersonalizationModel"),"PersonalizationModel");this._oPopover.getModel("PersonalizationModel").refresh();if(sap.ui.Device.system.phone===true){this._oPopover.setPlacement("Bottom");this._oPopover.openBy(r)}else{this._oPopover.openBy(r)}}.bind(this))}else{var s=new sap.ui.model.json.JSONModel({results:t});this._oPopover.setModel(s,"exchangePreviewPopoverModel");this._oPopover.getModel("exchangePreviewPopoverModel").refresh();this._oPopover.setModel(this.getView().getModel("PersonalizationModel"),"PersonalizationModel");this._oPopover.getModel("PersonalizationModel").refresh();if(sap.ui.Device.system.phone===true){this._oPopover.setPlacement("Bottom");this._oPopover.openBy(r)}else{this._oPopover.openBy(r)}}}},onPressExchangeDetail:function(e){if(sap.ui.Device.system.phone===true){var t=e.getSource().getBindingContext("exchangeModel").getObject();var r=e.getSource();if(!this._oPopover){o.load({name:"dksh.connectclient.CreateReturn.Fragments.ExchangePopover",controller:this}).then(function(e){this._oPopover=e;this.getView().addDependent(this._oPopover);var s=new sap.ui.model.json.JSONModel({results:t});this._oPopover.setModel(s,"exchangePopoverModel");this._oPopover.getModel("exchangePopoverModel").refresh();this._oPopover.setModel(this.getView().getModel("PersonalizationModel"),"PersonalizationModel");this._oPopover.getModel("PersonalizationModel").refresh();if(sap.ui.Device.system.phone===true){this._oPopover.setPlacement("Bottom");this._oPopover.openBy(r)}else{this._oPopover.openBy(r)}}.bind(this))}else{var s=new sap.ui.model.json.JSONModel({results:t});this._oPopover.setModel(s,"exchangePopoverModel");this._oPopover.getModel("exchangePopoverModel").refresh();this._oPopover.setModel(this.getView().getModel("PersonalizationModel"),"PersonalizationModel");this._oPopover.getModel("PersonalizationModel").refresh();if(sap.ui.Device.system.phone===true){this._oPopover.setPlacement("Bottom");this._oPopover.openBy(r)}else{this._oPopover.openBy(r)}}}},onFileUploadChange:function(e){var t=this;var r=e.getSource();if(this.docVersion==="SUCCESS"||this.attachmentName==="Preview"){s.show(this.resourceBundle.getText("CannotUpload"));return}this.file=e.getParameter("files")[0];if(this.file){var o=new FileReader;let e=[];o.onload=function(t){var r;if(!t){r=o.content}else{r=t.target.result}if(t.target.readyState==FileReader.DONE){let r=t.target.result,s=new Uint8Array(r);for(var a of s){e.push(a)}}var i=0;var n={};n["fileName"]=this.file.name;n["fileSize"]=this.file.size;n["fileType"]=this.file.type;n["fileDoc"]=e;n["compressedFile"]=n["fileDoc"];n["returnReqNum"]="";n["docId"]="";for(var l=0;l<this.getView().getModel("returnModel").getData().attachmentObject.length;l++){if(this.file.name===this.getView().getModel("returnModel").getData().attachmentObject[l].fileName){s.show(this.resourceBundle.getText("sameFileValidation"));return}i=i+this.getView().getModel("returnModel").getData().attachmentObject[l].fileSize}if(i+this.file.size>1048576){s.show(this.resourceBundle.getText("fileSizeValidation"));return}this.getView().getModel("returnModel").getData().attachmentObject.push(n);this.getView().getModel("baseModel").setProperty("/attachmentLength",this.getView().getModel("returnModel").getData().attachmentObject.length);this.getView().getModel("returnModel").refresh();this.getView().getModel("baseModel").setProperty("/enableViewAttachment",true);this.getView().getModel("baseModel").setProperty("/attachmentTableVisiblity",true);this.getView().getModel("baseModel").refresh()}.bind(this)}o.readAsArrayBuffer(this.file);r.clear()},onRemoveAttachmennt:function(e){var t=this;var r=e.getSource().getBindingContext("returnModel").getObject().fileName;var s=this.getView().getModel("returnModel").getData().attachmentObject;for(var o=0;o<s.length;o++){if(s[o].fileName===r){var a=s[o].docId}}if(a!==""&&a!==undefined){var i=new sap.ui.model.json.JSONModel;t.getView().setModel(i,"oModel");var n=new sap.m.BusyDialog;n.open();var l={"Content-Type":"application/json;charset=utf-8"};i.loadData("/DKSHJavaService/Attachment/deleteAttachment/"+a,null,true,"DELETE",false,false,l);i.attachRequestCompleted(function(e){n.close();for(var t=0;t<s.length;t++){if(s[t].fileName===r){returnModel.getData().attachmentObject.splice(t,1);returnModel.refresh()}if(r===this.file.name){this.getView().getModel("dashBoardModel").getData().attachmentValue=""}}});i.attachRequestFailed(function(e){n.close()})}else{for(var o=0;o<s.length;o++){if(s[o].fileName===r){this.getView().getModel("returnModel").getData().attachmentObject.splice(o,1);this.getView().getModel("returnModel").refresh()}}}if(this.getView().getModel("returnModel").getData().attachmentObject.length===0){this.getView().getModel("baseModel").setProperty("/enableViewAttachment",false);this.getView().getModel("baseModel").setProperty("/attachmentTableVisiblity",false)}},addRow:function(e){if(!this.AddMaterial){this.AddMaterial=sap.ui.xmlfragment("dksh.connectclient.CreateReturn.Fragments.AddMaterial",this);this.getView().addDependent(this.AddMaterial);this.AddMaterial.addStyleClass("sapUiSizeCompact")}this.AddMaterial.open()},closeAddMaterialFrag:function(){this.getView().getModel("baseModel").setProperty("/newMaterial","");this.AddMaterial.close()},addMaterial:function(e){this.onEditMaterial()},returnDeleteRow:function(e){var t=0;var r=0;this.selectedRetItemsforDelete=JSON.parse(JSON.stringify(this.getView().byId("ReturnTableId").getSelectedContextPaths()));if(this.selectedRetItemsforDelete.length>0){var o=this.getView().getModel("returnModel").getData().results;var a=this.getView().getModel("returnModel").getData().returnConditions;this.getView().byId("ReturnTableId").getSelectedItems()[0].getBindingContext("returnModel").getObject();for(var i=this.selectedRetItemsforDelete.length-1;i>=0;i--){var n=parseInt(this.selectedRetItemsforDelete[i].split("/")[2]);o[n].deleted="true";this.getView().byId("ReturnTableId").getItems()[n].setSelected(false);s.show(this.resourceBundle.getText("ItemDeleted"));for(var l=this.selectedReturnItems.length-1;l>=0;l--){if(this.selectedReturnItems[l].InvoiceLineItem===o[n].refItemNumber&&this.selectedReturnItems[l].InvoiceNum===o[n].refInvoice){this.selectedReturnItems.splice(l,1)}for(var d=0;d<a.length;d++){if(o[n].refInvoice===a[d].refInvoice&&o[n].itemNumber===a[d].itemNumber){a[d].deleted="true"}}}this.getView().getModel("returnModel").setProperty("/returnConditions",a)}for(var d=0;d<o.length;d++){if(o[d].deleted==="false"){t=t+parseFloat(o[d].netAmount);++r}}if(r===0){if(this.getView().getModel("exchangeModel").getData().results!==undefined&&this.getView().getModel("exchangeModel").getData().results.length>0){this.getView().getModel("exchangeModel").getData().results="";this.getView().getModel("baseModel").setProperty("/exchangeLength","Exchange "+"(0)");this.getView().getModel("baseModel").setProperty("/exchangeAmountTotal","0.00 (THB)");this.getView().getModel("exchangeModel").refresh()}this.getView().getModel("baseModel").setProperty("/disableSoldToParty",true);this.getView().getModel("baseModel").refresh()}this.getView().getModel("returnModel").setProperty("/results",o);var g=new sap.ui.model.Filter("deleted",sap.ui.model.FilterOperator.Contains,"false");var p=[];p=this.getView().byId("ReturnTableId").getBinding("items");p.filter([g]);this.getView().getModel("returnModel").setProperty("/returnAmountTotal",t.toFixed(2)+"(THB)");this.getView().getModel("returnModel").setProperty("/returnLength","Return ("+r+")");this.getView().getModel("returnModel").refresh(true)}else{s.show(this.resourceBundle.getText("selectItemValidation"))}},deleteRow:function(e){var t=0;var r=0;this.deletedItem=[];this.selectedItemsforDelete=JSON.parse(JSON.stringify(this.getView().byId("ExchangeTableId").getSelectedContextPaths()));if(this.selectedItemsforDelete.length>0){var o=this.getView().getModel("exchangeModel").getData().results;for(var a=0;a<this.selectedItemsforDelete.length;a++){var i=parseInt(this.selectedItemsforDelete[a].split("/")[2]);o[i].deleted="true";this.deletedItem.push(o[i]);this.getView().byId("ExchangeTableId").getItems()[i].setSelected(false);s.show(this.resourceBundle.getText("ItemDeleted"))}var n=[];for(var l=0;l<o.length;l++){if(o[l].deleted==="false"){t=t+parseFloat(o[l].netAmount);++r;if(o[l].refInvoice===""&&o[l].higherItem!=="000000"&&o[l].higherItem!==""&&o[l].manualFoc!=="X"){}else{n.push(o[l])}}else{for(var a=0;a<o.length;a++){if(o[l].itemNumber===o[a].higherItem){o[a].deleted="true"}}}}if(n.length>0){this._pricingSimulation(n,"ExchangeTab")}this.getView().getModel("exchangeModel").setProperty("/results",o);var d=new sap.ui.model.Filter("deleted",sap.ui.model.FilterOperator.Contains,"false");var g=[];g=this.getView().byId("ExchangeTableId").getBinding("items");g.filter([d]);this.getView().getModel("exchangeModel").setProperty("/exchangeAmountTotal",t.toFixed(2)+"(THB)");this.getView().getModel("exchangeModel").setProperty("/exchangeLength","Exchange ("+r+")");this.getView().getModel("exchangeModel").refresh(true);if(this.selectedItemsforDelete.length===o.length){this.getView().byId("ID_TAB_BAR_PROV_APP").setSelectedKey("Return")}}else{s.show(this.resourceBundle.getText("selectItemValidation"))}},returnUndoDelete:function(e){var t=0;var r=0;if(this.selectedRetItemsforDelete!==undefined&&this.selectedRetItemsforDelete.length>0){var o=this.getView().getModel("returnModel").getData().results;for(var a=0;a<this.selectedRetItemsforDelete.length;a++){var i=parseInt(this.selectedRetItemsforDelete[a].split("/")[2]);o[i].deleted="false";var n={InvoiceLineItem:o[i].refItemNumber,InvoiceNum:o[i].refInvoice};this.selectedReturnItems.push(n);var l=this.getView().getModel("returnModel").getProperty("/returnConditions");for(var d=0;d<l.length;d++){if(o[i].refInvoice===l[d].refInvoice&&o[i].itemNumber===l[d].itemNumber){l[d].deleted="false"}}this.getView().getModel("returnModel").setProperty("/returnConditions",l)}for(var d=0;d<o.length;d++){if(o[d].deleted==="false"){t=t+parseFloat(o[d].netAmount);++r}}var g=new sap.ui.model.Filter("deleted",sap.ui.model.FilterOperator.Contains,"false");var p=[];p=this.getView().byId("ReturnTableId").getBinding("items");p.filter([g]);this.getView().getModel("returnModel").setProperty("/returnAmountTotal",t.toFixed(2)+"(THB)");this.getView().getModel("returnModel").setProperty("/returnLength","Return ("+r+")");this.getView().getModel("returnModel").refresh(true);this.selectedRetItemsforDelete=undefined}else{s.show(this.resourceBundle.getText("undoValidation"))}},undoDelete:function(e){var t=0;var r=0;if(this.deletedItem!==undefined&&this.deletedItem.length>0){var o=this.getView().getModel("exchangeModel").getData().results;for(var a=0;a<this.selectedItemsforDelete.length;a++){var i=parseInt(this.selectedItemsforDelete[a].split("/")[2]);o.splice(i,0,this.deletedItem[a]);o[i].deleted="false";for(var n=0;n<o.length;n++){if(o[i].itemNumber===o[n].higherItem){o[n].deleted="false"}}}var l=[];for(var d=0;d<o.length;d++){if(o[d].deleted==="false"){if(o[d].higherItem!=="000000"&&o[d].higherItem!==""&&o[d].manualFoc!=="X"){}else{l.push(o[d])}t=t+parseFloat(o[d].netAmount);++r}}var g=new sap.ui.model.Filter("deleted",sap.ui.model.FilterOperator.Contains,"false");var p=[];p=this.getView().byId("ExchangeTableId").getBinding("items");p.filter([g]);this.getView().getModel("exchangeModel").setProperty("/exchangeAmountTotal",t.toFixed(2)+"(THB)");this.getView().getModel("exchangeModel").setProperty("/exchangeLength","Exchange ("+r+")");this.getView().getModel("exchangeModel").refresh(true);this._pricingSimulation(l,"ExchangeTab");this.deletedItem=[]}else{s.show(this.resourceBundle.getText("undoValidation"))}},onpressPreview:function(){if(this._oPopover){this._oPopover=undefined}var e=[];var r=[];var s=0;var o=0;var a=this.getView().getModel("returnModel").getProperty("/results");var i=this.getView().getModel("exchangeModel").getProperty("/results");if(i!==undefined&&i.length>0){for(var n=0;n<i.length;n++){if(i[n].deleted==="false"){r.push(JSON.parse(JSON.stringify(i[n])));if(i[n].netAmount===""||i[n].netAmount===undefined){i[n].netAmount=0}s=s+parseFloat(i[n].netAmount)}}this.getView().getModel("exchangePreviewModel").setProperty("/exchangeAmount",s+"(THB)");this.getView().getModel("exchangePreviewModel").setProperty("/results",r);this.getView().getModel("exchangePreviewModel").setProperty("/exchangePreviewLength","Exchange ("+r.length+")")}if(a!==undefined&&a.length>0){this._wizard.setCurrentStep(this.byId("ID_WIZARD_PREVIEW"));for(var l=0;l<a.length;l++){if(a[l].deleted==="false"){e.push(JSON.parse(JSON.stringify(a[l])));if(a[l].netAmount===""||a[l].netAmount===undefined){a[l].netAmount=0}o=o+parseFloat(a[l].netAmount)}}this.getView().getModel("returnPreviewModel").setProperty("/returnAmount",o+"(THB)");this.getView().getModel("returnPreviewModel").setProperty("/results",e);this.getView().getModel("returnPreviewModel").setProperty("/returnPreviewLength","Return ("+e.length+")")}else{t.information(this.resourceBundle.getText("Selectatleastoneitem"))}},onPressSave:function(e){var r=this.getView().getModel("baseModel").getData();var o=this.getView().getModel("invoiceSearchModel").getData();var a=this.getView().getModel("returnModel");var i=this.getView().getModel("exchangeModel");var r=this.getView().getModel("baseModel");r.setProperty("/savePressed",true);if(this.RetQtyCount>0){t.error(this.resourceBundle.getText("EnteredReturnedQtycannotbegreaterthanAvailableReturnQty"));return}if(this.getView().getModel("baseModel").getProperty("/reasonOwner")===""||this.getView().getModel("baseModel").getProperty("/reasonOwner")===undefined){s.show(this.resourceBundle.getText("ReasonOwnerisMandatory"));return}if(this.getView().getModel("baseModel").getProperty("/referenceNo")===""||this.getView().getModel("baseModel").getProperty("/referenceNo")===undefined){s.show(this.resourceBundle.getText("referenceNoisMandatory"));return}if(r.getProperty("/oneTimeCustomer")==="X"&&r.getProperty("/returnSoldTo")!==r.getProperty("/exSoldTo")&&r.getProperty("/EXOneTimeCustomer")==="X"){if(!this.address){this.address=sap.ui.xmlfragment("dksh.connectclient.CreateReturn.Fragments.Address",this);this.getView().addDependent(this.address)}this._loadCity();if(this.getView().getModel("editDraftModel")){if(this.changeSoldToParty===true){if(this.selectedReturnItems[0].soldToAddress){if(this.selectedReturnItems[0].soldToAddress.language==="TH"||this.selectedReturnItems[0].soldToAddress.language==="2"){this.selectedReturnItems[0].soldToAddress.language="2"}else{this.selectedReturnItems[0].soldToAddress.language="E"}if(this.selectedReturnItems[0].shipToAddress.language==="TH"||this.selectedReturnItems[0].shipToAddress.language==="2"){this.selectedReturnItems[0].shipToAddress.language="2"}else{this.selectedReturnItems[0].shipToAddress.language="E"}if(this.selectedReturnItems[0].billToAdress.language==="TH"||this.selectedReturnItems[0].billToAdress.language==="2"){this.selectedReturnItems[0].billToAdress.language="2"}else{this.selectedReturnItems[0].billToAdress.language="E"}if(this.selectedReturnItems[0].payerAddress.language==="TH"||this.selectedReturnItems[0].payerAddress.language==="2"){this.selectedReturnItems[0].payerAddress.language="2"}else{this.selectedReturnItems[0].payerAddress.language="E"}}r.setProperty("/partnerName","");r.setProperty("/AddressStreet2","");r.setProperty("/AddressStreet3","");r.setProperty("/AddressStreet5","");r.setProperty("/District","");r.setProperty("/DifferentCity","");r.setProperty("/postalCode","");r.setProperty("/city","");r.setProperty("/telephone","");r.setProperty("/mobileNumber","");r.setProperty("/invRetCountry",this.selectedReturnItems[0].soldToAddress.countryCode);r.setProperty("/invRetRegion",this.selectedReturnItems[0].soldToAddress.region);r.setProperty("/invRetLanguage",this.selectedReturnItems[0].soldToAddress.language);r.setProperty("/taxId","");r.setProperty("/bCode","00000");r.setProperty("/bpNummr","N");r.setProperty("/partnerName4","");r.setProperty("/maxLengthName4","40 char remaining");r.setProperty("/maxLengthAddressStreet2","40 char remaining");r.setProperty("/maxLengthAddressStreet3","40 char remaining");r.setProperty("/maxLengthAddressStreet5","40 char remaining");r.setProperty("/maxLengthDistrict","40 char remaining");r.setProperty("/maxLengthDifferentCity","40 char remaining");r.setProperty("/maxLengthPostalCode","5 char remaining");r.setProperty("/maxLengthtelephone","30 char remaining");r.setProperty("/maxLengthmobileNumber","30 char remaining");r.setProperty("/maxLengthtaxId","13 char remaining");r.setProperty("/maxLengthbCode","0 char remaining");r.setProperty("/maxLengthbpNummr","0 char remaining");this.address.open();return}else{r.setProperty("/maxLengthName4",40-r.getProperty("/partnerName4").length+" char remaining");r.setProperty("/maxLengthAddressStreet2",40-r.getProperty("/AddressStreet2").length+" char remaining");r.setProperty("/maxLengthAddressStreet3",40-r.getProperty("/AddressStreet3").length+" char remaining");r.setProperty("/maxLengthAddressStreet5",40-r.getProperty("/AddressStreet5").length+" char remaining");r.setProperty("/maxLengthDistrict",40-r.getProperty("/District").length+" char remaining");r.setProperty("/maxLengthDifferentCity",40-r.getProperty("/DifferentCity").length+" char remaining");r.setProperty("/maxLengthPostalCode",5-r.getProperty("/postalCode").length+" char remaining");r.setProperty("/maxLengthtelephone",30-r.getProperty("/telephone").length+" char remaining");r.setProperty("/maxLengthmobileNumber",30-r.getProperty("/mobileNumber").length+" char remaining");r.setProperty("/maxLengthtaxId",13-r.getProperty("/taxId").length+" char remaining");r.setProperty("/maxLengthbCode",5-r.getProperty("/bCode").length+" char remaining");r.setProperty("/maxLengthbpNummr",1-r.getProperty("/bpNummr").length+" char remaining");this.address.open();return}}else{r.setProperty("/partnerName","");r.setProperty("/AddressStreet2","");r.setProperty("/AddressStreet3","");r.setProperty("/AddressStreet5","");r.setProperty("/District","");r.setProperty("/DifferentCity","");r.setProperty("/postalCode","");r.setProperty("/city","");r.setProperty("/telephone","");r.setProperty("/mobileNumber","");r.setProperty("/taxId","");r.setProperty("/bCode","00000");r.setProperty("/bpNummr","N");r.setProperty("/partnerName4","");r.setProperty("/maxLengthName4","40 char remaining");r.setProperty("/maxLengthAddressStreet2","40 char remaining");r.setProperty("/maxLengthAddressStreet3","40 char remaining");r.setProperty("/maxLengthAddressStreet5","40 char remaining");r.setProperty("/maxLengthDistrict","40 char remaining");r.setProperty("/maxLengthDifferentCity","40 char remaining");r.setProperty("/maxLengthPostalCode","5 char remaining");r.setProperty("/maxLengthtelephone","30 char remaining");r.setProperty("/maxLengthmobileNumber","30 char remaining");r.setProperty("/maxLengthtaxId","13 char remaining");r.setProperty("/maxLengthbCode","0 char remaining");r.setProperty("/maxLengthbpNummr","0 char remaining");this.address.open();return}}else if(r.getProperty("/oneTimeCustomer")==="X"&&i.getData().results!==undefined&&i.getData().results.length>0&&r.getProperty("/returnSoldTo")===r.getProperty("/exSoldTo")){if(!this.address){this.address=sap.ui.xmlfragment("dksh.connectclient.CreateReturn.Fragments.Address",this);this.getView().addDependent(this.address)}this._loadCity();if(this.docVersion===undefined){if(this.selectedReturnItems[0].soldToAddress.language==="TH"||this.selectedReturnItems[0].soldToAddress.language==="2"){this.selectedReturnItems[0].soldToAddress.language="2"}else{this.selectedReturnItems[0].soldToAddress.language="E"}if(this.selectedReturnItems[0].shipToAddress.language==="TH"||this.selectedReturnItems[0].shipToAddress.language==="2"){this.selectedReturnItems[0].shipToAddress.language="2"}else{this.selectedReturnItems[0].shipToAddress.language="E"}if(this.selectedReturnItems[0].billToAdress.language==="TH"||this.selectedReturnItems[0].billToAdress.language==="2"){this.selectedReturnItems[0].billToAdress.language="2"}else{this.selectedReturnItems[0].billToAdress.language="E"}if(this.selectedReturnItems[0].payerAddress.language==="TH"||this.selectedReturnItems[0].payerAddress.language==="2"){this.selectedReturnItems[0].payerAddress.language="2"}else{this.selectedReturnItems[0].payerAddress.language="E"}var n=this.selectedReturnItems[0];r.setProperty("/invCountry",this.selectedReturnItems[0].soldToAddress.countryCode);r.setProperty("/invRegion",this.selectedReturnItems[0].soldToAddress.region);r.setProperty("/invLanguage",this.selectedReturnItems[0].soldToAddress.language);r.setProperty("/partnerName",n.soldToAddress.partnerName);r.setProperty("/partnerName4",n.soldToAddress.partnerName4);r.setProperty("/AddressStreet2",n.soldToAddress.AddressStreet2);r.setProperty("/AddressStreet3",n.soldToAddress.AddressStreet3);r.setProperty("/AddressStreet5",n.soldToAddress.AddressStreet5);r.setProperty("/District",n.soldToAddress.District);r.setProperty("/DifferentCity",n.soldToAddress.DifferentCity);r.setProperty("/postalCode",n.soldToAddress.postalCode);r.setProperty("/city",n.soldToAddress.City);r.setProperty("/telephone",n.soldToAddress.telephone);r.setProperty("/mobileNumber",n.soldToAddress.mobileNumber);r.setProperty("/taxId",n.soldToAddress.taxId);r.setProperty("/bCode",n.soldToAddress.bCode);if(n.soldToAddress.bpNummr==="N"||n.soldToAddress.bpNummr==="H"){r.setProperty("/bCode","00000")}r.setProperty("/bpNummr",n.soldToAddress.bpNummr);r.setProperty("/maxLengthName4",40-n.soldToAddress.partnerName4.length+" char remaining");r.setProperty("/maxLengthAddressStreet2",40-n.soldToAddress.AddressStreet2.length+" char remaining");r.setProperty("/maxLengthAddressStreet3",40-n.soldToAddress.AddressStreet3.length+" char remaining");r.setProperty("/maxLengthAddressStreet5",40-n.soldToAddress.AddressStreet5.length+" char remaining");r.setProperty("/maxLengthDistrict",40-n.soldToAddress.District.length+" char remaining");r.setProperty("/maxLengthDifferentCity",40-n.soldToAddress.DifferentCity.length+" char remaining");r.setProperty("/maxLengthPostalCode",5-n.soldToAddress.postalCode.length+" char remaining");r.setProperty("/maxLengthtelephone",30-n.soldToAddress.telephone.length+" char remaining");r.setProperty("/maxLengthmobileNumber",30-n.soldToAddress.mobileNumber.length+" char remaining");r.setProperty("/maxLengthtaxId",13-n.soldToAddress.taxId.length+" char remaining");r.setProperty("/maxLengthbCode",5-r.getProperty("/bCode").length+" char remaining");r.setProperty("/maxLengthbpNummr",1-n.soldToAddress.bpNummr.length+" char remaining");this.address.setModel(r,"/baseModel");this.address.open()}else{r.setProperty("/maxLengthName4",40-r.getProperty("/partnerName4").length+" char remaining");r.setProperty("/maxLengthAddressStreet2",40-r.getProperty("/AddressStreet2").length+" char remaining");r.setProperty("/maxLengthAddressStreet3",40-r.getProperty("/AddressStreet3").length+" char remaining");r.setProperty("/maxLengthAddressStreet5",40-r.getProperty("/AddressStreet5").length+" char remaining");r.setProperty("/maxLengthDistrict",40-r.getProperty("/District").length+" char remaining");r.setProperty("/maxLengthDifferentCity",40-r.getProperty("/DifferentCity").length+" char remaining");r.setProperty("/maxLengthPostalCode",5-r.getProperty("/postalCode").length+" char remaining");r.setProperty("/maxLengthtelephone",30-r.getProperty("/telephone").length+" char remaining");r.setProperty("/maxLengthmobileNumber",30-r.getProperty("/mobileNumber").length+" char remaining");r.setProperty("/maxLengthtaxId",13-r.getProperty("/taxId").length+" char remaining");r.setProperty("/maxLengthbCode",5-r.getProperty("/bCode").length+" char remaining");r.setProperty("/maxLengthbpNummr",1-r.getProperty("/bpNummr").length+" char remaining");this.address.open()}return}else if(r.getProperty("/EXOneTimeCustomer")==="X"&&r.getProperty("/oneTimeCustomer")===""){if(!this.address){this.address=sap.ui.xmlfragment("dksh.connectclient.CreateReturn.Fragments.Address",this);this.getView().addDependent(this.address)}this._loadCity();if(this.selectedReturnItems[0].soldToAddress.language==="TH"||this.selectedReturnItems[0].soldToAddress.language==="2"){this.selectedReturnItems[0].soldToAddress.language="2"}else{this.selectedReturnItems[0].soldToAddress.language="E"}r.setProperty("/invCountry",this.selectedReturnItems[0].soldToAddress.countryCode);r.setProperty("/invRegion",this.selectedReturnItems[0].soldToAddress.region);r.setProperty("/invLanguage",this.selectedReturnItems[0].soldToAddress.language);r.setProperty("/partnerName","");r.setProperty("/AddressStreet2","");r.setProperty("/AddressStreet3","");r.setProperty("/AddressStreet5","");r.setProperty("/District","");r.setProperty("/DifferentCity","");r.setProperty("/postalCode","");r.setProperty("/city","");r.setProperty("/telephone","");r.setProperty("/mobileNumber","");r.setProperty("/taxId","");r.setProperty("/bCode","00000");r.setProperty("/bpNummr","N");r.setProperty("/partnerName4","");r.setProperty("/maxLengthName4","40 char remaining");r.setProperty("/maxLengthAddressStreet2","40 char remaining");r.setProperty("/maxLengthAddressStreet3","40 char remaining");r.setProperty("/maxLengthAddressStreet5","40 char remaining");r.setProperty("/maxLengthDistrict","40 char remaining");r.setProperty("/maxLengthDifferentCity","40 char remaining");r.setProperty("/maxLengthPostalCode","5 char remaining");r.setProperty("/maxLengthtelephone","30 char remaining");r.setProperty("/maxLengthmobileNumber","30 char remaining");r.setProperty("/maxLengthtaxId","13 char remaining");r.setProperty("/maxLengthbCode","5 char remaining");r.setProperty("/maxLengthbpNummr","1 char remaining");this.address.open();return}else if(r.getProperty("/EXOneTimeCustomer")===""&&r.getProperty("/returnSoldTo")!==r.getProperty("/exSoldTo")){this._continueSave();return}this._continueSave()},onOKAddrerss:function(e){var r=this.getView().getModel("baseModel");if(this.docVersion===undefined||this.docVersion==="DRAFT"||this.docVersion==="ERROR"){if(r.getProperty("/partnerName4")===undefined||r.getProperty("/partnerName4")===""||(r.getProperty("/AddressStreet2")===undefined||r.getProperty("/AddressStreet2")==="")||(r.getProperty("/taxId")===undefined||r.getProperty("/taxId")==="")||(r.getProperty("/AddressStreet5")===undefined||r.getProperty("/AddressStreet5")==="")||(r.getProperty("/District")===undefined||r.getProperty("/District")==="")||(r.getProperty("/DifferentCity")===undefined||r.getProperty("/DifferentCity")==="")||(r.getProperty("/postalCode")===undefined||r.getProperty("/postalCode")==="")||(r.getProperty("/city")===undefined||r.getProperty("/city")==="")){t.information("Enter all the mandatory fields")}else{if(r.getProperty("/bpNummr")===""&&r.getProperty("/bCode")===""){t.information("Enter BP Number/ BCode");return}else{if(r.getProperty("/bpNummr")==="N"||r.getProperty("/bpNummr")==="H"){if(r.getProperty("/bCode")!=="00000"&&r.getProperty("/bCode")!==""){t.information("Enter valid BCode");return}}else if(r.getProperty("/bpNummr")===""){}else{t.information("Enter valid BP Number")}}if(r.getProperty("/savePressed")===true){this._continueSave()}else{this._continueSubmit()}}}else{this.address.close()}},onCancelAddress:function(e){var t=this.getView().getModel("baseModel");if(this.docVersion===undefined){t.setProperty("/partnerNum","");t.setProperty("/partnerName4","");t.setProperty("/AddressStreet2","");t.setProperty("/AddressStreet3","");t.setProperty("/AddressStreet5","");t.setProperty("/District","");t.setProperty("/DifferentCity","");t.setProperty("/postalCode","");t.setProperty("/city","");t.setProperty("/telephone","");t.setProperty("/mobileNumber","");t.setProperty("/taxId","");t.setProperty("/bCode","00000");t.setProperty("/bpNummr","N");t.setProperty("/maxLengthName4","40 char remaining");t.setProperty("/maxLengthAddressStreet2","40 char remaining");t.setProperty("/maxLengthAddressStreet3","40 char remaining");t.setProperty("/maxLengthAddressStreet5","40 char remaining");t.setProperty("/maxLengthDistrict","40 char remaining");t.setProperty("/maxLengthDifferentCity","40 char remaining");t.setProperty("/maxLengthPostalCode","5 char remaining");t.setProperty("/maxLengthtelephone","30 char remaining");t.setProperty("/maxLengthmobileNumber","30 char remaining");t.setProperty("/maxLengthtaxId","13 char remaining");t.setProperty("/maxLengthbCode","5 char remainiing");t.setProperty("/maxLengthbpNummr","1 char remaining")}this.address.close()},_continueSave:function(e){var s=this;var o=this.getView().getModel("baseModel").getData();var a=this.getView().getModel("invoiceSearchModel").getData();var i=this.getView().getModel("returnModel");var n=this.getView().getModel("exchangeModel");var o=this.getView().getModel("baseModel");var l=[];var d=[];if(o.getData().returnReqNum){var g=o.getData().returnReqNum}else{var g=""}if(o.getData().exchangeReqNum){var p=o.getData().exchangeReqNum}else{var p=""}if(i.getData().results!==undefined||i.getData().results.length>0){var c=i.getData().results;for(var u=0;u<c.length;u++){if(c[u].deleted===undefined||c[u].deleted==="false"){var h={refDocNum:c[u].refInvoice,refDocItem:c[u].refItemNumber,returnReqItemid:c[u].itemNumber,materialGroup:c[u].materialGroup,materialGroup4:c[u].materialGroup4,material:c[u].matNumber,shortText:c[u].itemShortText,avlReturnQty:c[u].avlRetQty,avlUom:c[u].salesUnit,returnQty:c[u].quantity,returnUom:c[u].salesUnit,unitPriceCc:c[u].unitPrice,unitPriceInv:c[u].unitPriceInv,invoiceTotalAmount:i.getData().returnAmountTotal.split("(")[0],storageLocation:c[u].storageLocation,higherLevel:c[u].higherItem,batch:c[u].batchNumber,referenceInvDate:r.dateTimeFormatPS(c[u].billingDate).split("T")[0],expiryDate:r.dateTimeFormatPS(c[u].expiryDate).split("T")[0],pricingDate:r.dateTimeFormatPS(c[u].pricingDate),serviceRenderedDate:r.dateTimeFormatPS(c[u].serviceRenderedDate),serialNum:c[u].serialNumber,returnReqNum:g,billingType:a.billingType,sapReturnOrderNum:"",sapReturnOrderItemNum:"",overallItemWorkflowStatus:"",plant:c[u].plant,paymentTerms:c[u].paymentTerms,conditionGroup4:c[u].conditionGroup4};l.push(h)}}if(l.length===0){t.information(this.resourceBundle.getText("ReturnItemscannotbeempty"));return}}if(o.getData().userEmailId){var m=o.getData().userEmailId;var y=true}else{var m="";var y=false}if(this.docVersion==="DRAFT"){var P="DRAFT"}else if(this.docVersion==="ERROR"){var P="ERROR"}else{var P="DRAFT"}if(o.getData().requestor===o.getData().userName+" ("+o.getData().phone+")"){var f=""}else{var f=o.getData().requestor}var v={returns:{createdAt:new Date,customerPo:o.getData().customerPONumber,mappingId:o.getData().salesOrgForRO,updatedBy:f,requestorName:o.getData().userId+"("+o.getData().userName+")",requestedBy:o.getData().userId,roType:o.getData().selectedROTypeCode,roTypeText:o.getData().selectedROType,salesOrg:o.getData().selectedSalesOrg,salesOrgDesc:a.salesOrgDesc,distributionChannel:o.getData().selectedDistChnl,distributionChannelDesc:a.distChnlDesc,division:a.Division,divisionDesc:o.getData().selectedDivisionDesc,soldToParty:o.getData().returnSoldTo,soldToPartyDesc:o.getData().returnSoldToDesc,shipToParty:o.getData().returnShipTo,shipToPartyDesc:o.getData().shipToDesc,billToParty:o.getData().returnBillTo,billToDesc:o.getData().returnBillToDesc,payer:o.getData().returnPayer,payerDesc:o.getData().returnPayerDesc,requestorEmail:o.getData().email,contactPerson:o.getData().userEmailId,contactDivsion:o.getData().contactDivision,contactTelephone:o.getData().phoneNum,referenceNum:o.getData().referenceNo,requestRemark:o.getData().returnRemark,oneTimeCustomer:o.getData().oneTimeCustomer,orderReason:o.getData().selectedReturnReason.split(" ")[0],orderReasonText:o.getData().selectedReturnReason.split("(")[1].split(")")[0],reasonOwner:o.getData().reasonOwner.split(" ")[0],reasonOwnerDesc:o.getData().reasonOwner.split(" ")[1].split("(")[1].split(")")[0],orderType:o.getData().returnOrderType,orderTypeText:o.getData().returnOrderType,returnTotalAmt:i.getData().returnAmountTotal.split("(")[0],totalRoAmount:this.getView().getModel("returnModel").getData().returnAmountTotal.split("(")[0],returnReqNum:g,workflowInstance:"",overallWorkflowStatus:"",processingStatus:"",logisticalStatus:"",docVersion:P,flagRoSo:"R",emailTrigger:y,exchangeOrderType:o.getData().exchangeOrderType,items:l}};if(o.getProperty("/oneTimeCustomer")==="X"){if(this.docVersion===undefined){var D=this.selectedReturnItems;var M=D[0].soldToAddress;var b=D[0].shipToAddress;var T=D[0].billToAdress;var S=D[0].payerAddress;var C=[{id:"",returnReqNum:"",zipCode:M.postalCode,refDocNum:D[0].InvoiceNum,email:"",salesDocument:"",partnerRole:"AG",name1:M.partnerName,name2:"",name3:"",name4:M.partnerName4,street2:M.AddressStreet2,street3:M.AddressStreet3,street5:M.AddressStreet5,district:M.District,differentCity:M.DifferentCity,postalCode:M.postalCode,city:M.City,region:M.region,country:M.countryCode,language:M.language,telephone:M.telephone,mobilePhone:M.mobileNumber,taxId:M.taxId,b_Codes:M.bCode,bpNummr:M.bpNummr},{id:"",returnReqNum:"",zipCode:b.postalCode,refDocNum:D[0].InvoiceNum,email:"",salesDocument:"",partnerRole:"WE",name1:b.partnerName,name2:"",name3:"",name4:b.partnerName4,street2:b.AddressStreet2,street3:b.AddressStreet3,street5:b.AddressStreet5,district:b.District,differentCity:b.DifferentCity,postalCode:b.postalCode,city:b.City,region:b.region,country:b.countryCode,language:b.language,telephone:b.telephone,mobilePhone:b.mobileNumber,taxId:b.taxId,b_Codes:b.bCode,bpNummr:b.bpNummr},{id:"",returnReqNum:"",zipCode:T.postalCode,refDocNum:D[0].InvoiceNum,email:"",salesDocument:"",partnerRole:"RE",name1:T.partnerName,name2:"",name3:"",name4:T.partnerName4,street2:T.AddressStreet2,street3:T.AddressStreet3,street5:T.AddressStreet5,district:T.District,differentCity:T.DifferentCity,postalCode:T.postalCode,city:T.City,region:T.region,country:T.countryCode,language:T.language,telephone:T.telephone,mobilePhone:T.mobileNumber,taxId:T.taxId,b_Codes:T.bCode,bpNummr:T.bpNummr},{id:"",returnReqNum:"",zipCode:S.postalCode,refDocNum:D[0].InvoiceNum,email:"",salesDocument:"",partnerRole:"RG",name1:S.partnerName,name2:"",name3:"",name4:S.partnerName4,street2:S.AddressStreet2,street3:S.AddressStreet3,street5:S.AddressStreet5,district:S.District,differentCity:S.DifferentCity,postalCode:S.postalCode,city:S.City,region:S.region,country:S.countryCode,language:S.language,telephone:S.telephone,mobilePhone:S.mobileNumber,taxId:S.taxId,b_Codes:S.bCode,bpNummr:S.bpNummr}];v.returns.address=C}else{v.returns.address=o.getProperty("/setRetAddress")}}if(n.getData().results!==undefined&&n.getData().results.length>0){var w=n.getData().results;if(w!==undefined||w.length===0){for(var x=0;x<w.length;x++){if(w[x].deleted==="false"){var I={refDocNum:w[x].refInvoice,refDocItem:w[x].refItemNumber,exchangeReqItemid:w[x].itemNumber,materialGroup:w[x].materialGroup,materialGroup4:w[x].materialGroup4,material:w[x].matNumber,sapMaterialNum:w[x].matNumber,shortText:w[x].itemShortText,avlReturnQty:w[x].quantity,avlUom:w[x].salesUnit,returnQty:w[x].quantity,returnUom:w[x].salesUnit,unitPriceCc:w[x].unitPrice,unitPriceInv:w[x].unitPriceInv,manualFoc:w[x].manualFoc,invoiceTotalAmount:n.getData().exchangeAmountTotal.split("(")[0],totalNetAmount:this.getView().getModel("exchangeModel").getData().exchangeAmountTotal.split("(")[0],storageLocation:w[x].storageLocation,sloc:w[x].storageLocation,higherLevel:w[x].higherItem,batch:w[x].batchNumber,referenceInvDate:r.dateTimeFormatPS(w[x].billingDate).split("T")[0],expiryDate:r.dateTimeFormatPS(w[x].expiryDate).split("T")[0],serialNum:w[x].serialNumber,returnReqNum:g,exchangeReqNum:p,billingType:a.billingType,sapReturnOrderNum:"",sapReturnOrderItemNum:"",overallItemWorkflowStatus:"",plant:w[x].plant,paymentTerms:w[x].paymentTerms,conditionGroup4:w[x].conditionGroup4};d.push(I)}}if(d.length>0){var R={customerPo:o.getData().customerPONumberEx,roType:o.getData().selectedROTypeCode,payer:o.getData().payer,referenceNum:o.getData().referenceNo,reasonOwner:o.getData().reasonOwner.split(" ")[0],requestRemark:o.getData().exchangeRemark,billToParty:o.getData().billTo,orderCategory:o.getData().exchangeOrderType,orderType:o.getData().exchangeOrderType,orderTypeText:o.getData().exchangeOrderType,salesOrg:o.getData().selectedSalesOrg,distributionChannel:o.getData().selectedDistChnl,division:a.Division,soldToParty:o.getData().exSoldTo,soldToPartyDesc:o.getData().exSoldToDesc,shipToParty:o.getData().exShipTo,shipToPartyDesc:o.getData().exShipToDesc,billToParty:o.getData().exBillTo,billToDesc:o.getData().exBillToDesc,billToPartyDesc:o.getData().exBillToDesc,payer:o.getData().exPayer,payerDesc:o.getData().exPayerDesc,payerDescription:o.getData().exPayerDesc,remarks:o.getData().exchangeRemark,totalNetAmount:n.getData().exchangeAmountTotal.split("(")[0],delComplete:o.getData().completedDeliveryFLAG,docCurrency:"",exoneTimeCustomer:o.getData().EXOneTimeCustomer,deliveryBlock:"",billingBlock:"",overallStatus:"",rejectionStatus:"",deliveryStatus:"",creditStatus:"",overallWorkflowStatus:"",flagRoSo:"E",items:d,returnReqNum:g,exchangeReqNum:p};v.exchange=R;if(o.getProperty("/EXOneTimeCustomer")==="X"||o.getProperty("/oneTimeCustomer")==="X"){if(this.docVersion===undefined){var D=this.selectedReturnItems;var C=[{id:"",returnReqNum:"",zipCode:"",refInvoiceNum:D[0].InvoiceNum,email:"",salesDocument:"",partnerRole:"AG",name1:o.getProperty("/partnerName"),name2:"",name3:"",name4:o.getProperty("/partnerName4"),street2:o.getProperty("/AddressStreet2"),street3:o.getProperty("/AddressStreet3"),street5:o.getProperty("/AddressStreet5"),district:o.getProperty("/District"),differentCity:o.getProperty("/DifferentCity"),postalCode:o.getProperty("/postalCode"),city:o.getProperty("/city"),region:o.getProperty("/invRegion"),country:o.getProperty("/invCountry"),language:o.getProperty("/invLanguage"),telephone:o.getProperty("/telephone"),mobilePhone:o.getProperty("/mobileNumber"),taxId:o.getProperty("/taxId"),b_Codes:o.getProperty("/bCode"),bpNummr:o.getProperty("/bpNummr")},{id:"",returnReqNum:"",zipCode:"",refInvoiceNum:D[0].InvoiceNum,email:"",salesDocument:"",partnerRole:"WE",name1:o.getProperty("/partnerName"),name2:"",name3:"",name4:o.getProperty("/partnerName4"),street2:o.getProperty("/AddressStreet2"),street3:o.getProperty("/AddressStreet3"),street5:o.getProperty("/AddressStreet5"),district:o.getProperty("/District"),differentCity:o.getProperty("/DifferentCity"),postalCode:o.getProperty("/postalCode"),city:o.getProperty("/city"),region:o.getProperty("/invRegion"),country:o.getProperty("/invCountry"),language:o.getProperty("/invLanguage"),telephone:o.getProperty("/telephone"),mobilePhone:o.getProperty("/mobileNumber"),taxId:o.getProperty("/taxId"),b_Codes:o.getProperty("/bCode"),bpNummr:o.getProperty("/bpNummr")},{id:"",returnReqNum:"",zipCode:"",refInvoiceNum:D[0].InvoiceNum,email:"",salesDocument:"",partnerRole:"RE",name1:o.getProperty("/partnerName"),name2:"",name3:"",name4:o.getProperty("/partnerName4"),street2:o.getProperty("/AddressStreet2"),street3:o.getProperty("/AddressStreet3"),street5:o.getProperty("/AddressStreet5"),district:o.getProperty("/District"),differentCity:o.getProperty("/DifferentCity"),postalCode:o.getProperty("/postalCode"),city:o.getProperty("/city"),region:o.getProperty("/invRegion"),country:o.getProperty("/invCountry"),language:o.getProperty("/invLanguage"),telephone:o.getProperty("/telephone"),mobilePhone:o.getProperty("/mobileNumber"),taxId:o.getProperty("/taxId"),b_Codes:o.getProperty("/bCode"),bpNummr:o.getProperty("/bpNummr")},{id:"",returnReqNum:"",zipCode:"",refInvoiceNum:D[0].InvoiceNum,email:"",salesDocument:"",partnerRole:"RG",name1:o.getProperty("/partnerName"),name2:"",name3:"",name4:o.getProperty("/partnerName4"),street2:o.getProperty("/AddressStreet2"),street3:o.getProperty("/AddressStreet3"),street5:o.getProperty("/AddressStreet5"),district:o.getProperty("/District"),differentCity:o.getProperty("/DifferentCity"),postalCode:o.getProperty("/postalCode"),city:o.getProperty("/city"),region:o.getProperty("/invRegion"),country:o.getProperty("/invCountry"),language:o.getProperty("/invLanguage"),telephone:o.getProperty("/telephone"),mobilePhone:o.getProperty("/mobileNumber"),taxId:o.getProperty("/taxId"),b_Codes:o.getProperty("/bCode"),bpNummr:o.getProperty("/bpNummr")}];v.exchange.address=C}else{var C=[{id:"",returnReqNum:"",zipCode:"",refInvoiceNum:o.getProperty("/refDocNum"),email:"",salesDocument:"",partnerRole:"AG",name1:o.getProperty("/partnerName"),name2:"",name3:"",name4:o.getProperty("/partnerName4"),street2:o.getProperty("/AddressStreet2"),street3:o.getProperty("/AddressStreet3"),street5:o.getProperty("/AddressStreet5"),district:o.getProperty("/District"),differentCity:o.getProperty("/DifferentCity"),postalCode:o.getProperty("/postalCode"),city:o.getProperty("/city"),region:o.getProperty("/invRegion"),country:o.getProperty("/invCountry"),language:o.getProperty("/invLanguage"),telephone:o.getProperty("/telephone"),mobilePhone:o.getProperty("/mobileNumber"),taxId:o.getProperty("/taxId"),b_Codes:o.getProperty("/bCode"),bpNummr:o.getProperty("/bpNummr")},{id:"",returnReqNum:"",zipCode:"",refInvoiceNum:o.getProperty("/refDocNum"),email:"",salesDocument:"",partnerRole:"WE",name1:o.getProperty("/partnerName"),name2:"",name3:"",name4:o.getProperty("/partnerName4"),street2:o.getProperty("/AddressStreet2"),street3:o.getProperty("/AddressStreet3"),street5:o.getProperty("/AddressStreet5"),district:o.getProperty("/District"),differentCity:o.getProperty("/DifferentCity"),postalCode:o.getProperty("/postalCode"),city:o.getProperty("/city"),region:o.getProperty("/invRegion"),country:o.getProperty("/invCountry"),language:o.getProperty("/invLanguage"),telephone:o.getProperty("/telephone"),mobilePhone:o.getProperty("/mobileNumber"),taxId:o.getProperty("/taxId"),b_Codes:o.getProperty("/bCode"),bpNummr:o.getProperty("/bpNummr")},{id:"",returnReqNum:"",zipCode:"",refInvoiceNum:o.getProperty("/refDocNum"),email:"",salesDocument:"",partnerRole:"RE",name1:o.getProperty("/partnerName"),name2:"",name3:"",name4:o.getProperty("/partnerName4"),street2:o.getProperty("/AddressStreet2"),street3:o.getProperty("/AddressStreet3"),street5:o.getProperty("/AddressStreet5"),district:o.getProperty("/District"),differentCity:o.getProperty("/DifferentCity"),postalCode:o.getProperty("/postalCode"),city:o.getProperty("/city"),region:o.getProperty("/invRegion"),country:o.getProperty("/invCountry"),language:o.getProperty("/invLanguage"),telephone:o.getProperty("/telephone"),mobilePhone:o.getProperty("/mobileNumber"),taxId:o.getProperty("/taxId"),b_Codes:o.getProperty("/bCode"),bpNummr:o.getProperty("/bpNummr")},{id:"",returnReqNum:"",zipCode:"",refInvoiceNum:o.getProperty("/refDocNum"),email:"",salesDocument:"",partnerRole:"RG",name1:o.getProperty("/partnerName"),name2:"",name3:"",name4:o.getProperty("/partnerName4"),street2:o.getProperty("/AddressStreet2"),street3:o.getProperty("/AddressStreet3"),street5:o.getProperty("/AddressStreet5"),district:o.getProperty("/District"),differentCity:o.getProperty("/DifferentCity"),postalCode:o.getProperty("/postalCode"),city:o.getProperty("/city"),region:o.getProperty("/invRegion"),country:o.getProperty("/invCountry"),language:o.getProperty("/invLanguage"),telephone:o.getProperty("/telephone"),mobilePhone:o.getProperty("/mobileNumber"),taxId:o.getProperty("/taxId"),b_Codes:o.getProperty("/bCode"),bpNummr:o.getProperty("/bpNummr")}];v.exchange.address=C}}}else{if(this.getView().getModel("baseModel").getProperty("/exchangeTabVisiblity")===true){sap.m.MessageBox.information(this.resourceBundle.getText("discardExchangeItems"),{actions:[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],onClose:function(e){if(e===t.Action.OK){s.getView().getModel("baseModel").setProperty("/exchangeTabVisiblity",false);s._continueSave()}else{return}}});return}}}}else{if(this.getView().getModel("baseModel").getProperty("/exchangeTabVisiblity")===true){sap.m.MessageBox.information(this.resourceBundle.getText("discardExchangeItems"),{actions:[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],onClose:function(e){if(e===t.Action.OK){s.getView().getModel("baseModel").setProperty("/exchangeTabVisiblity",false);s._continueSave()}else{return}}});return}}if(this.getView().getModel("returnModel").getData().attachmentObject.length>0){var V=[];var N=this.getView().getModel("returnModel").getData().attachmentObject;for(var O=0;O<N.length;O++){var A={docName:N[O].fileName,docType:N[O].fileType,docData:N[O].fileDoc,docId:N[O].docId,returnReqNum:g};V.push(A)}v.returns.attachment=V}var F={"Content-Type":"application/json;charset=utf-8"};var B=new sap.m.BusyDialog;B.open();var E=new sap.ui.model.json.JSONModel;E.loadData("/DKSHJavaService/returnRequest/createReturnRequest/saveAsDraft",JSON.stringify(v),true,"POST",false,false,F);E.attachRequestCompleted(function(e){B.close();if(s.address){s.address.close()}if(sap.ui.getCore().getModel("submitRequest")){sap.ui.getCore().getModel("submitRequest").setData("")}var t=e.getSource().getData().name.split(" ")[1];s.oDefaultDialog=new sap.m.Dialog({type:sap.m.DialogType.Message,title:"Success",styleClass:"sapUiSizeCompact",content:[new sap.m.Text({text:" "+e.getSource().getData().name+"."}),new sap.m.Text({text:" "+s.resourceBundle.getText("Fordetailsclick")}),new sap.m.Link({text:t,target:"_top",press:function(e){s._wizard.discardProgress(s._wizard.getSteps()[0]);s._discardChanges();var r={orderNO:t};var o=new sap.ui.model.json.JSONModel(r);sap.ui.getCore().setModel(o,"saveDraft");var a=sap.ui.core.UIComponent.getRouterFor(s);a.navTo("DraftRecord")}})],beginButton:new sap.m.Button({text:s.resourceBundle.getText("OK"),press:function(){s._wizard.discardProgress(s._wizard.getSteps()[0]);s._discardChanges();var e=sap.ui.core.UIComponent.getRouterFor(s);e.navTo("DraftRecord")}.bind(s)}),endButton:new sap.m.Button({text:"Close",press:function(){s._wizard.discardProgress(s._wizard.getSteps()[0]);s._discardChanges();var e=sap.ui.core.UIComponent.getRouterFor(s);e.navTo("DraftRecord")}.bind(s)})});s.getView().addDependent(s.oDefaultDialog);s.oDefaultDialog.open()});E.attachRequestFailed(function(e){B.close();t.error(e.getParameters().responseText)})},onPressSubmit:function(e){if(this.RetQtyCount>0){t.error(this.resourceBundle.getText("EnteredReturnedQtycannotbegreaterthanAvailableReturnQty"));return}if(this.getView().getModel("baseModel").getProperty("/reasonOwner")===""||this.getView().getModel("baseModel").getProperty("/reasonOwner")===undefined){s.show(this.resourceBundle.getText("ReasonOwnerisMandatory"));return}if(this.getView().getModel("baseModel").getProperty("/referenceNo")===""||this.getView().getModel("baseModel").getProperty("/referenceNo")===undefined){s.show(this.resourceBundle.getText("referenceNoisMandatory"));return}if(this.ROtypeCode==="TF"||this.ROtypeCode==="TG"){var r=this.getView().getModel("baseModel").getProperty("/referenceNo"),o=this.getView().getModel("baseModel").getProperty("/remark"),a=this.getView().getModel("baseModel").getProperty("/returnRemark");if(this.exchangeItems.length>0){var i=this.getView().getModel("baseModel").getProperty("/exchangeRemark");i=[i,r].join(" ");if(a){o=["มียาเปลี่ยน",o].join(" ");a=["มียาเปลี่ยน",a].join(" ")}this.getView().getModel("baseModel").setProperty("/exchangeRemark",i)}if(this.getView().getModel("baseModel").getProperty("/referenceNo")){o=[o,r].join(" ");a=[a,r].join(" ")}this.getView().getModel("baseModel").setProperty("/remark",o);this.getView().getModel("baseModel").setProperty("/returnRemark",a)}var n=this;var l=this.getView().getModel("invoiceSearchModel");var d=this.getView().getModel("returnModel");var g=this.getView().getModel("exchangeModel");var p=this.getView().getModel("baseModel");this.getView().getModel("baseModel").setProperty("/savePressed",false);this.getView().getModel("baseModel").setProperty("/submitPressed",true);if(g.getData().results!==undefined&&g.getData().results.length>0){if(parseFloat(d.getData().returnAmountTotal)!==parseFloat(g.getData().exchangeAmountTotal)){sap.m.MessageBox.information(this.resourceBundle.getText("retrunAmountValidation"),{actions:[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],onClose:function(e){if(e===t.Action.OK){n._checkAddress()}}})}else{n._checkAddress()}}else if(d.getData().results===undefined||d.getData().results.length===0){t.information(this.resourceBundle.getText("ReturnItemscannotbeempty"))}else{n._checkAddress()}},_checkAddress:function(){var e=this;var t=this.getView().getModel("invoiceSearchModel");var r=this.getView().getModel("returnModel");var s=this.getView().getModel("exchangeModel");var o=this.getView().getModel("baseModel");if(o.getProperty("/oneTimeCustomer")==="X"&&o.getProperty("/returnSoldTo")!==o.getProperty("/exSoldTo")&&o.getProperty("/EXOneTimeCustomer")==="X"){if(!this.address){this.address=sap.ui.xmlfragment("dksh.connectclient.CreateReturn.Fragments.Address",this);this.getView().addDependent(this.address)}this._loadCity();if(this.getView().getModel("editDraftModel")){if(this.changeSoldToParty===true){o.setProperty("/partnerName","");o.setProperty("/AddressStreet2","");o.setProperty("/AddressStreet3","");o.setProperty("/AddressStreet5","");o.setProperty("/District","");o.setProperty("/DifferentCity","");o.setProperty("/postalCode","");o.setProperty("/city","");o.setProperty("/telephone","");o.setProperty("/mobileNumber","");o.setProperty("/taxId","");o.setProperty("/bCode","00000");o.setProperty("/bpNummr","N");o.setProperty("/partnerName4","");o.setProperty("/maxLengthName4","40 char remaining");o.setProperty("/maxLengthAddressStreet2","40 char remaining");o.setProperty("/maxLengthAddressStreet3","40 char remaining");o.setProperty("/maxLengthAddressStreet5","40 char remaining");o.setProperty("/maxLengthDistrict","40 char remaining");o.setProperty("/maxLengthDifferentCity","40 char remaining");o.setProperty("/maxLengthPostalCode","5 char remaining");o.setProperty("/maxLengthtelephone","30 char remaining");o.setProperty("/maxLengthmobileNumber","30 char remaining");o.setProperty("/maxLengthtaxId","13 char remaining");o.setProperty("/maxLengthbCode","0 char remaining");o.setProperty("/maxLengthbpNummr","0 char remaining");this.address.open();return}else{o.setProperty("/maxLengthName4",40-o.getProperty("/partnerName4").length+" char remaining");o.setProperty("/maxLengthAddressStreet2",40-o.getProperty("/AddressStreet2").length+" char remaining");o.setProperty("/maxLengthAddressStreet3",40-o.getProperty("/AddressStreet3").length+" char remaining");o.setProperty("/maxLengthAddressStreet5",40-o.getProperty("/AddressStreet5").length+" char remaining");o.setProperty("/maxLengthDistrict",40-o.getProperty("/District").length+" char remaining");o.setProperty("/maxLengthDifferentCity",40-o.getProperty("/DifferentCity").length+" char remaining");o.setProperty("/maxLengthPostalCode",5-o.getProperty("/postalCode").length+" char remaining");o.setProperty("/maxLengthtelephone",30-o.getProperty("/telephone").length+" char remaining");o.setProperty("/maxLengthmobileNumber",30-o.getProperty("/mobileNumber").length+" char remaining");o.setProperty("/maxLengthtaxId",13-o.getProperty("/taxId").length+" char remaining");o.setProperty("/maxLengthbCode",5-o.getProperty("/bCode").length+" char remaining");o.setProperty("/maxLengthbpNummr",1-o.getProperty("/bpNummr").length+" char remaining");this.address.open();return}}else{if(this.selectedReturnItems[0].soldToAddress.language==="TH"||this.selectedReturnItems[0].soldToAddress.language==="2"){this.selectedReturnItems[0].soldToAddress.language="2"}else{this.selectedReturnItems[0].soldToAddress.language="E"}if(this.selectedReturnItems[0].shipToAddress.language==="TH"||this.selectedReturnItems[0].shipToAddress.language==="2"){this.selectedReturnItems[0].shipToAddress.language="2"}else{this.selectedReturnItems[0].shipToAddress.language="E"}if(this.selectedReturnItems[0].billToAdress.language==="TH"||this.selectedReturnItems[0].billToAdress.language==="2"){this.selectedReturnItems[0].billToAdress.language="2"}else{this.selectedReturnItems[0].billToAdress.language="E"}if(this.selectedReturnItems[0].payerAddress.language==="TH"||this.selectedReturnItems[0].payerAddress.language==="2"){this.selectedReturnItems[0].payerAddress.language="2"}else{this.selectedReturnItems[0].payerAddress.language="E"}r.setProperty("/invRetCountry",this.selectedReturnItems[0].soldToAddress.countryCode);r.setProperty("/invRetRegion",this.selectedReturnItems[0].soldToAddress.region);r.setProperty("/invRetLanguage",this.selectedReturnItems[0].soldToAddress.language);o.setProperty("/partnerName","");o.setProperty("/AddressStreet2","");o.setProperty("/AddressStreet3","");o.setProperty("/AddressStreet5","");o.setProperty("/District","");o.setProperty("/DifferentCity","");o.setProperty("/postalCode","");o.setProperty("/city","");o.setProperty("/telephone","");o.setProperty("/mobileNumber","");o.setProperty("/taxId","");o.setProperty("/bCode","00000");o.setProperty("/bpNummr","N");o.setProperty("/partnerName4","");o.setProperty("/maxLengthName4","40 char remaining");o.setProperty("/maxLengthAddressStreet2","40 char remaining");o.setProperty("/maxLengthAddressStreet3","40 char remaining");o.setProperty("/maxLengthAddressStreet5","40 char remaining");o.setProperty("/maxLengthDistrict","40 char remaining");o.setProperty("/maxLengthDifferentCity","40 char remaining");o.setProperty("/maxLengthPostalCode","5 char remaining");o.setProperty("/maxLengthtelephone","30 char remaining");o.setProperty("/maxLengthmobileNumber","30 char remaining");o.setProperty("/maxLengthtaxId","13 char remaining");o.setProperty("/maxLengthbCode","0 char remaining");o.setProperty("/maxLengthbpNummr","0 char remaining");this.address.open();return}}else if(o.getProperty("/oneTimeCustomer")==="X"&&s.getData().results!==undefined&&s.getData().results.length>0&&o.getProperty("/returnSoldTo")===o.getProperty("/exSoldTo")){if(!this.address){this.address=sap.ui.xmlfragment("dksh.connectclient.CreateReturn.Address",this);this.getView().addDependent(this.address)}this._loadCity();if(this.docVersion===undefined){if(this.selectedReturnItems[0].soldToAddress.language==="TH"||this.selectedReturnItems[0].soldToAddress.language==="2"){this.selectedReturnItems[0].soldToAddress.language="2"}else{this.selectedReturnItems[0].soldToAddress.language="E"}if(this.selectedReturnItems[0].shipToAddress.language==="TH"||this.selectedReturnItems[0].shipToAddress.language==="2"){this.selectedReturnItems[0].shipToAddress.language="2"}else{this.selectedReturnItems[0].shipToAddress.language="E"}if(this.selectedReturnItems[0].billToAdress.language==="TH"||this.selectedReturnItems[0].billToAdress.language==="2"){this.selectedReturnItems[0].billToAdress.language="2"}else{this.selectedReturnItems[0].billToAdress.language="E"}if(this.selectedReturnItems[0].payerAddress.language==="TH"||this.selectedReturnItems[0].payerAddress.language==="2"){this.selectedReturnItems[0].payerAddress.language="2"}else{this.selectedReturnItems[0].payerAddress.language="E"}var a=this.selectedReturnItems[0];o.setProperty("/invCountry",this.selectedReturnItems[0].soldToAddress.countryCode);o.setProperty("/invRegion",this.selectedReturnItems[0].soldToAddress.region);o.setProperty("/invLanguage",this.selectedReturnItems[0].soldToAddress.language);o.setProperty("/partnerName",a.soldToAddress.partnerName);o.setProperty("/partnerName4",a.soldToAddress.partnerName4);o.setProperty("/AddressStreet2",a.soldToAddress.AddressStreet2);o.setProperty("/AddressStreet3",a.soldToAddress.AddressStreet3);o.setProperty("/AddressStreet5",a.soldToAddress.AddressStreet5);o.setProperty("/District",a.soldToAddress.District);o.setProperty("/DifferentCity",a.soldToAddress.DifferentCity);o.setProperty("/postalCode",a.soldToAddress.postalCode);o.setProperty("/city",a.soldToAddress.City);o.setProperty("/telephone",a.soldToAddress.telephone);o.setProperty("/mobileNumber",a.soldToAddress.mobileNumber);o.setProperty("/taxId",a.soldToAddress.taxId);o.setProperty("/bCode",a.soldToAddress.bCode);if(a.soldToAddress.bpNummr==="N"||a.soldToAddress.bpNummr==="H"){o.setProperty("/bCode","00000")}o.setProperty("/bpNummr",a.soldToAddress.bpNummr);o.setProperty("/maxLengthName4",40-a.soldToAddress.partnerName4.length+" char remaining");o.setProperty("/maxLengthAddressStreet2",40-a.soldToAddress.AddressStreet2.length+" char remaining");o.setProperty("/maxLengthAddressStreet3",40-a.soldToAddress.AddressStreet3.length+" char remaining");o.setProperty("/maxLengthAddressStreet5",40-a.soldToAddress.AddressStreet5.length+" char remaining");o.setProperty("/maxLengthDistrict",40-a.soldToAddress.District.length+" char remaining");o.setProperty("/maxLengthDifferentCity",40-a.soldToAddress.DifferentCity.length+" char remaining");o.setProperty("/maxLengthPostalCode",5-a.soldToAddress.postalCode.length+" char remaining");o.setProperty("/maxLengthtelephone",30-a.soldToAddress.telephone.length+" char remaining");o.setProperty("/maxLengthmobileNumber",30-a.soldToAddress.mobileNumber.length+" char remaining");o.setProperty("/maxLengthtaxId",13-a.soldToAddress.taxId.length+" char remaining");o.setProperty("/maxLengthbCode",5-o.getProperty("/bCode").length+" char remaining");o.setProperty("/maxLengthbpNummr",1-a.soldToAddress.bpNummr.length+" char remaining");this.address.setModel(o,"/baseModel");this.address.open()}else{o.setProperty("/maxLengthName4",40-o.getProperty("/partnerName4").length+" char remaining");o.setProperty("/maxLengthAddressStreet2",40-o.getProperty("/AddressStreet2").length+" char remaining");o.setProperty("/maxLengthAddressStreet3",40-o.getProperty("/AddressStreet3").length+" char remaining");o.setProperty("/maxLengthAddressStreet5",40-o.getProperty("/AddressStreet5").length+" char remaining");o.setProperty("/maxLengthDistrict",40-o.getProperty("/District").length+" char remaining");o.setProperty("/maxLengthDifferentCity",40-o.getProperty("/DifferentCity").length+" char remaining");o.setProperty("/maxLengthPostalCode",5-o.getProperty("/postalCode").length+" char remaining");o.setProperty("/maxLengthtelephone",30-o.getProperty("/telephone").length+" char remaining");o.setProperty("/maxLengthmobileNumber",30-o.getProperty("/mobileNumber").length+" char remaining");o.setProperty("/maxLengthtaxId",13-o.getProperty("/taxId").length+" char remaining");o.setProperty("/maxLengthbCode",5-o.getProperty("/bCode").length+" char remaining");o.setProperty("/maxLengthbpNummr",1-o.getProperty("/bpNummr").length+" char remaining");this.address.setModel(o,"/baseModel");this.address.open()}return}else if(o.getProperty("/EXOneTimeCustomer")==="X"&&o.getProperty("/oneTimeCustomer")===""){if(!this.address){this.address=sap.ui.xmlfragment("dksh.connectclient.CreateReturn.Fragments.Address",this);this.getView().addDependent(this.address)}this._loadCity();o.setProperty("/invCountry",this.selectedReturnItems[0].soldToAddress.countryCode);o.setProperty("/invRegion",this.selectedReturnItems[0].soldToAddress.region);o.setProperty("/invLanguage",this.selectedReturnItems[0].soldToAddress.language);o.setProperty("/partnerName","");o.setProperty("/AddressStreet2","");o.setProperty("/AddressStreet3","");o.setProperty("/AddressStreet5","");o.setProperty("/District","");o.setProperty("/DifferentCity","");o.setProperty("/postalCode","");o.setProperty("/city","");o.setProperty("/telephone","");o.setProperty("/mobileNumber","");o.setProperty("/taxId","");o.setProperty("/bCode","00000");o.setProperty("/bpNummr","N");o.setProperty("/partnerName4","");o.setProperty("/maxLengthName4","40 char remaining");o.setProperty("/maxLengthAddressStreet2","40 char remaining");o.setProperty("/maxLengthAddressStreet3","40 char remaining");o.setProperty("/maxLengthAddressStreet5","40 char remaining");o.setProperty("/maxLengthDistrict","40 char remaining");o.setProperty("/maxLengthDifferentCity","40 char remaining");o.setProperty("/maxLengthPostalCode","5 char remaining");o.setProperty("/maxLengthtelephone","30 char remaining");o.setProperty("/maxLengthmobileNumber","30 char remaining");o.setProperty("/maxLengthtaxId","13 char remaining");o.setProperty("/maxLengthbCode","0 char remaining");o.setProperty("/maxLengthbpNummr","0 char remaining");this.address.open();return}else if(o.getProperty("/EXOneTimeCustomer")===""&&o.getProperty("/returnSoldTo")!==o.getProperty("/exSoldTo")){this._continueSubmit();return}this._continueSubmit()},onViewExAddress:function(){if(!this.address){this.address=sap.ui.xmlfragment("dksh.connectclient.CreateReturn.Fragments.Address",this);this.getView().addDependent(this.address)}this.getView().getModel("baseModel").setProperty("/addressFieldEnable",false);this.getView().getModel("baseModel").refresh();this.address.open()},_continueSubmit:function(){var e=this;var s=this.getView().getModel("invoiceSearchModel");var o=this.getView().getModel("returnModel");var a=this.getView().getModel("exchangeModel");var i=this.getView().getModel("baseModel");if(this.docVersion==="DRAFT"){var n="DRAFT"}else if(this.docVersion==="ERROR"){var n="ERROR"}else{var n="NEW"}var l={docName:"retunr03",docType:"pdf",docData:[0,1]};if(i.getData().returnReqNum){var d=i.getData().returnReqNum}else{var d=""}if(i.getData().exchangeReqNum){var g=i.getData().exchangeReqNum}else{var g=""}var p=o.getData().results;var c=[];for(var u=0;u<p.length;u++){if(p[u].deleted==="false"){var h={refDocNum:p[u].refInvoice,refDocItem:p[u].refItemNumber,returnReqItemid:p[u].itemNumber,materialGroup:p[u].materialGroup,materialGroup4:p[u].materialGroup4,material:p[u].matNumber,shortText:p[u].itemShortText,avlReturnQty:p[u].avlRetQty,avlUom:p[u].salesUnit,returnQty:p[u].quantity,returnUom:p[u].salesUnit,unitPriceCc:p[u].unitPrice,unitPriceInv:p[u].unitPriceInv,invoiceTotalAmount:o.getData().returnAmountTotal.split("(")[0],storageLocation:p[u].storageLocation,higherLevel:p[u].higherItem,batch:p[u].batchNumber,referenceInvDate:r.dateTimeFormatPS(p[u].billingDate).split("T")[0],expiryDate:r.dateTimeFormatPS(p[u].expiryDate).split("T")[0],pricingDate:r.dateTimeFormatPS(p[u].pricingDate),serviceRenderedDate:r.dateTimeFormatPS(p[u].serviceRenderedDate),serialNum:p[u].serialNumber,billingType:s.getData().billingType,sapReturnOrderNum:"",sapReturnOrderItemNum:"",overallItemWorkflowStatus:"",plant:p[u].plant,returnReqNum:d,exchangeOrderType:i.getData().exchangeOrderType,paymentTerms:p[u].paymentTerms,conditionGroup4:p[u].conditionGroup4};c.push(h)}}if(c.length===0){t.information(this.resourceBundle.getText("ReturnItemscannotbeempty"));return}if(i.getData().userEmailId){var m=i.getData().userEmailId;var y=true}else{var m="";var y=false}if(i.getData().phoneNum){var P=i.getData().phoneNum;var f=true;var v=[];v.push(P)}else{var P="";var f=false;var v=[]}if(S&&S.length>0){var D=S}else{var D=""}if(i.getData().requestor===i.getData().userName+" ("+i.getData().phone+")"){var M=""}else{var M=i.getData().requestor}var b={returns:{customerPo:i.getData().customerPONumber,contactelephone:P,smsNumberList:v,smsTrigger:f,smsFrom:"DKSH-TH",createdAt:new Date,mappingId:i.getData().salesOrgForRO,updatedBy:M,requestorName:i.getData().userId+"("+i.getData().userName+")",requestedBy:i.getData().userId,roType:i.getData().selectedROTypeCode,roTypeText:i.getData().selectedROType,salesOrg:i.getData().selectedSalesOrg,salesOrgDesc:s.getData().salesOrgDesc,distributionChannel:i.getData().selectedDistChnl,distributionChannelDesc:s.getData().distChnlDesc,division:s.getData().Division,divisionDesc:i.getData().selectedDivisionDesc,soldToParty:i.getData().returnSoldTo,soldToPartyDesc:i.getData().returnSoldToDesc,shipToParty:i.getData().returnShipTo,shipToPartyDesc:i.getData().shipToDesc,billToParty:i.getData().returnBillTo,billToDesc:i.getData().returnBillToDesc,payer:i.getData().returnPayer,payerDesc:i.getData().returnPayerDesc,requestorEmail:m,contactPerson:i.getData().contactPerson,contactDivsion:i.getData().contactDivision,contactTelephone:i.getData().phoneNum,referenceNum:i.getData().referenceNo,requestRemark:i.getData().returnRemark,orderReason:i.getData().selectedReturnReason.split(" ")[0],orderReasonText:i.getData().selectedReturnReason.split("(")[1].split(")")[0],reasonOwner:i.getData().reasonOwner.split(" ")[0],reasonOwnerDesc:i.getData().reasonOwner.split(" ")[1],orderType:i.getData().returnOrderType,orderTypeText:i.getData().returnOrderType,returnTotalAmt:o.getData().returnAmountTotal.split("(")[0],totalRoAmount:this.getView().getModel("returnModel").getData().returnAmountTotal.split("(")[0],returnReqNum:d,workflowInstance:"",overallWorkflowStatus:"",processingStatus:"",logisticalStatus:"",oneTimeCustomer:i.getData().oneTimeCustomer,docVersion:n,flagRoSo:"R",emailTrigger:y,exchangeOrderType:i.getData().exchangeOrderType,items:c}};if(o.getData().returnConditions){var T=o.getData().returnConditions;var S=[];for(var C=0;C<T.length;C++){if(T[C].deleted===undefined||T[C].deleted==="false"){var w={refDoc:T[C].refInvoice,salesDocument:"",itemNumber:T[C].itemNumber,stepNumber:T[C].stepNumber,condCounter:T[C].condCounter,condType:T[C].condType,condRate:T[C].condRate,currency:T[C].currency,condUnit:T[C].condUnit,condPricingUnit:T[C].condPricingUnit,calculationType:T[C].calculationType,condFlag:T[C].condFlag,condUpdateFlag:T[C].condUpdateFlag};S.push(w)}}b.returns.orderCondition=S}if(i.getProperty("/oneTimeCustomer")==="X"){if(this.docVersion===undefined){var x=this.selectedReturnItems;var I=x[0].soldToAddress;var R=x[0].shipToAddress;var V=x[0].billToAdress;var N=x[0].payerAddress;var O=[{id:"",returnReqNum:"",zipCode:I.postalCode,refDocNum:x[0].InvoiceNum,email:"",salesDocument:"",partnerRole:"AG",name1:I.partnerName,name2:"",name3:"",name4:I.partnerName4,street2:I.AddressStreet2,street3:I.AddressStreet3,street5:I.AddressStreet5,district:I.District,differentCity:I.DifferentCity,postalCode:I.postalCode,city:I.City,region:I.region,country:I.countryCode,language:I.language==="TH"?"2":I.language,telephone:I.telephone,mobilePhone:I.mobileNumber,taxId:I.taxId,b_Codes:I.bCode,bpNummr:I.bpNummr},{id:"",returnReqNum:"",zipCode:R.postalCode,refDocNum:x[0].InvoiceNum,email:"",salesDocument:"",partnerRole:"WE",name1:R.partnerName,name2:"",name3:"",name4:R.partnerName4,street2:R.AddressStreet2,street3:R.AddressStreet3,street5:R.AddressStreet5,district:R.District,differentCity:R.DifferentCity,postalCode:R.postalCode,city:R.City,region:R.region,country:R.countryCode,language:R.language==="TH"?"2":R.language,telephone:R.telephone,mobilePhone:R.mobileNumber,taxId:R.taxId,b_Codess:R.bCode,bpNummr:R.bpNummr},{id:"",returnReqNum:"",zipCode:V.postalCode,refDocNum:x[0].InvoiceNum,email:"",salesDocument:"",partnerRole:"RE",name1:V.partnerName,name2:"",name3:"",name4:V.partnerName4,street2:V.AddressStreet2,street3:V.AddressStreet3,street5:V.AddressStreet5,district:V.District,differentCity:V.DifferentCity,postalCode:V.postalCode,city:V.City,region:V.region,country:V.countryCode,language:V.language==="TH"?"2":V.language,telephone:V.telephone,mobilePhone:V.mobileNumber,taxId:V.taxId,b_Codess:V.bCode,bpNummr:V.bpNummr},{id:"",returnReqNum:"",zipCode:N.postalCode,refDocNum:x[0].InvoiceNum,email:"",salesDocument:"",partnerRole:"RG",name1:N.partnerName,name2:"",name3:"",name4:N.partnerName4,street2:N.AddressStreet2,street3:N.AddressStreet3,street5:N.AddressStreet5,district:N.District,differentCity:N.DifferentCity,postalCode:N.postalCode,city:N.City,region:N.region,country:N.countryCode,language:N.language==="TH"?"2":N.language,telephone:N.telephone,mobilePhone:N.mobileNumber,taxId:N.taxId,b_Codes:N.bCode,bpNummr:N.bpNummr}];b.returns.address=O}else{b.returns.address=i.getProperty("/setRetAddress")}}if(a.getData().results!==undefined&&a.getData().results.length>0){var A=a.getData().results;var F=[];for(var B=0;B<A.length;B++){if(A[B].deleted==="false"){var E={refDocNum:A[B].refInvoice,refDocItem:A[B].refItemNumber,exchangeReqItemid:A[B].itemNumber,materialGroup:A[B].materialGroup,materialGroup4:A[B].materialGroup4,material:A[B].matNumber,shortText:A[B].itemShortText,manualFoc:A[B].manualFoc,returnQty:A[B].quantity,returnUom:A[B].salesUnit,unitPriceCc:A[B].unitPrice,unitPriceInv:A[B].unitPriceInv,invoiceTotalAmount:a.getData().exchangeAmountTotal.split("(")[0],totalNetAmount:this.getView().getModel("exchangeModel").getData().exchangeAmountTotal.split("(")[0],storageLocation:A[B].storageLocation,higherLevel:A[B].higherItem,batch:A[B].batchNumber,referenceInvDate:r.dateTimeFormatPS(A[B].billingDate).split("T")[0],expiryDate:r.dateTimeFormatPS(A[B].expiryDate).split("T")[0],serialNum:A[B].serialNumber,returnReqNum:"",billingType:s.getData().billingType,sapReturnOrderNum:"",sapReturnOrderItemNum:"",overallItemWorkflowStatus:"",plant:A[B].plant,exchangeReqNum:g,paymentTerms:A[B].paymentTerms,conditionGroup4:A[B].conditionGroup4,pricingDate:r.dateTimeFormatPS(A[B].pricingDate),serviceRenderedDate:r.dateTimeFormatPS(A[B].serviceRenderedDate)};F.push(E)}}if(F.length>0){if(U&&U.length>0){var _=U}else{var _=""}var L={customerPo:i.getData().customerPONumberEx,roType:i.getData().selectedROTypeCode,payer:i.getData().exPayer,referenceNum:i.getData().referenceNo,reasonOwner:i.getData().reasonOwner.split(" ")[0],requestRemark:i.getData().exchangeRemark,billToParty:i.getData().exBillTo,billToDesc:i.getData().exBillToDesc,billToPartyDesc:i.getData().exBillToDesc,payerDescription:i.getData().exPayerDesc,payerDesc:i.getData().exPayerDesc,orderCategory:i.getData().exchangeOrderType,orderType:i.getData().exchangeOrderType,orderTypeText:i.getData().exchangeOrderType,salesOrg:i.getData().selectedSalesOrg,distributionChannel:i.getData().selectedDistChnl,division:s.getData().Division,soldToParty:i.getData().exSoldTo,soldToPartyDesc:i.getData().exSoldToDesc,shipToParty:i.getData().exShipTo,shipToPartyDesc:i.getData().exShipToDesc,remarks:i.getData().exchangeRemark,totalNetAmount:a.getData().exchangeAmountTotal.split("(")[0],delComplete:i.getData().completedDeliveryFLAG,docCurrency:"",deliveryBlock:"",billingBlock:"",overallStatus:"",rejectionStatus:"",deliveryStatus:"",creditStatus:"",overallWorkflowStatus:"",items:F,flagRoSo:"E",requestorName:i.getData().userId+"("+i.getData().userName+")",exoneTimeCustomer:i.getData().EXOneTimeCustomer,exchangeReqNum:g};b.exchange=L;if(a.getData().exchangeConditions){var z=a.getData().exchangeConditions;var U=[];for(var j=0;j<z.length;j++){var q={refDoc:z[j].refInvoice,salesDocument:"",itemNumber:z[j].itemNumber,stepNumber:z[j].stepNumber,condCounter:z[j].condCounter,condType:z[j].condType,condRate:z[j].condRate,currency:z[j].currency,condUnit:z[j].condUnit,condPricingUnit:z[j].condPricingUnit,calculationType:z[j].calculationType,condFlag:z[j].condFlag,condUpdateFlag:z[j].condUpdateFlag};U.push(q)}b.exchange.orderCondition=U;if(i.getProperty("/EXOneTimeCustomer")==="X"||i.getProperty("/oneTimeCustomer")==="X"){if(this.docVersion===undefined){var x=this.selectedReturnItems;var O=[{id:"",returnReqNum:"",zipCode:"",refDocNum:x[0].InvoiceNum,email:"",salesDocument:"",partnerRole:"AG",name1:i.getProperty("/partnerName"),name2:"",name3:"",name4:i.getProperty("/partnerName4"),street2:i.getProperty("/AddressStreet2"),street3:i.getProperty("/AddressStreet3"),street5:i.getProperty("/AddressStreet5"),district:i.getProperty("/District"),differentCity:i.getProperty("/DifferentCity"),postalCode:i.getProperty("/postalCode"),city:i.getProperty("/city"),region:i.getProperty("/invRegion"),country:i.getProperty("/invCountry"),language:i.getProperty("/invLanguage"),telephone:i.getProperty("/telephone"),mobilePhone:i.getProperty("/mobileNumber"),taxId:i.getProperty("/taxId"),b_Codes:i.getProperty("/bCode"),bpNummr:i.getProperty("/bpNummr")},{id:"",returnReqNum:"",zipCode:"",refDocNum:x[0].InvoiceNum,email:"",salesDocument:"",partnerRole:"WE",name1:i.getProperty("/partnerName"),name2:"",name3:"",name4:i.getProperty("/partnerName4"),street2:i.getProperty("/AddressStreet2"),street3:i.getProperty("/AddressStreet3"),street5:i.getProperty("/AddressStreet5"),district:i.getProperty("/District"),differentCity:i.getProperty("/DifferentCity"),postalCode:i.getProperty("/postalCode"),city:i.getProperty("/city"),region:i.getProperty("/invRegion"),country:i.getProperty("/invCountry"),language:i.getProperty("/invLanguage"),telephone:i.getProperty("/telephone"),mobilePhone:i.getProperty("/mobileNumber"),taxId:i.getProperty("/taxId"),b_Codes:i.getProperty("/bCode"),bpNummr:i.getProperty("/bpNummr")},{id:"",returnReqNum:"",zipCode:"",refDocNum:x[0].InvoiceNum,email:"",salesDocument:"",partnerRole:"RE",name1:i.getProperty("/partnerName"),name2:"",name3:"",name4:i.getProperty("/partnerName4"),street2:i.getProperty("/AddressStreet2"),street3:i.getProperty("/AddressStreet3"),street5:i.getProperty("/AddressStreet5"),district:i.getProperty("/District"),differentCity:i.getProperty("/DifferentCity"),postalCode:i.getProperty("/postalCode"),city:i.getProperty("/city"),region:i.getProperty("/invRegion"),country:i.getProperty("/invCountry"),language:i.getProperty("/invLanguage"),telephone:i.getProperty("/telephone"),mobilePhone:i.getProperty("/mobileNumber"),taxId:i.getProperty("/taxId"),b_Codes:i.getProperty("/bCode"),bpNummr:i.getProperty("/bpNummr")},{id:"",returnReqNum:"",zipCode:"",refDocNum:x[0].InvoiceNum,email:"",salesDocument:"",partnerRole:"RG",name1:i.getProperty("/partnerName"),name2:"",name3:"",name4:i.getProperty("/partnerName4"),street2:i.getProperty("/AddressStreet2"),street3:i.getProperty("/AddressStreet3"),street5:i.getProperty("/AddressStreet5"),district:i.getProperty("/District"),differentCity:i.getProperty("/DifferentCity"),postalCode:i.getProperty("/postalCode"),city:i.getProperty("/city"),region:i.getProperty("/invRegion"),country:i.getProperty("/invCountry"),language:i.getProperty("/invLanguage"),telephone:i.getProperty("/telephone"),mobilePhone:i.getProperty("/mobileNumber"),taxId:i.getProperty("/taxId"),b_Codes:i.getProperty("/bCode"),bpNummr:i.getProperty("/bpNummr")}];b.exchange.address=O}else{var O=[{id:"",returnReqNum:"",zipCode:"",refDocNum:i.getProperty("/refDocNum"),email:"",salesDocument:"",partnerRole:"AG",name1:i.getProperty("/partnerName"),name2:"",name3:"",name4:i.getProperty("/partnerName4"),street2:i.getProperty("/AddressStreet2"),street3:i.getProperty("/AddressStreet3"),street5:i.getProperty("/AddressStreet5"),district:i.getProperty("/District"),differentCity:i.getProperty("/DifferentCity"),postalCode:i.getProperty("/postalCode"),city:i.getProperty("/city"),region:i.getProperty("/invRegion"),country:i.getProperty("/invCountry"),language:i.getProperty("/invLanguage"),telephone:i.getProperty("/telephone"),mobilePhone:i.getProperty("/mobileNumber"),taxId:i.getProperty("/taxId"),b_Codes:i.getProperty("/bCode"),bpNummr:i.getProperty("/bpNummr")},{id:"",returnReqNum:"",zipCode:"",refDocNum:i.getProperty("/refDocNum"),email:"",salesDocument:"",partnerRole:"WE",name1:i.getProperty("/partnerName"),name2:"",name3:"",name4:i.getProperty("/partnerName4"),street2:i.getProperty("/AddressStreet2"),street3:i.getProperty("/AddressStreet3"),street5:i.getProperty("/AddressStreet5"),district:i.getProperty("/District"),differentCity:i.getProperty("/DifferentCity"),postalCode:i.getProperty("/postalCode"),city:i.getProperty("/city"),region:i.getProperty("/invRegion"),country:i.getProperty("/invCountry"),language:i.getProperty("/invLanguage"),telephone:i.getProperty("/telephone"),mobilePhone:i.getProperty("/mobileNumber"),taxId:i.getProperty("/taxId"),b_Codes:i.getProperty("/bCode"),bpNummr:i.getProperty("/bpNummr")},{id:"",returnReqNum:"",zipCode:"",refDocNum:i.getProperty("/refDocNum"),email:"",salesDocument:"",partnerRole:"RE",name1:i.getProperty("/partnerName"),name2:"",name3:"",name4:i.getProperty("/partnerName4"),street2:i.getProperty("/AddressStreet2"),street3:i.getProperty("/AddressStreet3"),street5:i.getProperty("/AddressStreet5"),district:i.getProperty("/District"),differentCity:i.getProperty("/DifferentCity"),postalCode:i.getProperty("/postalCode"),city:i.getProperty("/city"),region:i.getProperty("/invRegion"),country:i.getProperty("/invCountry"),language:i.getProperty("/invLanguage"),telephone:i.getProperty("/telephone"),mobilePhone:i.getProperty("/mobileNumber"),taxId:i.getProperty("/taxId"),b_Codes:i.getProperty("/bCode"),bpNummr:i.getProperty("/bpNummr")},{id:"",returnReqNum:"",zipCode:"",refDocNum:i.getProperty("/refDocNum"),email:"",salesDocument:"",partnerRole:"RG",name1:i.getProperty("/partnerName"),name2:"",name3:"",name4:i.getProperty("/partnerName4"),street2:i.getProperty("/AddressStreet2"),street3:i.getProperty("/AddressStreet3"),street5:i.getProperty("/AddressStreet5"),district:i.getProperty("/District"),differentCity:i.getProperty("/DifferentCity"),postalCode:i.getProperty("/postalCode"),city:i.getProperty("/city"),region:i.getProperty("/invRegion"),country:i.getProperty("/invCountry"),language:i.getProperty("/invLanguage"),telephone:i.getProperty("/telephone"),mobilePhone:i.getProperty("/mobileNumber"),taxId:i.getProperty("/taxId"),b_Codes:i.getProperty("/bCode"),bpNummr:i.getProperty("/bpNummr")}];b.exchange.address=O}}}}else{if(this.getView().getModel("baseModel").getProperty("/exchangeTabVisiblity")===true){sap.m.MessageBox.information(this.resourceBundle.getText("discardExchangeItems"),{actions:[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],onClose:function(r){if(r===t.Action.OK){e.getView().getModel("baseModel").setProperty("/exchangeTabVisiblity",false);e._continueSubmit()}else{return}}});return}}}else{if(this.getView().getModel("baseModel").getProperty("/exchangeTabVisiblity")===true){sap.m.MessageBox.information(this.resourceBundle.getText("discardExchangeItems"),{actions:[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],onClose:function(r){if(r===t.Action.OK){e.getView().getModel("baseModel").setProperty("/exchangeTabVisiblity",false);e._continueSubmit()}else{return}}});return}}if(this.getView().getModel("returnModel").getData().attachmentObject.length>0){var l=[];var k=this.getView().getModel("returnModel").getData().attachmentObject;for(var C=0;C<k.length;C++){var Q={docName:k[C].fileName,docType:k[C].fileType,docData:k[C].fileDoc};l.push(Q)}b.returns.attachment=l}var G={"Content-Type":"application/json;charset=utf-8"};var H=new sap.m.BusyDialog;H.open();var J=new sap.ui.model.json.JSONModel;J.loadData("/DKSHJavaService/returnRequestAsync/createReturnRequest",JSON.stringify(b),true,"POST",false,false,G);J.attachRequestCompleted(function(t){H.close();if(e.address){e.address.close()}if(sap.ui.getCore().getModel("saveDraft")){sap.ui.getCore().getModel("saveDraft").setData("")}if(t.getSource().getData().status){var r=t.getSource().getData().status.split(" ")[1];e.oDefaultDialog=new sap.m.Dialog({type:sap.m.DialogType.Message,title:"Success",content:[new sap.m.Text({text:" "+t.getSource().getData().status+"."}),new sap.m.Text({text:" "+e.resourceBundle.getText("Fordetailsclick")}),new sap.m.Link({text:r,target:"_top",press:function(t){e._wizard.discardProgress(e._wizard.getSteps()[0]);e._discardChanges();var s={orderNO:r};var o=new sap.ui.model.json.JSONModel(s);sap.ui.getCore().setModel(o,"submitRequest");var a=sap.ui.core.UIComponent.getRouterFor(e);a.navTo("DraftRecord")}})],beginButton:new sap.m.Button({text:e.resourceBundle.getText("OK"),press:function(){e._wizard.discardProgress(e._wizard.getSteps()[0]);e._discardChanges();var t=sap.ui.core.UIComponent.getRouterFor(e);t.navTo("DraftRecord")}.bind(e)}),endButton:new sap.m.Button({text:e.resourceBundle.getText("Close"),press:function(){e._wizard.discardProgress(e._wizard.getSteps()[0]);e._discardChanges();var t=sap.ui.core.UIComponent.getRouterFor(e);t.navTo("DraftRecord")}.bind(e)})});e.getView().addDependent(e.oDefaultDialog);e.oDefaultDialog.open()}});J.attachRequestFailed(function(e){H.close();t.error(e.getParameters().responseText)})},onExit:function(){if(this.SoldtoParty){this.SoldtoParty.destroy()}if(sap.ui.getCore().byId("homeBtn")){sap.ui.getCore().byId("homeBtn").detachPress();sap.ui.getCore().byId("homeBtn").attachPress(function(e){var t=sap.ushell.Container.getService("CrossApplicationNavigation");t.toExternal({target:{shellHash:"#"}})})}this._discardChanges()}})});